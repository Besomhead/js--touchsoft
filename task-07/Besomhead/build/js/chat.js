var MARKUP_TIMEOUT=5e3,config={chatTitle:"Чат",chatState:"",userName:"",chatURL:"https://besomhead-chat.firebaseio.com/",cssClass:"chat-container",position:"right",allowMinimize:"true",allowDrag:"false",requireName:"false",showDateTime:"true",requests:"fetch",updates:"refetch",messagesLength:0,commandsLength:0},DM=function(){function e(){}return e.prototype.getDOMElement=function(e){return"string"==typeof e?document.getElementById(e):e},e.prototype.getDOMChildrenByTag=function(e,t){return Array.from(this.getDOMElement(e).getElementsByTagName(t))},e.prototype.getDOMChildrenByClass=function(e,t){return Array.from(DM.getDOMElement(e).getElementsByClassName(t))},e.prototype.createDOMElement=document.createElement.bind(document),e.prototype.appendDOMElement=function(e,t){DM.getDOMElement(e).appendChild(t)},e.prototype.removeDOMElement=function(e,t){DM.getDOMElement(e).removeChild(DM.getDOMElement(t))},e.prototype.addListener=function(e,t,n){DM.getDOMElement(e).addEventListener(t,n)},e.prototype.removeListener=function(e,t,n){DM.getDOMElement(e).removeEventListener(t,n)},e.prototype.addCSSClass=function(t){Array.from(arguments).slice(1).forEach(function(e){DM.getDOMElement(t).classList.add(e)})},e.prototype.removeCSSClass=function(e,t){DM.getDOMElement(e).classList.remove(t)},new e}(),messageFactory=function(){function e(){}function a(e,t,n){var a,s,o;this.day=e.getDate(),this.month=e.getMonth(),this.time=(s=(a=e).getHours(),o=a.getMinutes(),(s<10?"0":"").concat(s.toString()).concat(":").concat(o<10?"0":"").concat(o.toString())),this.sender=t,this.body=n}function s(e,t,n){this.date=e.toLocaleString(),this.type=t,this.params=n,this.shown=!1}return e.prototype.getMessage=function(e,t,n){return new a(e,t,n)},e.prototype.getCommandMessage=function(e,t,n){return new s(e,t,n)},new e}(),HTTP_GET="GET",HTTP_POST="POST",HTTP_PUT="PUT",REQUEST_FETCH="fetch",REQUEST_XHR="xhr",storageManager=function(d){function e(){}function l(e,t){var n={method:e,headers:{Accept:"application/json"}};return e!==HTTP_GET&&(n.body=JSON.stringify(t)),n}return e.prototype.getStoragePath=function(e){return d.chatURL+e+".json"},e.prototype.sendRequestToStorage=function(e,t,n){var a,s,o,r,c,i,u;return d.requests===REQUEST_FETCH?(c=e,i=t,u=n,a=fetch(storageManager.getStoragePath(c),l(i,u)).then(function(e){return e.json()}).then(function(e){return e})):d.requests===REQUEST_XHR&&(s=e,o=t,r=n,a=new Promise(function(e,t){var n=new XMLHttpRequest;n.open(o,storageManager.getStoragePath(s),!0),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Content-Type","application/json"),n.addEventListener("load",function(){e(JSON.parse(n.response))}),n.addEventListener("error",function(){t(n.statusText)}),n.send(JSON.stringify(r))})),a},e.prototype.getDataFromService=function(e){return fetch(e,l(HTTP_GET)).then(function(e){return e.json()}).then(function(e){return e})},new e}(config),updatesManager=function(){function e(){this.responseData=void 0}return e.prototype.getDataFromStorage=function(e){var t=new XMLHttpRequest;t.addEventListener("readystatechange",function(){var e=t.responseText;if(this.status&&this.responseText){if(e.lastIndexOf("event:")!==e.lastIndexOf("event: put"))return;window.postMessage(JSON.parse(e.slice(e.lastIndexOf("data:")+"data:".length,e.lastIndexOf("}")+1)),window.location)}}),t.open("GET",storageManager.getStoragePath(e),!0),t.setRequestHeader("Accept","text/event-stream"),t.send()},new e}(),chatFactory=function(c){var o,t="chat-user-id",r="chat-collapsed",i="chat-expanded",d="chat",u="chat-messages",s="chat-input-box",l="chat-input-txt",m="chat-message-button",M="chat-toggle-button",g="[ ]",p="-",D=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],n=15e3,e="Вы",a="userName",h="chatState",f="messages",T="commands",E="read",S="chat-username-prompt-container",O="chat-username-prompt-input",v="chat-username-prompt-button",y=3e3,C=0,w="https://ipinfo.io/",L="http://ip-api.com/",b="https://geoip-db.com/";function H(){}function P(e){return localStorage.getItem(t)+"/"+e}function R(e){c.chatState=e,storageManager.sendRequestToStorage(P(h),HTTP_PUT,e)}function U(e,t){var n=DM.createDOMElement("div");n.innerHTML=t,DM.appendDOMElement(e,n)}function N(e,t){var n,a,s,o,r;n=d.concat("-").concat(t.day).concat("-").concat(t.month),null===DM.getDOMElement(n)&&((a=DM.createDOMElement("div")).id=n,DM.addCSSClass(a,"chat-messages-container"),"true"===c.showDateTime?(DM.addCSSClass(a,"chat-messages-container-with-time"),s=e,o=t,(r=DM.createDOMElement("legend")).innerHTML=o.day.toString().concat(" ").concat(D[+o.month]),DM.addCSSClass(r,"chat-day-of-month"),DM.appendDOMElement(s,r)):"false"===c.showDateTime&&DM.addCSSClass(a,"chat-messages-container-no-time"),DM.appendDOMElement(e,a)),a=DM.getDOMElement(n),"true"===c.showDateTime&&U(a,t.time),U(a,t.sender),U(a,t.body)}function q(t,n){var e=Object.keys(n);c.messagesLength=e.length,e.forEach(function(e){N(t,n[e])})}function _(){c.chatState!==r?storageManager.sendRequestToStorage(P(f),HTTP_GET,"").then(function(t){var e;setTimeout(_,n),t&&(e=Object.keys(t),c.messagesLength>=e.length||(e.slice(c.messagesLength).forEach(function(e){N(DM.getDOMElement(u),t[e])}),c.messagesLength=e.length))}):setTimeout(_,n)}function k(){var e;return"left"===c.position?e="chat-container-left":"right"===c.position&&(e="chat-container-right"),e}function x(e,t,n){var a=DM.createDOMElement("fieldset"),s=DM.createDOMElement("legend"),o=DM.createDOMElement("label"),r=DM.createDOMElement("input"),c=DM.createDOMElement("button");a.id=S,DM.addCSSClass(a,"chat-prompt-container",k()),s.innerHTML=e||"Имя",r.id=O,r.placeholder=n||"Имя пользователя",DM.addCSSClass(r,"chat-prompt-input"),o.for=r.id,o.innerHTML=t||"Пожалуйста, представьтесь:",c.id=v,DM.addCSSClass(c,"chat-prompt-button"),c.innerHTML="Сохранить",DM.appendDOMElement(a,s),DM.appendDOMElement(a,o),DM.appendDOMElement(a,r),DM.appendDOMElement(a,c),DM.appendDOMElement(d,a)}function F(e){DM.getDOMElement(l).disabled=!e,DM.getDOMElement(m).disabled=!e,null!==DM.getDOMElement(M)&&(DM.getDOMElement(M).disabled=!e)}function j(){storageManager.sendRequestToStorage(P(a),HTTP_GET,"").then(function(e){c.userName=e}),setTimeout(function(){null!==c.userName&&void 0!==c.userName&&""!==c.userName||("true"===c.requireName?(x(),F(!1),DM.addListener(v,"click",function(){var e=DM.getDOMElement(O).value;e.length<1||(c.userName=e,DM.removeDOMElement(d,S),F(!0),storageManager.sendRequestToStorage(P(a),HTTP_PUT,c.userName))})):(c.userName=e,storageManager.sendRequestToStorage(P(a),HTTP_PUT,c.userName)))},y)}function I(){var e,t,n=DM.getDOMElement(l);""!==n.value&&(e=messageFactory.getMessage(new Date,c.userName.concat(":"),n.value),n.value="",t=e,storageManager.sendRequestToStorage(P(f),HTTP_POST,t),storageManager.sendRequestToStorage(P(E),HTTP_PUT,!1))}function G(){var e,t,n,a;DM.removeCSSClass(d,r),DM.addCSSClass(d,i),"true"===c.allowMinimize&&(DM.getDOMElement(M).innerHTML=p),(e=DM.createDOMElement("div")).id=u,DM.addCSSClass(e,"chat-messages-external"),DM.appendDOMElement(d,e),o&&o.messages&&q(DM.getDOMElement(u),o.messages),t=DM.createDOMElement("div"),n=DM.createDOMElement("textarea"),a=DM.createDOMElement("button"),t.id=s,DM.addCSSClass(t,"chat-input-container"),n.id=l,DM.addCSSClass(n,"chat-input-textarea"),DM.appendDOMElement(t,n),a.id=m,DM.addCSSClass(a,"chat-message-button"),a.innerHTML="Отправить",DM.addListener(a,"click",I),DM.appendDOMElement(t,a),DM.appendDOMElement(d,t),""!==c.userName&&null!==c.userName&&void 0!==c.userName||j(),R(i)}function B(e,t){e.shown=!0,storageManager.sendRequestToStorage(P(T+"/"+t+"/shown"),HTTP_PUT,e.shown)}function A(e,t,n){storageManager.sendRequestToStorage(P(T+"/"+t+"/result"),HTTP_PUT,n)}function X(e,t){DM.getDOMElement(S)||(B(e,t),c.chatState===r&&G(),x.apply(this,e.params),DM.addListener(v,"click",function(){DM.getDOMElement(O).value&&(A(0,t,DM.getDOMElement(O).value),DM.removeDOMElement(d,S))}))}function J(e,t,n){storageManager.getDataFromService(e).then(function(e){A(0,n,JSON.stringify(e,null,2))})}function z(e,t){var n=e.params.shift();switch(B(e,t),n){case w:J(n);break;case L:J(n+"json");break;case b:J(n+"json/")}}function Q(e,t){var n;if(!e.shown){switch(e.type){case"user-info":n=z;break;case"ask-user":n=X}setTimeout(n.bind(this,e,t),C)}}function Y(e){var t,n=e.data.data,a=e.data.path,s=a.split("/").slice(1);if("/"===a){if((o=n).commands||(o.commands={}),c.chatState===r)return;return chatFactory.appendMessages(DM.getDOMElement(u),o.messages),void(o.commands&&Object.keys(o.commands).forEach(function(e){Q(o.commands[e],e)}))}switch(s.shift()){case f:if(-1!==(o.messages[s.shift()]=n).sender.indexOf(c.userName))return;if(c.chatState===r)return;N(DM.getDOMElement(u),n);break;case T:if(t=s.shift(),s.shift())return;Q(o.commands[t]=n,t)}}function K(){storageManager.sendRequestToStorage(P(T),HTTP_GET,"").then(function(t){var e;setTimeout(K,n),t&&(e=Object.keys(t),c.commandsLength>=e.length||(e.slice(c.commandsLength).forEach(function(e){Q(t[e],e)}),c.commandsLength=e.length))})}function V(){storageManager.sendRequestToStorage(P(h),HTTP_GET,"").then(function(e){c.chatState=e}),setTimeout(function(){null===c.chatState||void 0===c.chatState||""===c.chatState?R(r):c.chatState===i&&G(),DM.addCSSClass(d,c.chatState)},y)}function W(){switch(c.chatState){case r:G();break;case i:c.messagesLength=0,DM.removeCSSClass(d,i),DM.addCSSClass(d,r),DM.getDOMElement(M).innerHTML=g,DM.removeDOMElement(d,u),DM.removeDOMElement(d,s),R(r);break;default:throw new Error("Unexpected key/value pair: "+d+"/"+c.chatState)}}function Z(u){DM.addListener(u,"mousedown",function(e){var t,n,a,s=DM.getDOMElement(d),o={top:(t=s.getBoundingClientRect()).top+window.pageYOffset,left:t.left+window.pageXOffset},r=e.pageX-o.left,c=e.pageY-o.top;function i(e){s.style.left=e.pageX-r+"px",s.style.top=e.pageY-c+"px"}"BUTTON"!==e.target.tagName&&(n=function(e){i(e)},a=function(){DM.removeListener(document,"mousemove",n),DM.removeListener(u,"mouseup",a)},i(e),DM.addListener(document,"mousemove",n),DM.addListener(u,"mouseup",a))}),DM.addListener(u,"dragstart",function(){return!1})}return H.prototype.appendMessages=function(t,e){e?q(t,e):storageManager.sendRequestToStorage(P(f),HTTP_GET,"").then(function(e){e&&q(t,e)})},H.prototype.subscribeOnUpdates=function(){"refetch"===c.updates?(_(),K()):"longPolling"===c.updates&&(window.addEventListener("message",Y),updatesManager.getDataFromStorage(P("")))},H.prototype.appendStylesheet=function(){var e=DM.createDOMElement("link");e.rel="stylesheet",e.type="text/css",e.href="https://rawgit.com/Besomhead/js--touchsoft/besomhead-task07-build/task-07/Besomhead/build/css/chat_styles.css",DM.appendDOMElement(document.head,e)},H.prototype.createChatMarkup=function(){var e,t,n=DM.createDOMElement("fieldset"),a=DM.createDOMElement("legend"),s=DM.createDOMElement("div");n.id=d,DM.addCSSClass(n,"chat-container",k(),c.cssClass),a.innerHTML=c.chatTitle,DM.addCSSClass(a,"chat-legend"),n.appendChild(a),DM.addCSSClass(s,"chat-toggle-button-container"),"true"===c.allowDrag&&(DM.addCSSClass(s,"chat-toggle-button-container-drag"),Z(s)),"true"===c.allowMinimize?(e=s,t=DM.createDOMElement("button"),DM.addCSSClass(t,M),t.id=M,t.innerHTML=c.chatState===i?p:g,DM.addListener(t,"click",W),DM.appendDOMElement(e,t)):"false"===c.allowMinimize&&R(i),DM.appendDOMElement(n,s),DM.appendDOMElement(document.body,n),V()},H.prototype.setConfig=function(){var e,t,n=(e=document.currentScript.src).substr(e.indexOf("?")+1).split("&").reduce(function(e,t){var n=t.split("="),a=decodeURIComponent(n[1]);return e[decodeURIComponent(n[0])]=a.substr(1,a.length-2),e},{});Object.keys(n).forEach(function(e){""!==(t=n[e])&&(c[e]=t)})},H.prototype.setUniqueUserID=function(){null===localStorage.getItem(t)&&localStorage.setItem(t,"user".concat(Date.now().toString()))},new H}(config);window.addEventListener("load",function(){chatFactory.appendStylesheet(),chatFactory.setUniqueUserID(),chatFactory.createChatMarkup(),setTimeout(chatFactory.subscribeOnUpdates,MARKUP_TIMEOUT)}),chatFactory.setConfig();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoYXQuanMiXSwibmFtZXMiOlsiTUFSS1VQX1RJTUVPVVQiLCJjb25maWciLCJjaGF0VGl0bGUiLCJjaGF0U3RhdGUiLCJ1c2VyTmFtZSIsImNoYXRVUkwiLCJjc3NDbGFzcyIsInBvc2l0aW9uIiwiYWxsb3dNaW5pbWl6ZSIsImFsbG93RHJhZyIsInJlcXVpcmVOYW1lIiwic2hvd0RhdGVUaW1lIiwicmVxdWVzdHMiLCJ1cGRhdGVzIiwibWVzc2FnZXNMZW5ndGgiLCJjb21tYW5kc0xlbmd0aCIsIkRNIiwiRE9NTWFuYWdlciIsInByb3RvdHlwZSIsImdldERPTUVsZW1lbnQiLCJpZHRmIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImdldERPTUNoaWxkcmVuQnlUYWciLCJyb290IiwidGFnIiwiQXJyYXkiLCJmcm9tIiwidGhpcyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZ2V0RE9NQ2hpbGRyZW5CeUNsYXNzIiwiY2xhc3NOYW1lIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImNyZWF0ZURPTUVsZW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiYmluZCIsImFwcGVuZERPTUVsZW1lbnQiLCJlbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJyZW1vdmVET01FbGVtZW50IiwicmVtb3ZlQ2hpbGQiLCJhZGRMaXN0ZW5lciIsImV2ZW50IiwiY2FsbGJhY2siLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlTGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiYWRkQ1NTQ2xhc3MiLCJhcmd1bWVudHMiLCJzbGljZSIsImZvckVhY2giLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmVDU1NDbGFzcyIsInJlbW92ZSIsIm1lc3NhZ2VGYWN0b3J5IiwiTWVzc2FnZUZhY3RvcnkiLCJNZXNzYWdlIiwiZGF0ZSIsInNlbmRlciIsImJvZHkiLCJob3VycyIsIm1pbnV0ZXMiLCJkYXkiLCJnZXREYXRlIiwibW9udGgiLCJnZXRNb250aCIsInRpbWUiLCJnZXRIb3VycyIsImdldE1pbnV0ZXMiLCJjb25jYXQiLCJ0b1N0cmluZyIsIkNvbW1hbmRNZXNzYWdlIiwidHlwZSIsInBhcmFtcyIsInRvTG9jYWxlU3RyaW5nIiwic2hvd24iLCJnZXRNZXNzYWdlIiwiZ2V0Q29tbWFuZE1lc3NhZ2UiLCJIVFRQX0dFVCIsIkhUVFBfUE9TVCIsIkhUVFBfUFVUIiwiUkVRVUVTVF9GRVRDSCIsIlJFUVVFU1RfWEhSIiwic3RvcmFnZU1hbmFnZXIiLCJTdG9yYWdlTWFuYWdlciIsImdldFJlcXVlc3RDb25maWdPYmoiLCJyZXF1ZXN0TWV0aG9kIiwiZGF0YSIsImNvbmZpZ09iaiIsIm1ldGhvZCIsImhlYWRlcnMiLCJBY2NlcHQiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0U3RvcmFnZVBhdGgiLCJleHRyYVBhdGgiLCJzZW5kUmVxdWVzdFRvU3RvcmFnZSIsInJlc3BvbnNlIiwiZmV0Y2giLCJ0aGVuIiwianNvbiIsInJlc3BvbnNlRGF0YSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwic2V0UmVxdWVzdEhlYWRlciIsInBhcnNlIiwic3RhdHVzVGV4dCIsInNlbmQiLCJnZXREYXRhRnJvbVNlcnZpY2UiLCJwYXRoIiwidXBkYXRlc01hbmFnZXIiLCJVcGRhdGVzTWFuYWdlciIsInVuZGVmaW5lZCIsImdldERhdGFGcm9tU3RvcmFnZSIsInhodHRwIiwicmVzcG9uc2VUZXh0Iiwic3RhdHVzIiwibGFzdEluZGV4T2YiLCJ3aW5kb3ciLCJwb3N0TWVzc2FnZSIsImxlbmd0aCIsImxvY2F0aW9uIiwiY2hhdEZhY3RvcnkiLCJ1c2VyRGF0YSIsIlVTRVJfSUQiLCJDT0xMQVBTRUQiLCJFWFBBTkRFRCIsIkNIQVRfSVRFTSIsIk1FU1NBR0VTX0xJU1QiLCJJTlBVVF9CT1giLCJJTlBVVF9URVhUIiwiQ0hBVF9NRVNTQUdFX0JVVFRPTl9JRCIsIlRPR0dMRV9CVVRUT04iLCJFWFBBTkRfTUFSSyIsIkNPTExBUFNFX01BUksiLCJtb250aHMiLCJSRVBMWV9USU1FT1VUIiwiREVGQVVMVF9VU0VSX05BTUUiLCJVU0VSX05BTUVfRklFTEQiLCJDSEFUX1NUQVRFX0ZJRUxEIiwiTUVTU0FHRVNfRklFTEQiLCJDT01NQU5EU19GSUVMRCIsIlJFQURfRklFTEQiLCJBU0tfVVNFUl9QUk9NUFRfSUQiLCJQUk9NUFRfSU5QVVRfSUQiLCJQUk9NUFRfQ09ORklSTV9CVVRUT05fSUQiLCJSRVFVRVNUX1RJTUVPVVQiLCJaRVJPX1RJTUVPVVQiLCJJUF9JTkZPX1BBVEgiLCJJUF9BUElfUEFUSCIsIkdFT19JUF9QQVRIIiwiQ2hhdEZhY3RvcnkiLCJnZXRFeHRyYVBhdGgiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic2F2ZUNoYXRTdGF0ZVRvU3RvcmFnZSIsInN0YXRlIiwiYXBwZW5kTWVzc2FnZVBhcnQiLCJjb250YWluZXIiLCJpbm5lckhUTUwiLCJlbCIsImFwcGVuZFNpbmdsZU1lc3NhZ2UiLCJtZXNzYWdlIiwiY29udGFpbmVySWQiLCJtZXNzYWdlc0NvbnRhaW5lciIsImRheU9mTW9udGgiLCJpZCIsInNob3dNZXNzYWdlcyIsIm1lc3NhZ2VzIiwibWVzc2FnZXNLZXlzIiwiT2JqZWN0Iiwia2V5cyIsImtleSIsInVwZGF0ZU1lc3NhZ2VzTGlzdCIsInNldFRpbWVvdXQiLCJnZXRQb3NpdGlvbkNsYXNzIiwicG9zaXRpb25DbGFzcyIsImNyZWF0ZVByb21wdE1hcmt1cCIsImhlYWRlciIsInBsYWNlaG9sZGVyIiwicHJvbXB0Q29udGFpbmVyIiwicHJvbXB0TGVnZW5kIiwicHJvbXB0TGFiZWwiLCJwcm9tcHRJbnB1dCIsInByb21wdENvbmZpcm1CdXR0b24iLCJmb3IiLCJzZXRPdGhlckNvbXBvbmVudHNBdmFpbGFiaWxpdHkiLCJpc0F2YWlsYWJsZSIsImRpc2FibGVkIiwic2V0VXNlck5hbWUiLCJ2YWx1ZSIsInNlbmRNZXNzYWdlIiwiaW5wdXRUZXh0QXJlYSIsIkRhdGUiLCJleHBhbmRDaGF0IiwibWVzc2FnZXNMaXN0Q29udGFpbmVyIiwiaW5wdXRNZXNzYWdlQ29udGFpbmVyIiwibWVzc2FnZUJ1dHRvbiIsIm1hcmtVc2VyQ29tbWFuZEFzU2hvd24iLCJ1c2VyQ29tbWFuZCIsImNvbW1hbmRLZXkiLCJzYXZlVXNlckNvbW1hbmRSZXN1bHQiLCJyZXN1bHQiLCJhc2tVc2VyIiwiYXBwbHkiLCJyZXF1ZXN0U3BlY2lmaWVkU2VydmljZSIsImdldFVzZXJJbmZvIiwic2VydmljZSIsInNoaWZ0IiwicnVuVXNlckNvbW1hbmQiLCJjb21tYW5kTWV0aG9kIiwiYXBwbHlVcGRhdGVzIiwiZGF0YUtleSIsInBhdGhGcmFnbWVudHMiLCJzcGxpdCIsImNvbW1hbmRzIiwiYXBwZW5kTWVzc2FnZXMiLCJpbmRleE9mIiwidXBkYXRlQ29tbWFuZHMiLCJjb21tYW5kc0tleXMiLCJpbml0Q2hhdFN0YXRlIiwiY2hhbmdlQ2hhdFN0YXRlIiwiRXJyb3IiLCJzZXREcmFnSGFuZGxlciIsImJveCIsIm1vdXNlTW92ZUhhbmRsZXIiLCJtb3VzZVVwSGFuZGxlciIsImNoYXQiLCJjb29yZGluYXRlcyIsInRvcCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInBhZ2VZT2Zmc2V0IiwibGVmdCIsInBhZ2VYT2Zmc2V0Iiwic2hpZnRYIiwicGFnZVgiLCJzaGlmdFkiLCJwYWdlWSIsIm1vdmVBdCIsImUiLCJzdHlsZSIsInRhcmdldCIsInRhZ05hbWUiLCJzdWJzY3JpYmVPblVwZGF0ZXMiLCJhcHBlbmRTdHlsZXNoZWV0Iiwic3R5bGVFbGVtZW50IiwicmVsIiwiaHJlZiIsImhlYWQiLCJjcmVhdGVDaGF0TWFya3VwIiwidG9nZ2xlQnV0dG9uIiwibGVnZW5kIiwidG9nZ2xlQnV0dG9uQ29udGFpbmVyIiwic2V0Q29uZmlnIiwic2NyaXB0IiwicHJvcGVydHlWYWx1ZSIsInJlcXVlc3RDb25maWciLCJjdXJyZW50U2NyaXB0Iiwic3JjIiwic3Vic3RyIiwicmVkdWNlIiwicGFyYW0iLCJwYXJ0cyIsImRlY29kZVVSSUNvbXBvbmVudCIs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N0IsR0FDdENsTixHQUFHb0IsaUJBQWlCK0gsRUFBVzRGLElBdUVLLFVBQXpCOVAsRUFBT08sZUFDaEJ3SixFQUF1QjdCLEdBRXpCbkgsR0FBR29CLGlCQUFpQitILEVBQVc4RixHQUMvQmpQLEdBQUdvQixpQkFBaUJmLFNBQVN1QyxLQUFNdUcsR0FDbkM4RCxLQWdCRnJFLEVBQVkxSSxVQUFVZ1AsVUFBWSxXQUNoQyxJQWJJQyxFQWNBQyxFQURBQyxHQWJBRixFQUFTOU8sU0FBU2lQLGNBQWNDLEtBRWpDQyxPQUFPTCxFQUFPckMsUUFBUSxLQUFPLEdBQzdCSCxNQUFNLEtBQ044QyxPQUFPLFNBQWlCQyxFQUFPckcsR0FDOUIsSUFBSXNHLEVBQVF0RyxFQUFHc0QsTUFBTSxLQUNqQnhCLEVBQVF5RSxtQkFBbUJELEVBQU0sSUFFckMsT0FEQUQsRUFBTUUsbUJBQW1CRCxFQUFNLEtBQU94RSxFQUFNcUUsT0FBTyxFQUFHckUsRUFBTXRFLE9BQVMsR0FDOUQ2SSxHQUNOLElBT0wzRixPQUFPQyxLQUFLcUYsR0FBZW5OLFFBQVEsU0FBeUIrSCxHQUVwQyxNQUR0Qm1GLEVBQWdCQyxFQUFjcEYsTUFFNUJoTCxFQUFPZ0wsR0FBT21GLE1BS3BCeEcsRUFBWTFJLFVBQVUyUCxnQkFBa0IsV0FDQSxPQUFsQy9HLGFBQWFDLFFBQVE5QixJQUN2QjZCLGFBQWFnSCxRQUFRN0ksRUFBUyxPQUFPM0QsT0FBT2dJLEtBQUt5RSxNQUFNeE0sY0FJcEQsSUFBSXFGLEVBeHFCSyxDQXlxQmYzSixRQUVIMEgsT0FBTy9FLGlCQUFpQixPQUFRLFdBQzlCbUYsWUFBWTBILG1CQUNaMUgsWUFBWThJLGtCQUNaOUksWUFBWStILG1CQUNaM0UsV0FBV3BELFlBQVl5SCxtQkFBb0J4UCxrQkFHN0MrSCxZQUFZbUkiLCJmaWxlIjoiY2hhdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xyXG4vKiBnbG9iYWwgY2hhdEZhY3RvcnkgKi9cclxuXHJcbnZhciBNQVJLVVBfVElNRU9VVCA9IDUwMDA7XHJcblxyXG52YXIgY29uZmlnID0ge1xyXG4gIGNoYXRUaXRsZTogXCLQp9Cw0YJcIixcclxuICBjaGF0U3RhdGU6IFwiXCIsXHJcbiAgdXNlck5hbWU6IFwiXCIsXHJcbiAgY2hhdFVSTDogXCJodHRwczovL2Jlc29taGVhZC1jaGF0LmZpcmViYXNlaW8uY29tL1wiLFxyXG4gIGNzc0NsYXNzOiBcImNoYXQtY29udGFpbmVyXCIsXHJcbiAgcG9zaXRpb246IFwicmlnaHRcIixcclxuICBhbGxvd01pbmltaXplOiBcInRydWVcIixcclxuICBhbGxvd0RyYWc6IFwiZmFsc2VcIixcclxuICByZXF1aXJlTmFtZTogXCJmYWxzZVwiLFxyXG4gIHNob3dEYXRlVGltZTogXCJ0cnVlXCIsXHJcbiAgcmVxdWVzdHM6IFwiZmV0Y2hcIixcclxuICB1cGRhdGVzOiBcInJlZmV0Y2hcIixcclxuICBtZXNzYWdlc0xlbmd0aDogMCxcclxuICBjb21tYW5kc0xlbmd0aDogMFxyXG59O1xyXG5cclxuLyogZXhwb3J0ZWQgRE0gKi9cclxuXHJcbnZhciBETSA9IChmdW5jdGlvbiBET01NYW5hZ2VyTW9kdWxlKCkge1xyXG4gIGZ1bmN0aW9uIERPTU1hbmFnZXIoKSB7fVxyXG5cclxuICBET01NYW5hZ2VyLnByb3RvdHlwZS5nZXRET01FbGVtZW50ID0gZnVuY3Rpb24gZ2V0RWxlbWVudChpZHRmKSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIGlkdGYgPT09IFwic3RyaW5nXCIgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZHRmKSA6IGlkdGY7XHJcbiAgfTtcclxuICBET01NYW5hZ2VyLnByb3RvdHlwZS5nZXRET01DaGlsZHJlbkJ5VGFnID0gZnVuY3Rpb24gZ2V0Q2hpbGRyZW5CeVRhZ05hbWUoXHJcbiAgICByb290LFxyXG4gICAgdGFnXHJcbiAgKSB7XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmdldERPTUVsZW1lbnQocm9vdCkuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnKSk7XHJcbiAgfTtcclxuICBET01NYW5hZ2VyLnByb3RvdHlwZS5nZXRET01DaGlsZHJlbkJ5Q2xhc3MgPSBmdW5jdGlvbiBnZXRDaGlsZHJlbkJ5Q2xhc3NOYW1lKFxyXG4gICAgcm9vdCxcclxuICAgIGNsYXNzTmFtZVxyXG4gICkge1xyXG4gICAgcmV0dXJuIEFycmF5LmZyb20oRE0uZ2V0RE9NRWxlbWVudChyb290KS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSkpO1xyXG4gIH07XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUuY3JlYXRlRE9NRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQuYmluZChkb2N1bWVudCk7XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUuYXBwZW5kRE9NRWxlbWVudCA9IGZ1bmN0aW9uIGFwcGVuZChyb290LCBlbGVtZW50KSB7XHJcbiAgICBETS5nZXRET01FbGVtZW50KHJvb3QpLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG4gIH07XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUucmVtb3ZlRE9NRWxlbWVudCA9IGZ1bmN0aW9uIHJlbW92ZShyb290LCBlbGVtZW50KSB7XHJcbiAgICBETS5nZXRET01FbGVtZW50KHJvb3QpLnJlbW92ZUNoaWxkKERNLmdldERPTUVsZW1lbnQoZWxlbWVudCkpO1xyXG4gIH07XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUuYWRkTGlzdGVuZXIgPSBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKFxyXG4gICAgcm9vdCxcclxuICAgIGV2ZW50LFxyXG4gICAgY2FsbGJhY2tcclxuICApIHtcclxuICAgIERNLmdldERPTUVsZW1lbnQocm9vdCkuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgY2FsbGJhY2spO1xyXG4gIH07XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVyKFxyXG4gICAgcm9vdCxcclxuICAgIGV2ZW50LFxyXG4gICAgY2FsbGJhY2tcclxuICApIHtcclxuICAgIERNLmdldERPTUVsZW1lbnQocm9vdCkucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgY2FsbGJhY2spO1xyXG4gIH07XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUuYWRkQ1NTQ2xhc3MgPSBmdW5jdGlvbiBhZGRDU1NDbGFzcyhyb290KSB7XHJcbiAgICBBcnJheS5mcm9tKGFyZ3VtZW50cylcclxuICAgICAgLnNsaWNlKDEpXHJcbiAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uIGFkZENsYXNzZXMoY2xhc3NOYW1lKSB7XHJcbiAgICAgICAgRE0uZ2V0RE9NRWxlbWVudChyb290KS5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XHJcbiAgICAgIH0pO1xyXG4gIH07XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUucmVtb3ZlQ1NTQ2xhc3MgPSBmdW5jdGlvbiByZW1vdmVDU1NDbGFzcyhcclxuICAgIHJvb3QsXHJcbiAgICBjbGFzc05hbWVcclxuICApIHtcclxuICAgIERNLmdldERPTUVsZW1lbnQocm9vdCkuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiBuZXcgRE9NTWFuYWdlcigpO1xyXG59KSgpO1xyXG4vKiBleHBvcnRlZCBtZXNzYWdlRmFjdG9yeSAqL1xyXG5cclxudmFyIG1lc3NhZ2VGYWN0b3J5ID0gKGZ1bmN0aW9uIG1lc3NhZ2VGYWN0b3J5TW9kdWxlKCkge1xyXG4gIGZ1bmN0aW9uIE1lc3NhZ2VGYWN0b3J5KCkge31cclxuXHJcbiAgZnVuY3Rpb24gZ2V0Q3VycmVudFRpbWUoZGF0ZSkge1xyXG4gICAgdmFyIGhvdXJzID0gZGF0ZS5nZXRIb3VycygpO1xyXG4gICAgdmFyIG1pbnV0ZXMgPSBkYXRlLmdldE1pbnV0ZXMoKTtcclxuXHJcbiAgICByZXR1cm4gKGhvdXJzIDwgMTAgPyBcIjBcIiA6IFwiXCIpXHJcbiAgICAgIC5jb25jYXQoaG91cnMudG9TdHJpbmcoKSlcclxuICAgICAgLmNvbmNhdChcIjpcIilcclxuICAgICAgLmNvbmNhdChtaW51dGVzIDwgMTAgPyBcIjBcIiA6IFwiXCIpXHJcbiAgICAgIC5jb25jYXQobWludXRlcy50b1N0cmluZygpKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIE1lc3NhZ2UoZGF0ZSwgc2VuZGVyLCBib2R5KSB7XHJcbiAgICB0aGlzLmRheSA9IGRhdGUuZ2V0RGF0ZSgpO1xyXG4gICAgdGhpcy5tb250aCA9IGRhdGUuZ2V0TW9udGgoKTtcclxuICAgIHRoaXMudGltZSA9IGdldEN1cnJlbnRUaW1lKGRhdGUpO1xyXG4gICAgdGhpcy5zZW5kZXIgPSBzZW5kZXI7XHJcbiAgICB0aGlzLmJvZHkgPSBib2R5O1xyXG4gIH1cclxuXHJcbiAgTWVzc2FnZUZhY3RvcnkucHJvdG90eXBlLmdldE1lc3NhZ2UgPSBmdW5jdGlvbiBnZXRNZXNzYWdlKFxyXG4gICAgZGF0ZSxcclxuICAgIHNlbmRlcixcclxuICAgIGJvZHlcclxuICApIHtcclxuICAgIHJldHVybiBuZXcgTWVzc2FnZShkYXRlLCBzZW5kZXIsIGJvZHkpO1xyXG4gIH07XHJcblxyXG4gIGZ1bmN0aW9uIENvbW1hbmRNZXNzYWdlKGRhdGUsIHR5cGUsIHBhcmFtcykge1xyXG4gICAgdGhpcy5kYXRlID0gZGF0ZS50b0xvY2FsZVN0cmluZygpO1xyXG4gICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgIHRoaXMucGFyYW1zID0gcGFyYW1zO1xyXG4gICAgdGhpcy5zaG93biA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgTWVzc2FnZUZhY3RvcnkucHJvdG90eXBlLmdldENvbW1hbmRNZXNzYWdlID0gZnVuY3Rpb24gZ2V0Q29tbWFuZE1lc3NhZ2UoXHJcbiAgICBkYXRlLFxyXG4gICAgdHlwZSxcclxuICAgIHBhcmFtc1xyXG4gICkge1xyXG4gICAgcmV0dXJuIG5ldyBDb21tYW5kTWVzc2FnZShkYXRlLCB0eXBlLCBwYXJhbXMpO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiBuZXcgTWVzc2FnZUZhY3RvcnkoKTtcclxufSkoKTtcclxuLyogZXhwb3J0ZWQgc3RvcmFnZU1hbmFnZXIgKi9cclxuLyogZXhwb3J0ZWQgSFRUUF9HRVQgSFRUUF9QT1NUIEhUVFBfUFVUICovXHJcbi8qIGdsb2JhbCBjb25maWcgKi9cclxuXHJcbnZhciBIVFRQX0dFVCA9IFwiR0VUXCI7XHJcbnZhciBIVFRQX1BPU1QgPSBcIlBPU1RcIjtcclxudmFyIEhUVFBfUFVUID0gXCJQVVRcIjtcclxudmFyIFJFUVVFU1RfRkVUQ0ggPSBcImZldGNoXCI7XHJcbnZhciBSRVFVRVNUX1hIUiA9IFwieGhyXCI7XHJcblxyXG52YXIgc3RvcmFnZU1hbmFnZXIgPSAoZnVuY3Rpb24gc3RvcmFnZU1hbmFnZXJNb2R1bGUoY29uZmlnKSB7XHJcbiAgZnVuY3Rpb24gU3RvcmFnZU1hbmFnZXIoKSB7fVxyXG5cclxuICBTdG9yYWdlTWFuYWdlci5wcm90b3R5cGUuZ2V0U3RvcmFnZVBhdGggPSBmdW5jdGlvbiBnZXRTdG9yYWdlUGF0aChleHRyYVBhdGgpIHtcclxuICAgIHJldHVybiBjb25maWcuY2hhdFVSTCArIGV4dHJhUGF0aCArIFwiLmpzb25cIjtcclxuICB9O1xyXG5cclxuICBmdW5jdGlvbiBnZXRSZXF1ZXN0Q29uZmlnT2JqKHJlcXVlc3RNZXRob2QsIGRhdGEpIHtcclxuICAgIHZhciBjb25maWdPYmogPSB7XHJcbiAgICAgIG1ldGhvZDogcmVxdWVzdE1ldGhvZCxcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIEFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uXCJcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAocmVxdWVzdE1ldGhvZCAhPT0gSFRUUF9HRVQpIHtcclxuICAgICAgY29uZmlnT2JqLmJvZHkgPSBKU09OLnN0cmluZ2lmeShkYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gY29uZmlnT2JqO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2VuZFJlcXVlc3RUb1N0b3JhZ2VCeUZldGNoKGV4dHJhUGF0aCwgcmVxdWVzdE1ldGhvZCwgZGF0YSkge1xyXG4gICAgcmV0dXJuIGZldGNoKFxyXG4gICAgICBzdG9yYWdlTWFuYWdlci5nZXRTdG9yYWdlUGF0aChleHRyYVBhdGgpLFxyXG4gICAgICBnZXRSZXF1ZXN0Q29uZmlnT2JqKHJlcXVlc3RNZXRob2QsIGRhdGEpXHJcbiAgICApXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uIGdldFJlc3BvbnNlKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gZ2V0UmVzcG9uc2VEYXRhKHJlc3BvbnNlRGF0YSkge1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZURhdGE7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2VuZFJlcXVlc3RUb1N0b3JhZ2VCeVhIUihleHRyYVBhdGgsIG1ldGhvZCwgZGF0YSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIHNlbmRYSFJSZXF1ZXN0KHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcblxyXG4gICAgICB4aHIub3BlbihtZXRob2QsIHN0b3JhZ2VNYW5hZ2VyLmdldFN0b3JhZ2VQYXRoKGV4dHJhUGF0aCksIHRydWUpO1xyXG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkFjY2VwdFwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XHJcbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcclxuICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGZ1bmN0aW9uIG9uTG9hZCgpIHtcclxuICAgICAgICByZXNvbHZlKEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlKSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIGZ1bmN0aW9uIG9uRXJyb3IoKSB7XHJcbiAgICAgICAgcmVqZWN0KHhoci5zdGF0dXNUZXh0KTtcclxuICAgICAgfSk7XHJcbiAgICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgU3RvcmFnZU1hbmFnZXIucHJvdG90eXBlLnNlbmRSZXF1ZXN0VG9TdG9yYWdlID0gZnVuY3Rpb24gc2VuZFJlcXVlc3RUb1N0b3JhZ2UoXHJcbiAgICBleHRyYVBhdGgsXHJcbiAgICBtZXRob2QsXHJcbiAgICBkYXRhXHJcbiAgKSB7XHJcbiAgICB2YXIgcmVzcG9uc2U7XHJcblxyXG4gICAgaWYgKGNvbmZpZy5yZXF1ZXN0cyA9PT0gUkVRVUVTVF9GRVRDSCkge1xyXG4gICAgICByZXNwb25zZSA9IHNlbmRSZXF1ZXN0VG9TdG9yYWdlQnlGZXRjaChleHRyYVBhdGgsIG1ldGhvZCwgZGF0YSk7XHJcbiAgICB9IGVsc2UgaWYgKGNvbmZpZy5yZXF1ZXN0cyA9PT0gUkVRVUVTVF9YSFIpIHtcclxuICAgICAgcmVzcG9uc2UgPSBzZW5kUmVxdWVzdFRvU3RvcmFnZUJ5WEhSKGV4dHJhUGF0aCwgbWV0aG9kLCBkYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgfTtcclxuXHJcbiAgU3RvcmFnZU1hbmFnZXIucHJvdG90eXBlLmdldERhdGFGcm9tU2VydmljZSA9IGZ1bmN0aW9uIGdldERhdGFGcm9tU2VydmljZShcclxuICAgIHBhdGhcclxuICApIHtcclxuICAgIHJldHVybiBmZXRjaChwYXRoLCBnZXRSZXF1ZXN0Q29uZmlnT2JqKEhUVFBfR0VUKSlcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gZ2V0UmVzcG9uc2UocmVzcG9uc2UpIHtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbihmdW5jdGlvbiBnZXRSZXNwb25zZURhdGEocmVzcG9uc2VEYXRhKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlRGF0YTtcclxuICAgICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIG5ldyBTdG9yYWdlTWFuYWdlcigpO1xyXG59KShjb25maWcpO1xyXG4vKiBleHBvcnRlZCB1cGRhdGVzTWFuYWdlciAqL1xyXG4vKiBnbG9iYWwgc3RvcmFnZU1hbmFnZXIgKi9cclxuXHJcbnZhciB1cGRhdGVzTWFuYWdlciA9IChmdW5jdGlvbiB1cGRhdGVzTWFuYWdlck1vZHVsZSgpIHtcclxuICB2YXIgSlNPTl9NQVJLID0gXCJkYXRhOlwiO1xyXG5cclxuICBmdW5jdGlvbiBVcGRhdGVzTWFuYWdlcigpIHtcclxuICAgIHRoaXMucmVzcG9uc2VEYXRhID0gdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgVXBkYXRlc01hbmFnZXIucHJvdG90eXBlLmdldERhdGFGcm9tU3RvcmFnZSA9IGZ1bmN0aW9uIGdldERhdGFGcm9tU3RvcmFnZShcclxuICAgIGV4dHJhUGF0aFxyXG4gICkge1xyXG4gICAgdmFyIHhodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcblxyXG4gICAgeGh0dHAuYWRkRXZlbnRMaXN0ZW5lcihcInJlYWR5c3RhdGVjaGFuZ2VcIiwgZnVuY3Rpb24gb25EYXRhUmVjZWl2ZWQoKSB7XHJcbiAgICAgIHZhciByZXNwb25zZSA9IHhodHRwLnJlc3BvbnNlVGV4dDtcclxuXHJcbiAgICAgIGlmICh0aGlzLnN0YXR1cyAmJiB0aGlzLnJlc3BvbnNlVGV4dCkge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIHJlc3BvbnNlLmxhc3RJbmRleE9mKFwiZXZlbnQ6XCIpICE9PSByZXNwb25zZS5sYXN0SW5kZXhPZihcImV2ZW50OiBwdXRcIilcclxuICAgICAgICApIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgd2luZG93LnBvc3RNZXNzYWdlKFxyXG4gICAgICAgICAgSlNPTi5wYXJzZShcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc2xpY2UoXHJcbiAgICAgICAgICAgICAgcmVzcG9uc2UubGFzdEluZGV4T2YoSlNPTl9NQVJLKSArIEpTT05fTUFSSy5sZW5ndGgsXHJcbiAgICAgICAgICAgICAgcmVzcG9uc2UubGFzdEluZGV4T2YoXCJ9XCIpICsgMVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgICApLFxyXG4gICAgICAgICAgd2luZG93LmxvY2F0aW9uXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgeGh0dHAub3BlbihcIkdFVFwiLCBzdG9yYWdlTWFuYWdlci5nZXRTdG9yYWdlUGF0aChleHRyYVBhdGgpLCB0cnVlKTtcclxuICAgIHhodHRwLnNldFJlcXVlc3RIZWFkZXIoXCJBY2NlcHRcIiwgXCJ0ZXh0L2V2ZW50LXN0cmVhbVwiKTtcclxuICAgIHhodHRwLnNlbmQoKTtcclxuICB9O1xyXG5cclxuICByZXR1cm4gbmV3IFVwZGF0ZXNNYW5hZ2VyKCk7XHJcbn0pKCk7XHJcbi8qIGV4cG9ydGVkIGNoYXRGYWN0b3J5ICovXHJcbi8qIGdsb2JhbCBjb25maWcgKi9cclxuLyogZ2xvYmFsIERNICovXHJcbi8qIGdsb2JhbCBtZXNzYWdlRmFjdG9yeSAqL1xyXG4vKiBnbG9iYWwgc3RvcmFnZU1hbmFnZXIgSFRUUF9HRVQgSFRUUF9QT1NUIEhUVFBfUFVUICovXHJcbi8qIGdsb2JhbCB1cGRhdGVzTWFuYWdlciAqL1xyXG5cclxudmFyIGNoYXRGYWN0b3J5ID0gKGZ1bmN0aW9uIGNoYXRGYWN0b3J5TW9kdWxlKGNvbmZpZykge1xyXG4gIHZhciBVU0VSX0lEID0gXCJjaGF0LXVzZXItaWRcIjtcclxuICB2YXIgQ09MTEFQU0VEID0gXCJjaGF0LWNvbGxhcHNlZFwiO1xyXG4gIHZhciBFWFBBTkRFRCA9IFwiY2hhdC1leHBhbmRlZFwiO1xyXG4gIHZhciBDSEFUX0lURU0gPSBcImNoYXRcIjtcclxuICB2YXIgTUVTU0FHRVNfTElTVCA9IFwiY2hhdC1tZXNzYWdlc1wiO1xyXG4gIHZhciBJTlBVVF9CT1ggPSBcImNoYXQtaW5wdXQtYm94XCI7XHJcbiAgdmFyIElOUFVUX1RFWFQgPSBcImNoYXQtaW5wdXQtdHh0XCI7XHJcbiAgdmFyIENIQVRfTUVTU0FHRV9CVVRUT05fSUQgPSBcImNoYXQtbWVzc2FnZS1idXR0b25cIjtcclxuICB2YXIgVE9HR0xFX0JVVFRPTiA9IFwiY2hhdC10b2dnbGUtYnV0dG9uXCI7XHJcbiAgdmFyIEVYUEFORF9NQVJLID0gXCJbIF1cIjtcclxuICB2YXIgQ09MTEFQU0VfTUFSSyA9IFwiLVwiO1xyXG4gIHZhciBtb250aHMgPSBbXHJcbiAgICBcItGP0L3QstCw0YDRj1wiLFxyXG4gICAgXCLRhNC10LLRgNCw0LvRj1wiLFxyXG4gICAgXCLQvNCw0YDRgtCwXCIsXHJcbiAgICBcItCw0L/RgNC10LvRj1wiLFxyXG4gICAgXCLQvNCw0Y9cIixcclxuICAgIFwi0LjRjtC90Y9cIixcclxuICAgIFwi0LjRjtC70Y9cIixcclxuICAgIFwi0LDQstCz0YPRgdGC0LBcIixcclxuICAgIFwi0YHQtdC90YLRj9Cx0YDRj1wiLFxyXG4gICAgXCLQvtC60YLRj9Cx0YDRj1wiLFxyXG4gICAgXCLQvdC+0Y/QsdGA0Y9cIixcclxuICAgIFwi0LTQtdC60LDQsdGA0Y9cIlxyXG4gIF07XHJcbiAgdmFyIFJFUExZX1RJTUVPVVQgPSAxNTAwMDtcclxuICB2YXIgUEFUSF9UT19TVFlMRVNIRUVUID1cclxuICAgIFwiaHR0cHM6Ly9yYXdnaXQuY29tL0Jlc29taGVhZC9qcy0tdG91Y2hzb2Z0L2Jlc29taGVhZC10YXNrMDctYnVpbGQvdGFzay0wNy9CZXNvbWhlYWQvYnVpbGQvY3NzL2NoYXRfc3R5bGVzLmNzc1wiO1xyXG4gIHZhciBERUZBVUxUX1VTRVJfTkFNRSA9IFwi0JLRi1wiO1xyXG4gIHZhciBVU0VSX05BTUVfRklFTEQgPSBcInVzZXJOYW1lXCI7XHJcbiAgdmFyIENIQVRfU1RBVEVfRklFTEQgPSBcImNoYXRTdGF0ZVwiO1xyXG4gIHZhciBNRVNTQUdFU19GSUVMRCA9IFwibWVzc2FnZXNcIjtcclxuICB2YXIgQ09NTUFORFNfRklFTEQgPSBcImNvbW1hbmRzXCI7XHJcbiAgdmFyIFJFQURfRklFTEQgPSBcInJlYWRcIjtcclxuICB2YXIgQVNLX1VTRVJfUFJPTVBUX0lEID0gXCJjaGF0LXVzZXJuYW1lLXByb21wdC1jb250YWluZXJcIjtcclxuICB2YXIgUFJPTVBUX0lOUFVUX0lEID0gXCJjaGF0LXVzZXJuYW1lLXByb21wdC1pbnB1dFwiO1xyXG4gIHZhciBQUk9NUFRfQ09ORklSTV9CVVRUT05fSUQgPSBcImNoYXQtdXNlcm5hbWUtcHJvbXB0LWJ1dHRvblwiO1xyXG4gIHZhciBSRVFVRVNUX1RJTUVPVVQgPSAzMDAwO1xyXG4gIHZhciBaRVJPX1RJTUVPVVQgPSAwO1xyXG4gIHZhciBJUF9JTkZPX1BBVEggPSBcImh0dHBzOi8vaXBpbmZvLmlvL1wiO1xyXG4gIHZhciBJUF9BUElfUEFUSCA9IFwiaHR0cDovL2lwLWFwaS5jb20vXCI7XHJcbiAgdmFyIEdFT19JUF9QQVRIID0gXCJodHRwczovL2dlb2lwLWRiLmNvbS9cIjtcclxuXHJcbiAgdmFyIHVzZXJEYXRhO1xyXG5cclxuICBmdW5jdGlvbiBDaGF0RmFjdG9yeSgpIHt9XHJcblxyXG4gIGZ1bmN0aW9uIGdldEV4dHJhUGF0aChwYXRoKSB7XHJcbiAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oVVNFUl9JRCkgKyBcIi9cIiArIHBhdGg7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzYXZlQ2hhdFN0YXRlVG9TdG9yYWdlKHN0YXRlKSB7XHJcbiAgICBjb25maWcuY2hhdFN0YXRlID0gc3RhdGU7XHJcbiAgICBzdG9yYWdlTWFuYWdlci5zZW5kUmVxdWVzdFRvU3RvcmFnZShcclxuICAgICAgZ2V0RXh0cmFQYXRoKENIQVRfU1RBVEVfRklFTEQpLFxyXG4gICAgICBIVFRQX1BVVCxcclxuICAgICAgc3RhdGVcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjb2xsYXBzZUNoYXQoKSB7XHJcbiAgICBjb25maWcubWVzc2FnZXNMZW5ndGggPSAwO1xyXG4gICAgRE0ucmVtb3ZlQ1NTQ2xhc3MoQ0hBVF9JVEVNLCBFWFBBTkRFRCk7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhDSEFUX0lURU0sIENPTExBUFNFRCk7XHJcbiAgICBETS5nZXRET01FbGVtZW50KFRPR0dMRV9CVVRUT04pLmlubmVySFRNTCA9IEVYUEFORF9NQVJLO1xyXG4gICAgRE0ucmVtb3ZlRE9NRWxlbWVudChDSEFUX0lURU0sIE1FU1NBR0VTX0xJU1QpO1xyXG4gICAgRE0ucmVtb3ZlRE9NRWxlbWVudChDSEFUX0lURU0sIElOUFVUX0JPWCk7XHJcbiAgICBzYXZlQ2hhdFN0YXRlVG9TdG9yYWdlKENPTExBUFNFRCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBhcHBlbmRNZXNzYWdlUGFydChjb250YWluZXIsIGlubmVySFRNTCkge1xyXG4gICAgdmFyIGVsID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImRpdlwiKTtcclxuXHJcbiAgICBlbC5pbm5lckhUTUwgPSBpbm5lckhUTUw7XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KGNvbnRhaW5lciwgZWwpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYXBwZW5kRGF0ZUxlZ2VuZChjb250YWluZXIsIG1lc3NhZ2UpIHtcclxuICAgIHZhciBkYXlPZk1vbnRoID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImxlZ2VuZFwiKTtcclxuXHJcbiAgICBkYXlPZk1vbnRoLmlubmVySFRNTCA9IG1lc3NhZ2UuZGF5XHJcbiAgICAgIC50b1N0cmluZygpXHJcbiAgICAgIC5jb25jYXQoXCIgXCIpXHJcbiAgICAgIC5jb25jYXQobW9udGhzWyttZXNzYWdlLm1vbnRoXSk7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhkYXlPZk1vbnRoLCBcImNoYXQtZGF5LW9mLW1vbnRoXCIpO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChjb250YWluZXIsIGRheU9mTW9udGgpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYXBwZW5kU2luZ2xlTWVzc2FnZShjb250YWluZXIsIG1lc3NhZ2UpIHtcclxuICAgIHZhciBjb250YWluZXJJZDtcclxuICAgIHZhciBtZXNzYWdlc0NvbnRhaW5lcjtcclxuXHJcbiAgICBjb250YWluZXJJZCA9IENIQVRfSVRFTS5jb25jYXQoXCItXCIpXHJcbiAgICAgIC5jb25jYXQobWVzc2FnZS5kYXkpXHJcbiAgICAgIC5jb25jYXQoXCItXCIpXHJcbiAgICAgIC5jb25jYXQobWVzc2FnZS5tb250aCk7XHJcbiAgICBpZiAoRE0uZ2V0RE9NRWxlbWVudChjb250YWluZXJJZCkgPT09IG51bGwpIHtcclxuICAgICAgbWVzc2FnZXNDb250YWluZXIgPSBETS5jcmVhdGVET01FbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBtZXNzYWdlc0NvbnRhaW5lci5pZCA9IGNvbnRhaW5lcklkO1xyXG4gICAgICBETS5hZGRDU1NDbGFzcyhtZXNzYWdlc0NvbnRhaW5lciwgXCJjaGF0LW1lc3NhZ2VzLWNvbnRhaW5lclwiKTtcclxuICAgICAgaWYgKGNvbmZpZy5zaG93RGF0ZVRpbWUgPT09IFwidHJ1ZVwiKSB7XHJcbiAgICAgICAgRE0uYWRkQ1NTQ2xhc3MobWVzc2FnZXNDb250YWluZXIsIFwiY2hhdC1tZXNzYWdlcy1jb250YWluZXItd2l0aC10aW1lXCIpO1xyXG4gICAgICAgIGFwcGVuZERhdGVMZWdlbmQoY29udGFpbmVyLCBtZXNzYWdlKTtcclxuICAgICAgfSBlbHNlIGlmIChjb25maWcuc2hvd0RhdGVUaW1lID09PSBcImZhbHNlXCIpIHtcclxuICAgICAgICBETS5hZGRDU1NDbGFzcyhtZXNzYWdlc0NvbnRhaW5lciwgXCJjaGF0LW1lc3NhZ2VzLWNvbnRhaW5lci1uby10aW1lXCIpO1xyXG4gICAgICB9XHJcbiAgICAgIERNLmFwcGVuZERPTUVsZW1lbnQoY29udGFpbmVyLCBtZXNzYWdlc0NvbnRhaW5lcik7XHJcbiAgICB9XHJcbiAgICBtZXNzYWdlc0NvbnRhaW5lciA9IERNLmdldERPTUVsZW1lbnQoY29udGFpbmVySWQpO1xyXG4gICAgaWYgKGNvbmZpZy5zaG93RGF0ZVRpbWUgPT09IFwidHJ1ZVwiKSB7XHJcbiAgICAgIGFwcGVuZE1lc3NhZ2VQYXJ0KG1lc3NhZ2VzQ29udGFpbmVyLCBtZXNzYWdlLnRpbWUpO1xyXG4gICAgfVxyXG4gICAgYXBwZW5kTWVzc2FnZVBhcnQobWVzc2FnZXNDb250YWluZXIsIG1lc3NhZ2Uuc2VuZGVyKTtcclxuICAgIGFwcGVuZE1lc3NhZ2VQYXJ0KG1lc3NhZ2VzQ29udGFpbmVyLCBtZXNzYWdlLmJvZHkpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2hvd01lc3NhZ2VzKGNvbnRhaW5lciwgbWVzc2FnZXMpIHtcclxuICAgIHZhciBtZXNzYWdlc0tleXMgPSBPYmplY3Qua2V5cyhtZXNzYWdlcyk7XHJcbiAgICBjb25maWcubWVzc2FnZXNMZW5ndGggPSBtZXNzYWdlc0tleXMubGVuZ3RoO1xyXG4gICAgbWVzc2FnZXNLZXlzLmZvckVhY2goZnVuY3Rpb24gc2hvd01lc3NhZ2Uoa2V5KSB7XHJcbiAgICAgIGFwcGVuZFNpbmdsZU1lc3NhZ2UoY29udGFpbmVyLCBtZXNzYWdlc1trZXldKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgQ2hhdEZhY3RvcnkucHJvdG90eXBlLmFwcGVuZE1lc3NhZ2VzID0gZnVuY3Rpb24gYXBwZW5kTWVzc2FnZXMoXHJcbiAgICBjb250YWluZXIsXHJcbiAgICBtZXNzYWdlc1xyXG4gICkge1xyXG4gICAgaWYgKG1lc3NhZ2VzKSB7XHJcbiAgICAgIHNob3dNZXNzYWdlcyhjb250YWluZXIsIG1lc3NhZ2VzKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHN0b3JhZ2VNYW5hZ2VyXHJcbiAgICAgIC5zZW5kUmVxdWVzdFRvU3RvcmFnZShnZXRFeHRyYVBhdGgoTUVTU0FHRVNfRklFTEQpLCBIVFRQX0dFVCwgXCJcIilcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gc2hvd01lc3NhZ2VzSW5DaGF0KGRhdGEpIHtcclxuICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2hvd01lc3NhZ2VzKGNvbnRhaW5lciwgZGF0YSk7XHJcbiAgICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGZ1bmN0aW9uIGFwcGVuZE1lc3NhZ2VzTGlzdCgpIHtcclxuICAgIHZhciBtZXNzYWdlc0xpc3RDb250YWluZXIgPSBETS5jcmVhdGVET01FbGVtZW50KFwiZGl2XCIpO1xyXG5cclxuICAgIG1lc3NhZ2VzTGlzdENvbnRhaW5lci5pZCA9IE1FU1NBR0VTX0xJU1Q7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhtZXNzYWdlc0xpc3RDb250YWluZXIsIFwiY2hhdC1tZXNzYWdlcy1leHRlcm5hbFwiKTtcclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQoQ0hBVF9JVEVNLCBtZXNzYWdlc0xpc3RDb250YWluZXIpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gdXBkYXRlTWVzc2FnZXNMaXN0KCkge1xyXG4gICAgaWYgKGNvbmZpZy5jaGF0U3RhdGUgPT09IENPTExBUFNFRCkge1xyXG4gICAgICBzZXRUaW1lb3V0KHVwZGF0ZU1lc3NhZ2VzTGlzdCwgUkVQTFlfVElNRU9VVCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHN0b3JhZ2VNYW5hZ2VyXHJcbiAgICAgIC5zZW5kUmVxdWVzdFRvU3RvcmFnZShnZXRFeHRyYVBhdGgoTUVTU0FHRVNfRklFTEQpLCBIVFRQX0dFVCwgXCJcIilcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gb25NZXNzYWdlc1JlY2VpdmVkKGRhdGEpIHtcclxuICAgICAgICB2YXIgbWVzc2FnZXNLZXlzO1xyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KHVwZGF0ZU1lc3NhZ2VzTGlzdCwgUkVQTFlfVElNRU9VVCk7XHJcbiAgICAgICAgaWYgKCFkYXRhKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1lc3NhZ2VzS2V5cyA9IE9iamVjdC5rZXlzKGRhdGEpO1xyXG4gICAgICAgIGlmIChjb25maWcubWVzc2FnZXNMZW5ndGggPj0gbWVzc2FnZXNLZXlzLmxlbmd0aCkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtZXNzYWdlc0tleXNcclxuICAgICAgICAgIC5zbGljZShjb25maWcubWVzc2FnZXNMZW5ndGgpXHJcbiAgICAgICAgICAuZm9yRWFjaChmdW5jdGlvbiBhcHBlbmRNZXNzYWdlKGtleSkge1xyXG4gICAgICAgICAgICBhcHBlbmRTaW5nbGVNZXNzYWdlKERNLmdldERPTUVsZW1lbnQoTUVTU0FHRVNfTElTVCksIGRhdGFba2V5XSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICBjb25maWcubWVzc2FnZXNMZW5ndGggPSBtZXNzYWdlc0tleXMubGVuZ3RoO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNhdmVNZXNzYWdlKG1lc3NhZ2UpIHtcclxuICAgIHN0b3JhZ2VNYW5hZ2VyLnNlbmRSZXF1ZXN0VG9TdG9yYWdlKFxyXG4gICAgICBnZXRFeHRyYVBhdGgoTUVTU0FHRVNfRklFTEQpLFxyXG4gICAgICBIVFRQX1BPU1QsXHJcbiAgICAgIG1lc3NhZ2VcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBnZXRQb3NpdGlvbkNsYXNzKCkge1xyXG4gICAgdmFyIHBvc2l0aW9uQ2xhc3M7XHJcblxyXG4gICAgaWYgKGNvbmZpZy5wb3NpdGlvbiA9PT0gXCJsZWZ0XCIpIHtcclxuICAgICAgcG9zaXRpb25DbGFzcyA9IFwiY2hhdC1jb250YWluZXItbGVmdFwiO1xyXG4gICAgfSBlbHNlIGlmIChjb25maWcucG9zaXRpb24gPT09IFwicmlnaHRcIikge1xyXG4gICAgICBwb3NpdGlvbkNsYXNzID0gXCJjaGF0LWNvbnRhaW5lci1yaWdodFwiO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwb3NpdGlvbkNsYXNzO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY3JlYXRlUHJvbXB0TWFya3VwKGhlYWRlciwgbWVzc2FnZSwgcGxhY2Vob2xkZXIpIHtcclxuICAgIHZhciBwcm9tcHRDb250YWluZXIgPSBETS5jcmVhdGVET01FbGVtZW50KFwiZmllbGRzZXRcIik7XHJcbiAgICB2YXIgcHJvbXB0TGVnZW5kID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImxlZ2VuZFwiKTtcclxuICAgIHZhciBwcm9tcHRMYWJlbCA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJsYWJlbFwiKTtcclxuICAgIHZhciBwcm9tcHRJbnB1dCA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgIHZhciBwcm9tcHRDb25maXJtQnV0dG9uID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImJ1dHRvblwiKTtcclxuXHJcbiAgICBwcm9tcHRDb250YWluZXIuaWQgPSBBU0tfVVNFUl9QUk9NUFRfSUQ7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhcclxuICAgICAgcHJvbXB0Q29udGFpbmVyLFxyXG4gICAgICBcImNoYXQtcHJvbXB0LWNvbnRhaW5lclwiLFxyXG4gICAgICBnZXRQb3NpdGlvbkNsYXNzKClcclxuICAgICk7XHJcbiAgICBwcm9tcHRMZWdlbmQuaW5uZXJIVE1MID0gaGVhZGVyIHx8IFwi0JjQvNGPXCI7XHJcbiAgICBwcm9tcHRJbnB1dC5pZCA9IFBST01QVF9JTlBVVF9JRDtcclxuICAgIHByb21wdElucHV0LnBsYWNlaG9sZGVyID0gcGxhY2Vob2xkZXIgfHwgXCLQmNC80Y8g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPXCI7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhwcm9tcHRJbnB1dCwgXCJjaGF0LXByb21wdC1pbnB1dFwiKTtcclxuICAgIHByb21wdExhYmVsLmZvciA9IHByb21wdElucHV0LmlkO1xyXG4gICAgcHJvbXB0TGFiZWwuaW5uZXJIVE1MID0gbWVzc2FnZSB8fCBcItCf0L7QttCw0LvRg9C50YHRgtCwLCDQv9GA0LXQtNGB0YLQsNCy0YzRgtC10YHRjDpcIjtcclxuICAgIHByb21wdENvbmZpcm1CdXR0b24uaWQgPSBQUk9NUFRfQ09ORklSTV9CVVRUT05fSUQ7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhwcm9tcHRDb25maXJtQnV0dG9uLCBcImNoYXQtcHJvbXB0LWJ1dHRvblwiKTtcclxuICAgIHByb21wdENvbmZpcm1CdXR0b24uaW5uZXJIVE1MID0gXCLQodC+0YXRgNCw0L3QuNGC0YxcIjtcclxuXHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KHByb21wdENvbnRhaW5lciwgcHJvbXB0TGVnZW5kKTtcclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQocHJvbXB0Q29udGFpbmVyLCBwcm9tcHRMYWJlbCk7XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KHByb21wdENvbnRhaW5lciwgcHJvbXB0SW5wdXQpO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChwcm9tcHRDb250YWluZXIsIHByb21wdENvbmZpcm1CdXR0b24pO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChDSEFUX0lURU0sIHByb21wdENvbnRhaW5lcik7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBnZXRVc2VyTmFtZUZyb21TdG9yYWdlKCkge1xyXG4gICAgc3RvcmFnZU1hbmFnZXJcclxuICAgICAgLnNlbmRSZXF1ZXN0VG9TdG9yYWdlKGdldEV4dHJhUGF0aChVU0VSX05BTUVfRklFTEQpLCBIVFRQX0dFVCwgXCJcIilcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gc2F2ZVVzZXJOYW1lKGRhdGEpIHtcclxuICAgICAgICBjb25maWcudXNlck5hbWUgPSBkYXRhO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNldE90aGVyQ29tcG9uZW50c0F2YWlsYWJpbGl0eShpc0F2YWlsYWJsZSkge1xyXG4gICAgRE0uZ2V0RE9NRWxlbWVudChJTlBVVF9URVhUKS5kaXNhYmxlZCA9ICFpc0F2YWlsYWJsZTtcclxuICAgIERNLmdldERPTUVsZW1lbnQoQ0hBVF9NRVNTQUdFX0JVVFRPTl9JRCkuZGlzYWJsZWQgPSAhaXNBdmFpbGFibGU7XHJcbiAgICBpZiAoRE0uZ2V0RE9NRWxlbWVudChUT0dHTEVfQlVUVE9OKSAhPT0gbnVsbCkge1xyXG4gICAgICBETS5nZXRET01FbGVtZW50KFRPR0dMRV9CVVRUT04pLmRpc2FibGVkID0gIWlzQXZhaWxhYmxlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYXNrVXNlck5hbWUoKSB7XHJcbiAgICBjcmVhdGVQcm9tcHRNYXJrdXAoKTtcclxuICAgIHNldE90aGVyQ29tcG9uZW50c0F2YWlsYWJpbGl0eShmYWxzZSk7XHJcbiAgICBETS5hZGRMaXN0ZW5lcihQUk9NUFRfQ09ORklSTV9CVVRUT05fSUQsIFwiY2xpY2tcIiwgZnVuY3Rpb24gc2F2ZVVzZXJOYW1lKCkge1xyXG4gICAgICB2YXIgdXNlck5hbWUgPSBETS5nZXRET01FbGVtZW50KFBST01QVF9JTlBVVF9JRCkudmFsdWU7XHJcbiAgICAgIGlmICh1c2VyTmFtZS5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbmZpZy51c2VyTmFtZSA9IHVzZXJOYW1lO1xyXG4gICAgICBETS5yZW1vdmVET01FbGVtZW50KENIQVRfSVRFTSwgQVNLX1VTRVJfUFJPTVBUX0lEKTtcclxuICAgICAgc2V0T3RoZXJDb21wb25lbnRzQXZhaWxhYmlsaXR5KHRydWUpO1xyXG4gICAgICBzdG9yYWdlTWFuYWdlci5zZW5kUmVxdWVzdFRvU3RvcmFnZShcclxuICAgICAgICBnZXRFeHRyYVBhdGgoVVNFUl9OQU1FX0ZJRUxEKSxcclxuICAgICAgICBIVFRQX1BVVCxcclxuICAgICAgICBjb25maWcudXNlck5hbWVcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2V0VXNlck5hbWUoKSB7XHJcbiAgICBnZXRVc2VyTmFtZUZyb21TdG9yYWdlKCk7XHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uIGlmTm90QXNzaWduKCkge1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgY29uZmlnLnVzZXJOYW1lICE9PSBudWxsICYmXHJcbiAgICAgICAgY29uZmlnLnVzZXJOYW1lICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICBjb25maWcudXNlck5hbWUgIT09IFwiXCJcclxuICAgICAgKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjb25maWcucmVxdWlyZU5hbWUgPT09IFwidHJ1ZVwiKSB7XHJcbiAgICAgICAgYXNrVXNlck5hbWUoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25maWcudXNlck5hbWUgPSBERUZBVUxUX1VTRVJfTkFNRTtcclxuICAgICAgICBzdG9yYWdlTWFuYWdlci5zZW5kUmVxdWVzdFRvU3RvcmFnZShcclxuICAgICAgICAgIGdldEV4dHJhUGF0aChVU0VSX05BTUVfRklFTEQpLFxyXG4gICAgICAgICAgSFRUUF9QVVQsXHJcbiAgICAgICAgICBjb25maWcudXNlck5hbWVcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9LCBSRVFVRVNUX1RJTUVPVVQpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoKSB7XHJcbiAgICB2YXIgaW5wdXRUZXh0QXJlYSA9IERNLmdldERPTUVsZW1lbnQoSU5QVVRfVEVYVCk7XHJcbiAgICB2YXIgbWVzc2FnZTtcclxuXHJcbiAgICBpZiAoaW5wdXRUZXh0QXJlYS52YWx1ZSA9PT0gXCJcIikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBtZXNzYWdlID0gbWVzc2FnZUZhY3RvcnkuZ2V0TWVzc2FnZShcclxuICAgICAgbmV3IERhdGUoKSxcclxuICAgICAgY29uZmlnLnVzZXJOYW1lLmNvbmNhdChcIjpcIiksXHJcbiAgICAgIGlucHV0VGV4dEFyZWEudmFsdWVcclxuICAgICk7XHJcbiAgICBpbnB1dFRleHRBcmVhLnZhbHVlID0gXCJcIjtcclxuICAgIHNhdmVNZXNzYWdlKG1lc3NhZ2UpO1xyXG4gICAgc3RvcmFnZU1hbmFnZXIuc2VuZFJlcXVlc3RUb1N0b3JhZ2UoXHJcbiAgICAgIGdldEV4dHJhUGF0aChSRUFEX0ZJRUxEKSxcclxuICAgICAgSFRUUF9QVVQsXHJcbiAgICAgIGZhbHNlXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYXBwZW5kSW5wdXRCb3goKSB7XHJcbiAgICB2YXIgaW5wdXRNZXNzYWdlQ29udGFpbmVyID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImRpdlwiKTtcclxuICAgIHZhciBpbnB1dFRleHRBcmVhID0gRE0uY3JlYXRlRE9NRWxlbWVudChcInRleHRhcmVhXCIpO1xyXG4gICAgdmFyIG1lc3NhZ2VCdXR0b24gPSBETS5jcmVhdGVET01FbGVtZW50KFwiYnV0dG9uXCIpO1xyXG5cclxuICAgIGlucHV0TWVzc2FnZUNvbnRhaW5lci5pZCA9IElOUFVUX0JPWDtcclxuICAgIERNLmFkZENTU0NsYXNzKGlucHV0TWVzc2FnZUNvbnRhaW5lciwgXCJjaGF0LWlucHV0LWNvbnRhaW5lclwiKTtcclxuICAgIGlucHV0VGV4dEFyZWEuaWQgPSBJTlBVVF9URVhUO1xyXG4gICAgRE0uYWRkQ1NTQ2xhc3MoaW5wdXRUZXh0QXJlYSwgXCJjaGF0LWlucHV0LXRleHRhcmVhXCIpO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChpbnB1dE1lc3NhZ2VDb250YWluZXIsIGlucHV0VGV4dEFyZWEpO1xyXG4gICAgbWVzc2FnZUJ1dHRvbi5pZCA9IENIQVRfTUVTU0FHRV9CVVRUT05fSUQ7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhtZXNzYWdlQnV0dG9uLCBcImNoYXQtbWVzc2FnZS1idXR0b25cIik7XHJcbiAgICBtZXNzYWdlQnV0dG9uLmlubmVySFRNTCA9IFwi0J7RgtC/0YDQsNCy0LjRgtGMXCI7XHJcbiAgICBETS5hZGRMaXN0ZW5lcihtZXNzYWdlQnV0dG9uLCBcImNsaWNrXCIsIHNlbmRNZXNzYWdlKTtcclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQoaW5wdXRNZXNzYWdlQ29udGFpbmVyLCBtZXNzYWdlQnV0dG9uKTtcclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQoQ0hBVF9JVEVNLCBpbnB1dE1lc3NhZ2VDb250YWluZXIpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZXhwYW5kQ2hhdCgpIHtcclxuICAgIERNLnJlbW92ZUNTU0NsYXNzKENIQVRfSVRFTSwgQ09MTEFQU0VEKTtcclxuICAgIERNLmFkZENTU0NsYXNzKENIQVRfSVRFTSwgRVhQQU5ERUQpO1xyXG4gICAgaWYgKGNvbmZpZy5hbGxvd01pbmltaXplID09PSBcInRydWVcIikge1xyXG4gICAgICBETS5nZXRET01FbGVtZW50KFRPR0dMRV9CVVRUT04pLmlubmVySFRNTCA9IENPTExBUFNFX01BUks7XHJcbiAgICB9XHJcbiAgICBhcHBlbmRNZXNzYWdlc0xpc3QoKTtcclxuICAgIGlmICh1c2VyRGF0YSAmJiB1c2VyRGF0YS5tZXNzYWdlcykge1xyXG4gICAgICBzaG93TWVzc2FnZXMoRE0uZ2V0RE9NRWxlbWVudChNRVNTQUdFU19MSVNUKSwgdXNlckRhdGEubWVzc2FnZXMpO1xyXG4gICAgfVxyXG4gICAgYXBwZW5kSW5wdXRCb3goKTtcclxuICAgIGlmIChcclxuICAgICAgY29uZmlnLnVzZXJOYW1lID09PSBcIlwiIHx8XHJcbiAgICAgIGNvbmZpZy51c2VyTmFtZSA9PT0gbnVsbCB8fFxyXG4gICAgICBjb25maWcudXNlck5hbWUgPT09IHVuZGVmaW5lZFxyXG4gICAgKSB7XHJcbiAgICAgIHNldFVzZXJOYW1lKCk7XHJcbiAgICB9XHJcbiAgICBzYXZlQ2hhdFN0YXRlVG9TdG9yYWdlKEVYUEFOREVEKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG1hcmtVc2VyQ29tbWFuZEFzU2hvd24odXNlckNvbW1hbmQsIGNvbW1hbmRLZXkpIHtcclxuICAgIHVzZXJDb21tYW5kLnNob3duID0gdHJ1ZTtcclxuICAgIHN0b3JhZ2VNYW5hZ2VyLnNlbmRSZXF1ZXN0VG9TdG9yYWdlKFxyXG4gICAgICBnZXRFeHRyYVBhdGgoQ09NTUFORFNfRklFTEQgKyBcIi9cIiArIGNvbW1hbmRLZXkgKyBcIi9zaG93blwiKSxcclxuICAgICAgSFRUUF9QVVQsXHJcbiAgICAgIHVzZXJDb21tYW5kLnNob3duXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2F2ZVVzZXJDb21tYW5kUmVzdWx0KHVzZXJDb21tYW5kLCBjb21tYW5kS2V5LCByZXN1bHQpIHtcclxuICAgIHN0b3JhZ2VNYW5hZ2VyLnNlbmRSZXF1ZXN0VG9TdG9yYWdlKFxyXG4gICAgICBnZXRFeHRyYVBhdGgoQ09NTUFORFNfRklFTEQgKyBcIi9cIiArIGNvbW1hbmRLZXkgKyBcIi9yZXN1bHRcIiksXHJcbiAgICAgIEhUVFBfUFVULFxyXG4gICAgICByZXN1bHRcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBhc2tVc2VyKHVzZXJDb21tYW5kLCBjb21tYW5kS2V5KSB7XHJcbiAgICBpZiAoRE0uZ2V0RE9NRWxlbWVudChBU0tfVVNFUl9QUk9NUFRfSUQpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIG1hcmtVc2VyQ29tbWFuZEFzU2hvd24odXNlckNvbW1hbmQsIGNvbW1hbmRLZXkpO1xyXG4gICAgaWYgKGNvbmZpZy5jaGF0U3RhdGUgPT09IENPTExBUFNFRCkge1xyXG4gICAgICBleHBhbmRDaGF0KCk7XHJcbiAgICB9XHJcbiAgICBjcmVhdGVQcm9tcHRNYXJrdXAuYXBwbHkodGhpcywgdXNlckNvbW1hbmQucGFyYW1zKTtcclxuICAgIERNLmFkZExpc3RlbmVyKFBST01QVF9DT05GSVJNX0JVVFRPTl9JRCwgXCJjbGlja1wiLCBmdW5jdGlvbiBzYXZlUmVzdWx0KCkge1xyXG4gICAgICBpZiAoIURNLmdldERPTUVsZW1lbnQoUFJPTVBUX0lOUFVUX0lEKS52YWx1ZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBzYXZlVXNlckNvbW1hbmRSZXN1bHQoXHJcbiAgICAgICAgdXNlckNvbW1hbmQsXHJcbiAgICAgICAgY29tbWFuZEtleSxcclxuICAgICAgICBETS5nZXRET01FbGVtZW50KFBST01QVF9JTlBVVF9JRCkudmFsdWVcclxuICAgICAgKTtcclxuICAgICAgRE0ucmVtb3ZlRE9NRWxlbWVudChDSEFUX0lURU0sIEFTS19VU0VSX1BST01QVF9JRCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHJlcXVlc3RTcGVjaWZpZWRTZXJ2aWNlKHBhdGgsIHVzZXJDb21tYW5kLCBjb21tYW5kS2V5KSB7XHJcbiAgICBzdG9yYWdlTWFuYWdlci5nZXREYXRhRnJvbVNlcnZpY2UocGF0aCkudGhlbihmdW5jdGlvbiBzYXZlUmVzdWx0KGRhdGEpIHtcclxuICAgICAgc2F2ZVVzZXJDb21tYW5kUmVzdWx0KFxyXG4gICAgICAgIHVzZXJDb21tYW5kLFxyXG4gICAgICAgIGNvbW1hbmRLZXksXHJcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgMilcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0VXNlckluZm8odXNlckNvbW1hbmQsIGNvbW1hbmRLZXkpIHtcclxuICAgIHZhciBzZXJ2aWNlID0gdXNlckNvbW1hbmQucGFyYW1zLnNoaWZ0KCk7XHJcblxyXG4gICAgbWFya1VzZXJDb21tYW5kQXNTaG93bih1c2VyQ29tbWFuZCwgY29tbWFuZEtleSk7XHJcbiAgICBzd2l0Y2ggKHNlcnZpY2UpIHtcclxuICAgICAgY2FzZSBJUF9JTkZPX1BBVEg6XHJcbiAgICAgICAgcmVxdWVzdFNwZWNpZmllZFNlcnZpY2Uoc2VydmljZSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgSVBfQVBJX1BBVEg6XHJcbiAgICAgICAgcmVxdWVzdFNwZWNpZmllZFNlcnZpY2Uoc2VydmljZSArIFwianNvblwiKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBHRU9fSVBfUEFUSDpcclxuICAgICAgICByZXF1ZXN0U3BlY2lmaWVkU2VydmljZShzZXJ2aWNlICsgXCJqc29uL1wiKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHJ1blVzZXJDb21tYW5kKHVzZXJDb21tYW5kLCBjb21tYW5kS2V5KSB7XHJcbiAgICB2YXIgY29tbWFuZE1ldGhvZDtcclxuXHJcbiAgICBpZiAodXNlckNvbW1hbmQuc2hvd24pIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHN3aXRjaCAodXNlckNvbW1hbmQudHlwZSkge1xyXG4gICAgICBjYXNlIFwidXNlci1pbmZvXCI6XHJcbiAgICAgICAgY29tbWFuZE1ldGhvZCA9IGdldFVzZXJJbmZvO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIFwiYXNrLXVzZXJcIjpcclxuICAgICAgICBjb21tYW5kTWV0aG9kID0gYXNrVXNlcjtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgIH1cclxuICAgIHNldFRpbWVvdXQoY29tbWFuZE1ldGhvZC5iaW5kKHRoaXMsIHVzZXJDb21tYW5kLCBjb21tYW5kS2V5KSwgWkVST19USU1FT1VUKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGFwcGx5VXBkYXRlcyhldmVudCkge1xyXG4gICAgdmFyIGRhdGEgPSBldmVudC5kYXRhLmRhdGE7XHJcbiAgICB2YXIgcGF0aCA9IGV2ZW50LmRhdGEucGF0aDtcclxuICAgIHZhciBwYXRoRnJhZ21lbnRzID0gcGF0aC5zcGxpdChcIi9cIikuc2xpY2UoMSk7XHJcbiAgICB2YXIgZGF0YUtleTtcclxuXHJcbiAgICBpZiAocGF0aCA9PT0gXCIvXCIpIHtcclxuICAgICAgdXNlckRhdGEgPSBkYXRhO1xyXG4gICAgICBpZiAoIXVzZXJEYXRhLmNvbW1hbmRzKSB7XHJcbiAgICAgICAgdXNlckRhdGEuY29tbWFuZHMgPSB7fTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoY29uZmlnLmNoYXRTdGF0ZSA9PT0gQ09MTEFQU0VEKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGNoYXRGYWN0b3J5LmFwcGVuZE1lc3NhZ2VzKFxyXG4gICAgICAgIERNLmdldERPTUVsZW1lbnQoTUVTU0FHRVNfTElTVCksXHJcbiAgICAgICAgdXNlckRhdGEubWVzc2FnZXNcclxuICAgICAgKTtcclxuICAgICAgaWYgKHVzZXJEYXRhLmNvbW1hbmRzKSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXModXNlckRhdGEuY29tbWFuZHMpLmZvckVhY2goZnVuY3Rpb24gcnVuQ29tbWFuZChjb21tYW5kS2V5KSB7XHJcbiAgICAgICAgICBydW5Vc2VyQ29tbWFuZCh1c2VyRGF0YS5jb21tYW5kc1tjb21tYW5kS2V5XSwgY29tbWFuZEtleSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHN3aXRjaCAocGF0aEZyYWdtZW50cy5zaGlmdCgpKSB7XHJcbiAgICAgIGNhc2UgTUVTU0FHRVNfRklFTEQ6XHJcbiAgICAgICAgdXNlckRhdGEubWVzc2FnZXNbcGF0aEZyYWdtZW50cy5zaGlmdCgpXSA9IGRhdGE7XHJcbiAgICAgICAgaWYgKGRhdGEuc2VuZGVyLmluZGV4T2YoY29uZmlnLnVzZXJOYW1lKSAhPT0gLTEpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNvbmZpZy5jaGF0U3RhdGUgPT09IENPTExBUFNFRCkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhcHBlbmRTaW5nbGVNZXNzYWdlKERNLmdldERPTUVsZW1lbnQoTUVTU0FHRVNfTElTVCksIGRhdGEpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIENPTU1BTkRTX0ZJRUxEOlxyXG4gICAgICAgIGRhdGFLZXkgPSBwYXRoRnJhZ21lbnRzLnNoaWZ0KCk7XHJcbiAgICAgICAgaWYgKHBhdGhGcmFnbWVudHMuc2hpZnQoKSkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB1c2VyRGF0YS5jb21tYW5kc1tkYXRhS2V5XSA9IGRhdGE7XHJcbiAgICAgICAgcnVuVXNlckNvbW1hbmQoZGF0YSwgZGF0YUtleSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiB1cGRhdGVDb21tYW5kcygpIHtcclxuICAgIHN0b3JhZ2VNYW5hZ2VyXHJcbiAgICAgIC5zZW5kUmVxdWVzdFRvU3RvcmFnZShnZXRFeHRyYVBhdGgoQ09NTUFORFNfRklFTEQpLCBIVFRQX0dFVCwgXCJcIilcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gb25Db21tYW5kc1JlY2VpdmVkKGRhdGEpIHtcclxuICAgICAgICB2YXIgY29tbWFuZHNLZXlzO1xyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KHVwZGF0ZUNvbW1hbmRzLCBSRVBMWV9USU1FT1VUKTtcclxuICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29tbWFuZHNLZXlzID0gT2JqZWN0LmtleXMoZGF0YSk7XHJcbiAgICAgICAgaWYgKGNvbmZpZy5jb21tYW5kc0xlbmd0aCA+PSBjb21tYW5kc0tleXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbW1hbmRzS2V5c1xyXG4gICAgICAgICAgLnNsaWNlKGNvbmZpZy5jb21tYW5kc0xlbmd0aClcclxuICAgICAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uIHJ1bkNvbW1hbmQoa2V5KSB7XHJcbiAgICAgICAgICAgIHJ1blVzZXJDb21tYW5kKGRhdGFba2V5XSwga2V5KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIGNvbmZpZy5jb21tYW5kc0xlbmd0aCA9IGNvbW1hbmRzS2V5cy5sZW5ndGg7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgQ2hhdEZhY3RvcnkucHJvdG90eXBlLnN1YnNjcmliZU9uVXBkYXRlcyA9IGZ1bmN0aW9uIHN1YnNjcmliZU9uVXBkYXRlcygpIHtcclxuICAgIGlmIChjb25maWcudXBkYXRlcyA9PT0gXCJyZWZldGNoXCIpIHtcclxuICAgICAgdXBkYXRlTWVzc2FnZXNMaXN0KCk7XHJcbiAgICAgIHVwZGF0ZUNvbW1hbmRzKCk7XHJcbiAgICB9IGVsc2UgaWYgKGNvbmZpZy51cGRhdGVzID09PSBcImxvbmdQb2xsaW5nXCIpIHtcclxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIGFwcGx5VXBkYXRlcyk7XHJcbiAgICAgIHVwZGF0ZXNNYW5hZ2VyLmdldERhdGFGcm9tU3RvcmFnZShnZXRFeHRyYVBhdGgoXCJcIikpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGZ1bmN0aW9uIGdldENoYXRTdGF0ZUZyb21TdG9yYWdlKCkge1xyXG4gICAgc3RvcmFnZU1hbmFnZXJcclxuICAgICAgLnNlbmRSZXF1ZXN0VG9TdG9yYWdlKGdldEV4dHJhUGF0aChDSEFUX1NUQVRFX0ZJRUxEKSwgSFRUUF9HRVQsIFwiXCIpXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uIHNhdmVDaGF0U3RhdGUoZGF0YSkge1xyXG4gICAgICAgIGNvbmZpZy5jaGF0U3RhdGUgPSBkYXRhO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGluaXRDaGF0U3RhdGUoKSB7XHJcbiAgICBnZXRDaGF0U3RhdGVGcm9tU3RvcmFnZSgpO1xyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiByZXNvbHZlQ2hhdFN0YXRlKCkge1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgY29uZmlnLmNoYXRTdGF0ZSA9PT0gbnVsbCB8fFxyXG4gICAgICAgIGNvbmZpZy5jaGF0U3RhdGUgPT09IHVuZGVmaW5lZCB8fFxyXG4gICAgICAgIGNvbmZpZy5jaGF0U3RhdGUgPT09IFwiXCJcclxuICAgICAgKSB7XHJcbiAgICAgICAgc2F2ZUNoYXRTdGF0ZVRvU3RvcmFnZShDT0xMQVBTRUQpO1xyXG4gICAgICB9IGVsc2UgaWYgKGNvbmZpZy5jaGF0U3RhdGUgPT09IEVYUEFOREVEKSB7XHJcbiAgICAgICAgZXhwYW5kQ2hhdCgpO1xyXG4gICAgICB9XHJcbiAgICAgIERNLmFkZENTU0NsYXNzKENIQVRfSVRFTSwgY29uZmlnLmNoYXRTdGF0ZSk7XHJcbiAgICB9LCBSRVFVRVNUX1RJTUVPVVQpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY2hhbmdlQ2hhdFN0YXRlKCkge1xyXG4gICAgc3dpdGNoIChjb25maWcuY2hhdFN0YXRlKSB7XHJcbiAgICAgIGNhc2UgQ09MTEFQU0VEOlxyXG4gICAgICAgIGV4cGFuZENoYXQoKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBFWFBBTkRFRDpcclxuICAgICAgICBjb2xsYXBzZUNoYXQoKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgICBcIlVuZXhwZWN0ZWQga2V5L3ZhbHVlIHBhaXI6IFwiICsgQ0hBVF9JVEVNICsgXCIvXCIgKyBjb25maWcuY2hhdFN0YXRlXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIENoYXRGYWN0b3J5LnByb3RvdHlwZS5hcHBlbmRTdHlsZXNoZWV0ID0gZnVuY3Rpb24gYXBwZW5kU3R5bGVzaGVldCgpIHtcclxuICAgIHZhciBzdHlsZUVsZW1lbnQgPSBETS5jcmVhdGVET01FbGVtZW50KFwibGlua1wiKTtcclxuXHJcbiAgICBzdHlsZUVsZW1lbnQucmVsID0gXCJzdHlsZXNoZWV0XCI7XHJcbiAgICBzdHlsZUVsZW1lbnQudHlwZSA9IFwidGV4dC9jc3NcIjtcclxuICAgIHN0eWxlRWxlbWVudC5ocmVmID0gUEFUSF9UT19TVFlMRVNIRUVUO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChkb2N1bWVudC5oZWFkLCBzdHlsZUVsZW1lbnQpO1xyXG4gIH07XHJcblxyXG4gIGZ1bmN0aW9uIGFwcGVuZFRvZ2dsZUJ1dHRvbihjb250YWluZXIpIHtcclxuICAgIHZhciB0b2dnbGVCdXR0b24gPSBETS5jcmVhdGVET01FbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgRE0uYWRkQ1NTQ2xhc3ModG9nZ2xlQnV0dG9uLCBUT0dHTEVfQlVUVE9OKTtcclxuICAgIHRvZ2dsZUJ1dHRvbi5pZCA9IFRPR0dMRV9CVVRUT047XHJcbiAgICB0b2dnbGVCdXR0b24uaW5uZXJIVE1MID1cclxuICAgICAgY29uZmlnLmNoYXRTdGF0ZSA9PT0gRVhQQU5ERUQgPyBDT0xMQVBTRV9NQVJLIDogRVhQQU5EX01BUks7XHJcbiAgICBETS5hZGRMaXN0ZW5lcih0b2dnbGVCdXR0b24sIFwiY2xpY2tcIiwgY2hhbmdlQ2hhdFN0YXRlKTtcclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQoY29udGFpbmVyLCB0b2dnbGVCdXR0b24pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2V0RHJhZ0hhbmRsZXIoY29udGFpbmVyKSB7XHJcbiAgICBmdW5jdGlvbiBnZXRDb29yZGluYXRlcyhlbGVtKSB7XHJcbiAgICAgIHZhciBib3ggPSBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHRvcDogYm94LnRvcCArIHdpbmRvdy5wYWdlWU9mZnNldCxcclxuICAgICAgICBsZWZ0OiBib3gubGVmdCArIHdpbmRvdy5wYWdlWE9mZnNldFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIERNLmFkZExpc3RlbmVyKGNvbnRhaW5lciwgXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24gb25Nb3VzZURvd24oZXZlbnQpIHtcclxuICAgICAgdmFyIGNoYXQgPSBETS5nZXRET01FbGVtZW50KENIQVRfSVRFTSk7XHJcbiAgICAgIHZhciBjb29yZGluYXRlcyA9IGdldENvb3JkaW5hdGVzKGNoYXQpO1xyXG4gICAgICB2YXIgc2hpZnRYID0gZXZlbnQucGFnZVggLSBjb29yZGluYXRlcy5sZWZ0O1xyXG4gICAgICB2YXIgc2hpZnRZID0gZXZlbnQucGFnZVkgLSBjb29yZGluYXRlcy50b3A7XHJcbiAgICAgIHZhciBtb3VzZU1vdmVIYW5kbGVyO1xyXG4gICAgICB2YXIgbW91c2VVcEhhbmRsZXI7XHJcblxyXG4gICAgICBpZiAoZXZlbnQudGFyZ2V0LnRhZ05hbWUgPT09IFwiQlVUVE9OXCIpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIG1vdmVBdChlKSB7XHJcbiAgICAgICAgY2hhdC5zdHlsZS5sZWZ0ID0gZS5wYWdlWCAtIHNoaWZ0WCArIFwicHhcIjtcclxuICAgICAgICBjaGF0LnN0eWxlLnRvcCA9IGUucGFnZVkgLSBzaGlmdFkgKyBcInB4XCI7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIG1vdXNlTW92ZUhhbmRsZXIgPSBmdW5jdGlvbiBvbk1vdXNlTW92ZShlKSB7XHJcbiAgICAgICAgbW92ZUF0KGUpO1xyXG4gICAgICB9O1xyXG4gICAgICBtb3VzZVVwSGFuZGxlciA9IGZ1bmN0aW9uIG9uTW91c2VVcCgpIHtcclxuICAgICAgICBETS5yZW1vdmVMaXN0ZW5lcihkb2N1bWVudCwgXCJtb3VzZW1vdmVcIiwgbW91c2VNb3ZlSGFuZGxlcik7XHJcbiAgICAgICAgRE0ucmVtb3ZlTGlzdGVuZXIoY29udGFpbmVyLCBcIm1vdXNldXBcIiwgbW91c2VVcEhhbmRsZXIpO1xyXG4gICAgICB9O1xyXG4gICAgICBtb3ZlQXQoZXZlbnQpO1xyXG4gICAgICBETS5hZGRMaXN0ZW5lcihkb2N1bWVudCwgXCJtb3VzZW1vdmVcIiwgbW91c2VNb3ZlSGFuZGxlcik7XHJcbiAgICAgIERNLmFkZExpc3RlbmVyKGNvbnRhaW5lciwgXCJtb3VzZXVwXCIsIG1vdXNlVXBIYW5kbGVyKTtcclxuICAgIH0pO1xyXG5cclxuICAgIERNLmFkZExpc3RlbmVyKGNvbnRhaW5lciwgXCJkcmFnc3RhcnRcIiwgZnVuY3Rpb24gb25EcmFnU3RhcnQoKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgQ2hhdEZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZUNoYXRNYXJrdXAgPSBmdW5jdGlvbiBjcmVhdGVDaGF0TWFya3VwKCkge1xyXG4gICAgdmFyIGNvbnRhaW5lciA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJmaWVsZHNldFwiKTtcclxuICAgIHZhciBsZWdlbmQgPSBETS5jcmVhdGVET01FbGVtZW50KFwibGVnZW5kXCIpO1xyXG4gICAgdmFyIHRvZ2dsZUJ1dHRvbkNvbnRhaW5lciA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJkaXZcIik7XHJcblxyXG4gICAgY29udGFpbmVyLmlkID0gQ0hBVF9JVEVNO1xyXG4gICAgRE0uYWRkQ1NTQ2xhc3MoXHJcbiAgICAgIGNvbnRhaW5lcixcclxuICAgICAgXCJjaGF0LWNvbnRhaW5lclwiLFxyXG4gICAgICBnZXRQb3NpdGlvbkNsYXNzKCksXHJcbiAgICAgIGNvbmZpZy5jc3NDbGFzc1xyXG4gICAgKTtcclxuICAgIGxlZ2VuZC5pbm5lckhUTUwgPSBjb25maWcuY2hhdFRpdGxlO1xyXG4gICAgRE0uYWRkQ1NTQ2xhc3MobGVnZW5kLCBcImNoYXQtbGVnZW5kXCIpO1xyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGxlZ2VuZCk7XHJcbiAgICBETS5hZGRDU1NDbGFzcyh0b2dnbGVCdXR0b25Db250YWluZXIsIFwiY2hhdC10b2dnbGUtYnV0dG9uLWNvbnRhaW5lclwiKTtcclxuICAgIGlmIChjb25maWcuYWxsb3dEcmFnID09PSBcInRydWVcIikge1xyXG4gICAgICBETS5hZGRDU1NDbGFzcyhcclxuICAgICAgICB0b2dnbGVCdXR0b25Db250YWluZXIsXHJcbiAgICAgICAgXCJjaGF0LXRvZ2dsZS1idXR0b24tY29udGFpbmVyLWRyYWdcIlxyXG4gICAgICApO1xyXG4gICAgICBzZXREcmFnSGFuZGxlcih0b2dnbGVCdXR0b25Db250YWluZXIpO1xyXG4gICAgfVxyXG4gICAgaWYgKGNvbmZpZy5hbGxvd01pbmltaXplID09PSBcInRydWVcIikge1xyXG4gICAgICBhcHBlbmRUb2dnbGVCdXR0b24odG9nZ2xlQnV0dG9uQ29udGFpbmVyKTtcclxuICAgIH0gZWxzZSBpZiAoY29uZmlnLmFsbG93TWluaW1pemUgPT09IFwiZmFsc2VcIikge1xyXG4gICAgICBzYXZlQ2hhdFN0YXRlVG9TdG9yYWdlKEVYUEFOREVEKTtcclxuICAgIH1cclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQoY29udGFpbmVyLCB0b2dnbGVCdXR0b25Db250YWluZXIpO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChkb2N1bWVudC5ib2R5LCBjb250YWluZXIpO1xyXG4gICAgaW5pdENoYXRTdGF0ZSgpO1xyXG4gIH07XHJcblxyXG4gIGZ1bmN0aW9uIGdldFBhcmFtc0Zyb21SZXF1ZXN0KCkge1xyXG4gICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjO1xyXG4gICAgcmV0dXJuIHNjcmlwdFxyXG4gICAgICAuc3Vic3RyKHNjcmlwdC5pbmRleE9mKFwiP1wiKSArIDEpXHJcbiAgICAgIC5zcGxpdChcIiZcIilcclxuICAgICAgLnJlZHVjZShmdW5jdGlvbiByZWR1Y2VyKHBhcmFtLCBlbCkge1xyXG4gICAgICAgIHZhciBwYXJ0cyA9IGVsLnNwbGl0KFwiPVwiKTtcclxuICAgICAgICB2YXIgdmFsdWUgPSBkZWNvZGVVUklDb21wb25lbnQocGFydHNbMV0pO1xyXG4gICAgICAgIHBhcmFtW2RlY29kZVVSSUNvbXBvbmVudChwYXJ0c1swXSldID0gdmFsdWUuc3Vic3RyKDEsIHZhbHVlLmxlbmd0aCAtIDIpO1xyXG4gICAgICAgIHJldHVybiBwYXJhbTtcclxuICAgICAgfSwge30pO1xyXG4gIH1cclxuXHJcbiAgQ2hhdEZhY3RvcnkucHJvdG90eXBlLnNldENvbmZpZyA9IGZ1bmN0aW9uIHNldENvbmZpZygpIHtcclxuICAgIHZhciByZXF1ZXN0Q29uZmlnID0gZ2V0UGFyYW1zRnJvbVJlcXVlc3QoKTtcclxuICAgIHZhciBwcm9wZXJ0eVZhbHVlO1xyXG5cclxuICAgIE9iamVjdC5rZXlzKHJlcXVlc3RDb25maWcpLmZvckVhY2goZnVuY3Rpb24gYXBwbHlQcm9wZXJ0aWVzKGtleSkge1xyXG4gICAgICBwcm9wZXJ0eVZhbHVlID0gcmVxdWVzdENvbmZpZ1trZXldO1xyXG4gICAgICBpZiAocHJvcGVydHlWYWx1ZSAhPT0gXCJcIikge1xyXG4gICAgICAgIGNvbmZpZ1trZXldID0gcHJvcGVydHlWYWx1ZTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgQ2hhdEZhY3RvcnkucHJvdG90eXBlLnNldFVuaXF1ZVVzZXJJRCA9IGZ1bmN0aW9uIHNldFVuaXF1ZVVzZXJJRCgpIHtcclxuICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShVU0VSX0lEKSA9PT0gbnVsbCkge1xyXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShVU0VSX0lELCBcInVzZXJcIi5jb25jYXQoRGF0ZS5ub3coKS50b1N0cmluZygpKSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIG5ldyBDaGF0RmFjdG9yeSgpO1xyXG59KShjb25maWcpO1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGZ1bmN0aW9uIGluaXRQYWdlKCkge1xyXG4gIGNoYXRGYWN0b3J5LmFwcGVuZFN0eWxlc2hlZXQoKTtcclxuICBjaGF0RmFjdG9yeS5zZXRVbmlxdWVVc2VySUQoKTtcclxuICBjaGF0RmFjdG9yeS5jcmVhdGVDaGF0TWFya3VwKCk7XHJcbiAgc2V0VGltZW91dChjaGF0RmFjdG9yeS5zdWJzY3JpYmVPblVwZGF0ZXMsIE1BUktVUF9USU1FT1VUKTtcclxufSk7XHJcblxyXG5jaGF0RmFjdG9yeS5zZXRDb25maWcoKTsiXX0=
