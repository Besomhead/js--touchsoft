var config={chatTitle:"Чат",chatState:"",userName:"",chatURL:"https://besomhead-chat.firebaseio.com/",cssClass:"chat-container",position:"right",allowMinimize:"true",allowDrag:"false",requireName:"false",showDateTime:"true",requests:"fetch",messagesLength:"0"},DM=function(){return this.getDOMElement=function(e){return"string"==typeof e?document.getElementById(e):e},this.getDOMChildrenByTag=function(e,t){return Array.from(this.getDOMElement(e).getElementsByTagName(t))},this.getDOMChildrenByClass=function(e,t){return Array.from(this.getDOMElement(e).getElementsByClassName(t))},this.createDOMElement=document.createElement.bind(document),this.appendDOMElement=function(e,t){this.getDOMElement(e).appendChild(t)},this.removeDOMElement=function(e,t){this.getDOMElement(e).removeChild(this.getDOMElement(t))},this.addListener=function(e,t,n){this.getDOMElement(e).addEventListener(t,n)},this.removeListener=function(e,t,n){this.getDOMElement(e).removeEventListener(t,n)},this.addCSSClass=function(t){var n=this;Array.from(arguments).slice(1).forEach(function(e){n.getDOMElement(t).classList.add(e)})},this.removeCSSClass=function(e,t){this.getDOMElement(e).classList.remove(t)},this}(),messageFactory=function(){function a(e,t,n){var a,s,r;this.day=e.getDate(),this.month=e.getMonth(),this.time=(s=(a=e).getHours(),r=a.getMinutes(),(s<10?"0":"").concat(s.toString()).concat(":").concat(r<10?"0":"").concat(r.toString())),this.sender=t,this.body=n}return this.getMessage=function(e,t,n){return new a(e,t,n)},this}(),HTTP_GET="GET",HTTP_POST="POST",HTTP_PUT="PUT",REQUEST_FETCH="fetch",REQUEST_XHR="xhr",storageManager=function(i){function c(e){return i.chatURL+e+".json"}function l(e,t,n){return fetch(c(e),(a=t,s=n,r={method:a,headers:{Accept:"application/json","Content-Type":"application/json"}},a!==HTTP_GET&&(r.body=JSON.stringify(s)),r)).then(function(e){return e.json()}).then(function(e){return e});var a,s,r}return this.sendRequestToStorage=function(e,t,n){var a,s,r,o;return i.requests===REQUEST_FETCH?a=l(e,t,n):i.requests===REQUEST_XHR&&(s=e,r=t,o=n,a=new Promise(function(e,t){var n=new XMLHttpRequest;n.open(r,c(s),!0),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Content-Type","application/json"),n.addEventListener("load",function(){e(JSON.parse(n.response))}),n.addEventListener("error",function(){t(n.statusText)}),n.send(JSON.stringify(o))})),a},this}(config),chatFactory=function(i){var t="chat-user-id",a="chat-collapsed",r="chat-expanded",d="chat",s="chat-messages",o="chat-input-box",c="chat-input-txt",l="chat-message-button",u="chat-toggle-button",M="[ ]",m="-",D=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],h=15e3,e="Вы",g="userName",n="chatState",p="messages",f="read",E="chat-username-prompt-container",S="chat-username-prompt-input",T="chat-username-prompt-button",O=1e3;function C(e){return localStorage.getItem(t)+"/"+e}function v(e){i.chatState=e,storageManager.sendRequestToStorage(C(n),HTTP_PUT,e)}function y(e,t){var n=DM.createDOMElement("div");n.innerHTML=t,DM.appendDOMElement(e,n)}function L(e,t){var n,a,s,r,o;n=d.concat("-").concat(t.day).concat("-").concat(t.month),null===DM.getDOMElement(n)&&((a=DM.createDOMElement("div")).id=n,DM.addCSSClass(a,"chat-messages-container"),"true"===i.showDateTime?(DM.addCSSClass(a,"chat-messages-container-with-time"),s=e,r=t,(o=DM.createDOMElement("legend")).innerHTML=r.day.toString().concat(" ").concat(D[+r.month]),DM.addCSSClass(o,"chat-day-of-month"),DM.appendDOMElement(s,o)):"false"===i.showDateTime&&DM.addCSSClass(a,"chat-messages-container-no-time"),DM.appendDOMElement(e,a)),a=DM.getDOMElement(n),"true"===i.showDateTime&&y(a,t.time),y(a,t.sender),y(a,t.body)}function b(){var a,e=DM.createDOMElement("div");e.id=s,DM.addCSSClass(e,"chat-messages-external"),DM.appendDOMElement(d,e),a=e,storageManager.sendRequestToStorage(C(p),HTTP_GET,"").then(function(e){var t,n;if(e)for(n=Object.keys(e),i.messagesLength=n.length,t=0;t<n.length;t+=1)L(a,e[n[t]])})}function H(){storageManager.sendRequestToStorage(C(p),HTTP_GET,"").then(function(t){var e=Object.keys(t).slice(1);t&&(i.messagesLength>=e.length||(e.slice(i.messagesLength).forEach(function(e){L(DM.getDOMElement(s),t[e])}),i.messagesLength=e.length))})}function w(){var e,t,n=DM.getDOMElement(c);""!==n.value&&(e=messageFactory.getMessage(new Date,i.userName.concat(":"),n.value),n.value="",L(DM.getDOMElement(s),e),t=e,storageManager.sendRequestToStorage(C(p),HTTP_POST,t),storageManager.sendRequestToStorage(C(f),HTTP_PUT,!1),setInterval(H,h))}function R(){var e;return"left"===i.position?e="chat-container-left":"right"===i.position&&(e="chat-container-right"),e}function N(e){DM.getDOMElement(c).disabled=!e,DM.getDOMElement(l).disabled=!e,null!==DM.getDOMElement(u)&&(DM.getDOMElement(u).disabled=!e)}function P(){var e,t,n,a;e=DM.createDOMElement("div"),t=DM.createDOMElement("label"),n=DM.createDOMElement("input"),a=DM.createDOMElement("button"),e.id=E,DM.addCSSClass(e,"chat-prompt-container",R()),n.id=S,DM.addCSSClass(n,"chat-prompt-input"),t.for=n.id,t.innerHTML="Пожалуйста, представьтесь:",a.id=T,DM.addCSSClass(a,"chat-prompt-button"),a.innerHTML="Сохранить",DM.appendDOMElement(e,t),DM.appendDOMElement(e,n),DM.appendDOMElement(e,a),DM.appendDOMElement(d,e),N(!1),DM.addListener(T,"click",function(){var e=DM.getDOMElement(S).value;e.length<1||(i.userName=e,DM.removeDOMElement(d,E),N(!0),storageManager.sendRequestToStorage(C(g),HTTP_PUT,i.userName))})}function q(){storageManager.sendRequestToStorage(C(g),HTTP_GET,"").then(function(e){i.userName=e}),setTimeout(function(){null!==i.userName&&void 0!==i.userName&&""!==i.userName||("true"===i.requireName?P():(i.userName=e,storageManager.sendRequestToStorage(C(g),HTTP_PUT,i.userName)))},O)}function U(){var e,t,n;DM.removeCSSClass(d,a),DM.addCSSClass(d,r),"true"===i.allowMinimize&&(DM.getDOMElement(u).innerHTML=m),b(),e=DM.createDOMElement("div"),t=DM.createDOMElement("textarea"),n=DM.createDOMElement("button"),e.id=o,DM.addCSSClass(e,"chat-input-container"),t.id=c,DM.addCSSClass(t,"chat-input-textarea"),DM.appendDOMElement(e,t),n.id=l,DM.addCSSClass(n,"chat-message-button"),n.innerHTML="Отправить",DM.addListener(n,"click",w),DM.appendDOMElement(e,n),DM.appendDOMElement(d,e),""!==i.userName&&null!==i.userName&&void 0!==i.userName||q(),v(r)}function _(){storageManager.sendRequestToStorage(C(n),HTTP_GET,"").then(function(e){i.chatState=e}),setTimeout(function(){null===i.chatState||void 0===i.chatState||""===i.chatState?v(a):i.chatState===r&&U(),DM.addCSSClass(d,i.chatState)},O)}function k(){switch(i.chatState){case a:U();break;case r:DM.removeCSSClass(d,r),DM.addCSSClass(d,a),DM.getDOMElement(u).innerHTML=M,DM.removeDOMElement(d,s),DM.removeDOMElement(d,o),v(a);break;default:throw new Error("Unexpected key/value pair: "+d+"/"+i.chatState)}}function x(l){DM.addListener(l,"mousedown",function(e){var t,n,a,s=DM.getDOMElement(d),r={top:(t=s.getBoundingClientRect()).top+window.pageYOffset,left:t.left+window.pageXOffset},o=e.pageX-r.left,i=e.pageY-r.top;function c(e){s.style.left=e.pageX-o+"px",s.style.top=e.pageY-i+"px"}"BUTTON"!==e.target.tagName&&(n=function(e){c(e)},a=function(){DM.removeListener(document,"mousemove",n),DM.removeListener(l,"mouseup",a)},c(e),DM.addListener(document,"mousemove",n),DM.addListener(l,"mouseup",a))}),DM.addListener(l,"dragstart",function(){return!1})}return this.appendStylesheet=function(){var e=DM.createDOMElement("link");e.rel="stylesheet",e.type="text/css",e.href="https://rawgit.com/Besomhead/js--touchsoft/besomhead-task05/task-05/Besomhead/src/css/chat_styles.css",DM.appendDOMElement(document.head,e)},this.createChatMarkup=function(){var e,t,n=DM.createDOMElement("fieldset"),a=DM.createDOMElement("legend"),s=DM.createDOMElement("div");n.id=d,DM.addCSSClass(n,"chat-container",R(),i.cssClass),a.innerHTML=i.chatTitle,DM.addCSSClass(a,"chat-legend"),n.appendChild(a),DM.addCSSClass(s,"chat-toggle-button-container"),"true"===i.allowDrag&&(DM.addCSSClass(s,"chat-toggle-button-container-drag"),x(s)),"true"===i.allowMinimize?(e=s,t=DM.createDOMElement("button"),DM.addCSSClass(t,u),t.id=u,t.innerHTML=i.chatState===r?m:M,DM.addListener(t,"click",k),DM.appendDOMElement(e,t)):"false"===i.allowMinimize&&v(r),DM.appendDOMElement(n,s),DM.appendDOMElement(document.body,n),_()},this.setConfig=function(){var e,t,n=(e=document.currentScript.src).substr(e.indexOf("?")+1).split("&").reduce(function(e,t){var n=t.split("="),a=decodeURIComponent(n[1]);return e[decodeURIComponent(n[0])]=a.substr(1,a.length-2),e},{});Object.keys(n).forEach(function(e){""!==(t=n[e])&&(i[e]=t)})},this.setUniqueUserID=function(){null===localStorage.getItem(t)&&localStorage.setItem(t,"user".concat(Date.now().toString()))},this}(config);window.addEventListener("load",function(){chatFactory.appendStylesheet(),chatFactory.setUniqueUserID(),chatFactory.createChatMarkup()}),chatFactory.setConfig();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoYXQuanMiXSwibmFtZXMiOlsiY29uZmlnIiwiY2hhdFRpdGxlIiwiY2hhdFN0YXRlIiwidXNlck5hbWUiLCJjaGF0VVJMIiwiY3NzQ2xhc3MiLCJwb3NpdGlvbiIsImFsbG93TWluaW1pemUiLCJhbGxvd0RyYWciLCJyZXF1aXJlTmFtZSIsInNob3dEYXRlVGltZSIsInJlcXVlc3RzIiwibWVzc2FnZXNMZW5ndGgiLCJETSIsInRoaXMiLCJnZXRET01FbGVtZW50IiwiaWR0ZiIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRET01DaGlsZHJlbkJ5VGFnIiwicm9vdCIsInRhZyIsIkFycmF5IiwiZnJvbSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZ2V0RE9NQ2hpbGRyZW5CeUNsYXNzIiwiY2xhc3NOYW1lIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImNyZWF0ZURPTUVsZW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiYmluZCIsImFwcGVuZERPTUVsZW1lbnQiLCJlbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJyZW1vdmVET01FbGVtZW50IiwicmVtb3ZlQ2hpbGQiLCJhZGRMaXN0ZW5lciIsImV2ZW50IiwiY2FsbGJhY2siLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlTGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiYWRkQ1NTQ2xhc3MiLCJzZWxmIiwiYXJndW1lbnRzIiwic2xpY2UiLCJmb3JFYWNoIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlQ1NTQ2xhc3MiLCJyZW1vdmUiLCJtZXNzYWdlRmFjdG9yeSIsIk1lc3NhZ2UiLCJkYXRlIiwic2VuZGVyIiwiYm9keSIsImhvdXJzIiwibWludXRlcyIsImRheSIsImdldERhdGUiLCJtb250aCIsImdldE1vbnRoIiwidGltZSIsImdldEhvdXJzIiwiZ2V0TWludXRlcyIsImNvbmNhdCIsInRvU3RyaW5nIiwiZ2V0TWVzc2FnZSIsIkhUVFBfR0VUIiwiSFRUUF9QT1NUIiwiSFRUUF9QVVQiLCJSRVFVRVNUX0ZFVENIIiwiUkVRVUVTVF9YSFIiLCJzdG9yYWdlTWFuYWdlciIsImdldFN0b3JhZ2VQYXRoIiwiZXh0cmFQYXRoIiwic2VuZFJlcXVlc3RUb1N0b3JhZ2VCeUZldGNoIiwicmVxdWVzdE1ldGhvZCIsImRhdGEiLCJmZXRjaCIsImNvbmZpZ09iaiIsIm1ldGhvZCIsImhlYWRlcnMiLCJBY2NlcHQiLCJDb250ZW50LVR5cGUiLCJKU09OIiwic3RyaW5naWZ5IiwidGhlbiIsInJlc3BvbnNlIiwianNvbiIsInJlc3BvbnNlRGF0YSIsInNlbmRSZXF1ZXN0VG9TdG9yYWdlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJzZXRSZXF1ZXN0SGVhZGVyIiwicGFyc2UiLCJzdGF0dXNUZXh0Iiwic2VuZCIsImNoYXRGYWN0b3J5IiwiVVNFUl9JRCIsIkNPTExBUFNFRCIsIkVYUEFOREVEIiwiQ0hBVF9JVEVNIiwiTUVTU0FHRVNfTElTVCIsIklOUFVUX0JPWCIsIklOUFVUX1RFWFQiLCJDSEFUX01FU1NBR0VfQlVUVE9OX0lEIiwiVE9HR0xFX0JVVFRPTiIsIkVYUEFORF9NQVJLIiwiQ09MTEFQU0VfTUFSSyIsIm1vbnRocyIsIlJFUExZX1RJTUVPVVQiLCJERUZBVUxUX1VTRVJfTkFNRSIsIlVTRVJfTkFNRV9GSUVMRCIsIkNIQVRfU1RBVEVfRklFTEQiLCJNRVNTQUdFU19GSUVMRCIsIlJFQURfRklFTEQiLCJVU0VSX05BTUVfUFJPTVBUX0lEIiwiUFJPTVBUX0lOUFVUX0lEIiwiUFJPTVBUX0NPTkZJUk1fQlVUVE9OX0lEIiwiUkVRVUVTVF9USU1FT1VUIiwiZ2V0RXh0cmFQYXRoIiwicGF0aCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzYXZlQ2hhdFN0YXRlVG9TdG9yYWdlIiwic3RhdGUiLCJhcHBlbmRNZXNzYWdlUGFydCIsImNvbnRhaW5lciIsImlubmVySFRNTCIsImVsIiwiYXBwZW5kU2luZ2xlTWVzc2FnZSIsIm1lc3NhZ2UiLCJjb250YWluZXJJZCIsIm1lc3NhZ2VzQ29udGFpbmVyIiwiZGF5T2ZNb250aCIsImlkIiwiYXBwZW5kTWVzc2FnZXNMaXN0IiwibWVzc2FnZXNMaXN0Q29udGFpbmVyIiwia2V5SW5kZXgiLCJtZXNzYWdlc0tleXMiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwidXBkYXRlTWVzc2FnZXNMaXN0Iiwia2V5Iiwic2VuZE1lc3NhZ2UiLCJpbnB1dFRleHRBcmVhIiwidmFsdWUiLCJEYXRlIiwic2V0SW50ZXJ2YWwiLCJnZXRQb3NpdGlvbkNsYXNzIiwicG9zaXRpb25DbGFzcyIsInNldE90aGVyQ29tcG9uZW50c0F2YWlsYWJpbGl0eSIsImlzQXZhaWxhYmxlIiwiZGlzYWJsZWQiLCJhc2tVc2VyTmFtZSIsInByb21wdENvbnRhaW5lciIsInByb21wdExhYmVsIiwicHJvbXB0SW5wdXQiLCJwcm9tcHRDb25maXJtQnV0dG9uIiwiZm9yIiwic2V0VXNlck5hbWUiLCJzZXRUaW1lb3V0IiwidW5kZWZpbmVkIiwiZXhwYW5kQ2hhdCIsImlucHV0TWVzc2FnZUNvbnRhaW5lciIsIm1lc3NhZ2VCdXR0b24iLCJpbml0Q2hhdFN0YXRlIiwiY2hhbmdlQ2hhdFN0YXRlIiwiRXJyb3IiLCJzZXREcmFnSGFuZGxlciIsImJveCIsIm1vdXNlTW92ZUhhbmRsZXIiLCJtb3VzZVVwSGFuZGxlciIsImNoYXQiLCJjb29yZGluYXRlcyIsInRvcCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsIndpbmRvdyIsInBhZ2VZT2Zmc2V0IiwibGVmdCIsInBhZ2VYT2Zmc2V0Iiwic2hpZnRYIiwicGFnZVgiLCJzaGlmdFkiLCJwYWdlWSIsIm1vdmVBdCIsImUiLCJzdHlsZSIsInRhcmdldCIsInRhZ05hbWUiLCJhcHBlbmRTdHlsZXNoZWV0Iiwic3R5bGVFbGVtZW50IiwicmVsIiwidHlwZSIsImhyZWYiLCJoZWFkIiwiY3JlYXRlQ2hhdE1hcmt1cCIsInRvZ2dsZUJ1dHRvbiIsImxlZ2VuZCIsInRvZ2dsZUJ1dHRvbkNvbnRhaW5lciIsInNldENvbmZpZyIsInNjcmlwdCIsInByb3BlcnR5VmFsdWUiLCJyZXF1ZXN0Q29uZmlnIiwiY3VycmVudFNjcmlwdCIsInNyYyIsInN1YnN0ciIsImluZGV4T2YiLCJzcGxpdCIsInJlZHVjZSIsInBhcmFtIiwicGFydHMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJzZXRVbmlxdWVVc2VySUQiLCJzZXRJdGVtIiwibm93Il0sIm1hcHBpbmdzIjoiQUFHQSxJQUFJQSxPQUFTLENBQ1hDLFVBQVcsTUFDWEMsVUFBVyxHQUNYQyxTQUFVLEdBQ1ZDLFFBQVMseUNBQ1RDLFNBQVUsaUJBQ1ZDLFNBQVUsUUFDVkMsY0FBZSxPQUNmQyxVQUFXLFFBQ1hDLFlBQWEsUUFDYkMsYUFBYyxPQUNkQyxTQUFVLFFBQ1ZDLGVBQWdCLEtBS2RDLEdBQUssV0FzQ1AsT0FyQ0FDLEtBQUtDLGNBQWdCLFNBQW9CQyxHQUN2QyxNQUF1QixpQkFBVEEsRUFBb0JDLFNBQVNDLGVBQWVGLEdBQVFBLEdBRXBFRixLQUFLSyxvQkFBc0IsU0FBOEJDLEVBQU1DLEdBQzdELE9BQU9DLE1BQU1DLEtBQUtULEtBQUtDLGNBQWNLLEdBQU1JLHFCQUFxQkgsS0FFbEVQLEtBQUtXLHNCQUF3QixTQUMzQkwsRUFDQU0sR0FFQSxPQUFPSixNQUFNQyxLQUNYVCxLQUFLQyxjQUFjSyxHQUFNTyx1QkFBdUJELEtBR3BEWixLQUFLYyxpQkFBbUJYLFNBQVNZLGNBQWNDLEtBQUtiLFVBQ3BESCxLQUFLaUIsaUJBQW1CLFNBQWdCWCxFQUFNWSxHQUM1Q2xCLEtBQUtDLGNBQWNLLEdBQU1hLFlBQVlELElBRXZDbEIsS0FBS29CLGlCQUFtQixTQUFnQmQsRUFBTVksR0FDNUNsQixLQUFLQyxjQUFjSyxHQUFNZSxZQUFZckIsS0FBS0MsY0FBY2lCLEtBRTFEbEIsS0FBS3NCLFlBQWMsU0FBMEJoQixFQUFNaUIsRUFBT0MsR0FDeER4QixLQUFLQyxjQUFjSyxHQUFNbUIsaUJBQWlCRixFQUFPQyxJQUVuRHhCLEtBQUsw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QVEsU0FBeUJ1RyxHQUVwQyxNQUR0QjJELEVBQWdCQyxFQUFjNUQsTUFFNUJySixFQUFPcUosR0FBTzJELE1BS3BCbE0sS0FBSzZNLGdCQUFrQixXQUNpQixPQUFsQzVGLGFBQWFDLFFBQVF6QixJQUN2QndCLGFBQWE2RixRQUFRckgsRUFBUyxPQUFPdEMsT0FBT3dGLEtBQUtvRSxNQUFNM0osY0FJcERwRCxLQWxlUyxDQW1lZmQsUUFFSHVMLE9BQU9oSixpQkFBaUIsT0FBUSxXQUM5QitELFlBQVk4RixtQkFDWjlGLFlBQVlxSCxrQkFDWnJILFlBQVlvRyxxQkFHZHBHLFlBQVl3RyIsImZpbGUiOiJjaGF0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXhwb3J0ZWQgY29uZmlnICovXHJcbi8qIGdsb2JhbCBjaGF0RmFjdG9yeSAqL1xyXG5cclxudmFyIGNvbmZpZyA9IHtcclxuICBjaGF0VGl0bGU6IFwi0KfQsNGCXCIsXHJcbiAgY2hhdFN0YXRlOiBcIlwiLFxyXG4gIHVzZXJOYW1lOiBcIlwiLFxyXG4gIGNoYXRVUkw6IFwiaHR0cHM6Ly9iZXNvbWhlYWQtY2hhdC5maXJlYmFzZWlvLmNvbS9cIixcclxuICBjc3NDbGFzczogXCJjaGF0LWNvbnRhaW5lclwiLFxyXG4gIHBvc2l0aW9uOiBcInJpZ2h0XCIsXHJcbiAgYWxsb3dNaW5pbWl6ZTogXCJ0cnVlXCIsXHJcbiAgYWxsb3dEcmFnOiBcImZhbHNlXCIsXHJcbiAgcmVxdWlyZU5hbWU6IFwiZmFsc2VcIixcclxuICBzaG93RGF0ZVRpbWU6IFwidHJ1ZVwiLFxyXG4gIHJlcXVlc3RzOiBcImZldGNoXCIsXHJcbiAgbWVzc2FnZXNMZW5ndGg6IFwiMFwiXHJcbn07XHJcblxyXG4vKiBleHBvcnRlZCBETSAqL1xyXG5cclxudmFyIERNID0gKGZ1bmN0aW9uIERPTU1hbmFnZXIoKSB7XHJcbiAgdGhpcy5nZXRET01FbGVtZW50ID0gZnVuY3Rpb24gZ2V0RWxlbWVudChpZHRmKSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIGlkdGYgPT09IFwic3RyaW5nXCIgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZHRmKSA6IGlkdGY7XHJcbiAgfTtcclxuICB0aGlzLmdldERPTUNoaWxkcmVuQnlUYWcgPSBmdW5jdGlvbiBnZXRDaGlsZHJlbkJ5VGFnTmFtZShyb290LCB0YWcpIHtcclxuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZ2V0RE9NRWxlbWVudChyb290KS5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWcpKTtcclxuICB9O1xyXG4gIHRoaXMuZ2V0RE9NQ2hpbGRyZW5CeUNsYXNzID0gZnVuY3Rpb24gZ2V0Q2hpbGRyZW5CeUNsYXNzTmFtZShcclxuICAgIHJvb3QsXHJcbiAgICBjbGFzc05hbWVcclxuICApIHtcclxuICAgIHJldHVybiBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLmdldERPTUVsZW1lbnQocm9vdCkuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGFzc05hbWUpXHJcbiAgICApO1xyXG4gIH07XHJcbiAgdGhpcy5jcmVhdGVET01FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudC5iaW5kKGRvY3VtZW50KTtcclxuICB0aGlzLmFwcGVuZERPTUVsZW1lbnQgPSBmdW5jdGlvbiBhcHBlbmQocm9vdCwgZWxlbWVudCkge1xyXG4gICAgdGhpcy5nZXRET01FbGVtZW50KHJvb3QpLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG4gIH07XHJcbiAgdGhpcy5yZW1vdmVET01FbGVtZW50ID0gZnVuY3Rpb24gcmVtb3ZlKHJvb3QsIGVsZW1lbnQpIHtcclxuICAgIHRoaXMuZ2V0RE9NRWxlbWVudChyb290KS5yZW1vdmVDaGlsZCh0aGlzLmdldERPTUVsZW1lbnQoZWxlbWVudCkpO1xyXG4gIH07XHJcbiAgdGhpcy5hZGRMaXN0ZW5lciA9IGZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXIocm9vdCwgZXZlbnQsIGNhbGxiYWNrKXtcclxuICAgIHRoaXMuZ2V0RE9NRWxlbWVudChyb290KS5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBjYWxsYmFjayk7XHJcbiAgfTtcclxuICB0aGlzLnJlbW92ZUxpc3RlbmVyID0gZnVuY3Rpb24gcmVtb3ZlRXZlbnRMaXN0ZW5lcihyb290LCBldmVudCwgY2FsbGJhY2spe1xyXG4gICAgdGhpcy5nZXRET01FbGVtZW50KHJvb3QpLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGNhbGxiYWNrKTtcclxuICB9O1xyXG4gIHRoaXMuYWRkQ1NTQ2xhc3MgPSBmdW5jdGlvbiBhZGRDU1NDbGFzcyhyb290KXtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIEFycmF5LmZyb20oYXJndW1lbnRzKS5zbGljZSgxKS5mb3JFYWNoKGZ1bmN0aW9uIGFkZENsYXNzZXMoY2xhc3NOYW1lKXtcclxuICAgICAgc2VsZi5nZXRET01FbGVtZW50KHJvb3QpLmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTtcclxuICAgIH0pO1xyXG4gIH07XHJcbiAgdGhpcy5yZW1vdmVDU1NDbGFzcyA9IGZ1bmN0aW9uIHJlbW92ZUNTU0NsYXNzKHJvb3QsIGNsYXNzTmFtZSl7XHJcbiAgICB0aGlzLmdldERPTUVsZW1lbnQocm9vdCkuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB0aGlzO1xyXG59KSgpO1xyXG4vKiBleHBvcnRlZCBtZXNzYWdlRmFjdG9yeSAqL1xyXG5cclxudmFyIG1lc3NhZ2VGYWN0b3J5ID0gKGZ1bmN0aW9uIE1lc3NhZ2VGYWN0b3J5KCkge1xyXG4gIGZ1bmN0aW9uIGdldEN1cnJlbnRUaW1lKGRhdGUpIHtcclxuICAgIHZhciBob3VycyA9IGRhdGUuZ2V0SG91cnMoKTtcclxuICAgIHZhciBtaW51dGVzID0gZGF0ZS5nZXRNaW51dGVzKCk7XHJcblxyXG4gICAgcmV0dXJuIChob3VycyA8IDEwID8gXCIwXCIgOiBcIlwiKVxyXG4gICAgICAuY29uY2F0KGhvdXJzLnRvU3RyaW5nKCkpXHJcbiAgICAgIC5jb25jYXQoXCI6XCIpXHJcbiAgICAgIC5jb25jYXQobWludXRlcyA8IDEwID8gXCIwXCIgOiBcIlwiKVxyXG4gICAgICAuY29uY2F0KG1pbnV0ZXMudG9TdHJpbmcoKSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBNZXNzYWdlKGRhdGUsIHNlbmRlciwgYm9keSkge1xyXG4gICAgdGhpcy5kYXkgPSBkYXRlLmdldERhdGUoKTtcclxuICAgIHRoaXMubW9udGggPSBkYXRlLmdldE1vbnRoKCk7XHJcbiAgICB0aGlzLnRpbWUgPSBnZXRDdXJyZW50VGltZShkYXRlKTtcclxuICAgIHRoaXMuc2VuZGVyID0gc2VuZGVyO1xyXG4gICAgdGhpcy5ib2R5ID0gYm9keTtcclxuICB9XHJcblxyXG4gIHRoaXMuZ2V0TWVzc2FnZSA9IGZ1bmN0aW9uIGdldE1lc3NhZ2UoZGF0ZSwgc2VuZGVyLCBib2R5KSB7XHJcbiAgICByZXR1cm4gbmV3IE1lc3NhZ2UoZGF0ZSwgc2VuZGVyLCBib2R5KTtcclxuICB9O1xyXG5cclxuICByZXR1cm4gdGhpcztcclxufSkoKTtcclxuLyogZXhwb3J0ZWQgc3RvcmFnZU1hbmFnZXIgKi9cclxuLyogZXhwb3J0ZWQgSFRUUF9HRVQgSFRUUF9QT1NUIEhUVFBfUFVUICovXHJcbi8qIGdsb2JhbCBjb25maWcgKi9cclxuXHJcbnZhciBIVFRQX0dFVCA9IFwiR0VUXCI7XHJcbnZhciBIVFRQX1BPU1QgPSBcIlBPU1RcIjtcclxudmFyIEhUVFBfUFVUID0gXCJQVVRcIjtcclxudmFyIFJFUVVFU1RfRkVUQ0ggPSBcImZldGNoXCI7XHJcbnZhciBSRVFVRVNUX1hIUiA9IFwieGhyXCI7XHJcblxyXG52YXIgc3RvcmFnZU1hbmFnZXIgPSAoZnVuY3Rpb24gU3RvcmFnZU1hbmFnZXIoY29uZmlnKSB7XHJcbiAgZnVuY3Rpb24gZ2V0U3RvcmFnZVBhdGgoZXh0cmFQYXRoKSB7XHJcbiAgICByZXR1cm4gY29uZmlnLmNoYXRVUkwgKyBleHRyYVBhdGggKyBcIi5qc29uXCI7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBnZXRSZXF1ZXN0Q29uZmlnT2JqKHJlcXVlc3RNZXRob2QsIGRhdGEpIHtcclxuICAgIHZhciBjb25maWdPYmogPSB7XHJcbiAgICAgIG1ldGhvZDogcmVxdWVzdE1ldGhvZCxcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIEFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAocmVxdWVzdE1ldGhvZCAhPT0gSFRUUF9HRVQpIHtcclxuICAgICAgY29uZmlnT2JqLmJvZHkgPSBKU09OLnN0cmluZ2lmeShkYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gY29uZmlnT2JqO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2VuZFJlcXVlc3RUb1N0b3JhZ2VCeUZldGNoKGV4dHJhUGF0aCwgcmVxdWVzdE1ldGhvZCwgZGF0YSkge1xyXG4gICAgcmV0dXJuIGZldGNoKFxyXG4gICAgICBnZXRTdG9yYWdlUGF0aChleHRyYVBhdGgpLFxyXG4gICAgICBnZXRSZXF1ZXN0Q29uZmlnT2JqKHJlcXVlc3RNZXRob2QsIGRhdGEpXHJcbiAgICApXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uIGdldFJlc3BvbnNlKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gZ2V0UmVzcG9uc2VEYXRhKHJlc3BvbnNlRGF0YSkge1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZURhdGE7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2VuZFJlcXVlc3RUb1N0b3JhZ2VCeVhIUihleHRyYVBhdGgsIG1ldGhvZCwgZGF0YSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIHNlbmRYSFJSZXF1ZXN0KHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcblxyXG4gICAgICB4aHIub3BlbihtZXRob2QsIGdldFN0b3JhZ2VQYXRoKGV4dHJhUGF0aCksIHRydWUpO1xyXG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkFjY2VwdFwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XHJcbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcclxuICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGZ1bmN0aW9uIG9uTG9hZCgpIHtcclxuICAgICAgICByZXNvbHZlKEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlKSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIGZ1bmN0aW9uIG9uRXJyb3IoKSB7XHJcbiAgICAgICAgcmVqZWN0KHhoci5zdGF0dXNUZXh0KTtcclxuICAgICAgfSk7XHJcbiAgICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgdGhpcy5zZW5kUmVxdWVzdFRvU3RvcmFnZSA9IGZ1bmN0aW9uIHNlbmRSZXF1ZXN0VG9TdG9yYWdlKFxyXG4gICAgZXh0cmFQYXRoLFxyXG4gICAgbWV0aG9kLFxyXG4gICAgZGF0YVxyXG4gICkge1xyXG4gICAgdmFyIHJlc3BvbnNlO1xyXG5cclxuICAgIGlmIChjb25maWcucmVxdWVzdHMgPT09IFJFUVVFU1RfRkVUQ0gpIHtcclxuICAgICAgcmVzcG9uc2UgPSBzZW5kUmVxdWVzdFRvU3RvcmFnZUJ5RmV0Y2goZXh0cmFQYXRoLCBtZXRob2QsIGRhdGEpO1xyXG4gICAgfSBlbHNlIGlmIChjb25maWcucmVxdWVzdHMgPT09IFJFUVVFU1RfWEhSKSB7XHJcbiAgICAgIHJlc3BvbnNlID0gc2VuZFJlcXVlc3RUb1N0b3JhZ2VCeVhIUihleHRyYVBhdGgsIG1ldGhvZCwgZGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB0aGlzO1xyXG59KShjb25maWcpO1xyXG4vKiBleHBvcnRlZCBjaGF0RmFjdG9yeSAqL1xyXG4vKiBnbG9iYWwgY29uZmlnICovXHJcbi8qIGdsb2JhbCBETSAqL1xyXG4vKiBnbG9iYWwgbWVzc2FnZUZhY3RvcnkgKi9cclxuLyogZ2xvYmFsIHN0b3JhZ2VNYW5hZ2VyIEhUVFBfR0VUIEhUVFBfUE9TVCBIVFRQX1BVVCAqL1xyXG5cclxudmFyIGNoYXRGYWN0b3J5ID0gKGZ1bmN0aW9uIENoYXRGYWN0b3J5KGNvbmZpZykge1xyXG4gIHZhciBVU0VSX0lEID0gXCJjaGF0LXVzZXItaWRcIjtcclxuICB2YXIgQ09MTEFQU0VEID0gXCJjaGF0LWNvbGxhcHNlZFwiO1xyXG4gIHZhciBFWFBBTkRFRCA9IFwiY2hhdC1leHBhbmRlZFwiO1xyXG4gIHZhciBDSEFUX0lURU0gPSBcImNoYXRcIjtcclxuICB2YXIgTUVTU0FHRVNfTElTVCA9IFwiY2hhdC1tZXNzYWdlc1wiO1xyXG4gIHZhciBJTlBVVF9CT1ggPSBcImNoYXQtaW5wdXQtYm94XCI7XHJcbiAgdmFyIElOUFVUX1RFWFQgPSBcImNoYXQtaW5wdXQtdHh0XCI7XHJcbiAgdmFyIENIQVRfTUVTU0FHRV9CVVRUT05fSUQgPSBcImNoYXQtbWVzc2FnZS1idXR0b25cIjtcclxuICB2YXIgVE9HR0xFX0JVVFRPTiA9IFwiY2hhdC10b2dnbGUtYnV0dG9uXCI7XHJcbiAgdmFyIEVYUEFORF9NQVJLID0gXCJbIF1cIjtcclxuICB2YXIgQ09MTEFQU0VfTUFSSyA9IFwiLVwiO1xyXG4gIHZhciBtb250aHMgPSBbXHJcbiAgICBcItGP0L3QstCw0YDRj1wiLFxyXG4gICAgXCLRhNC10LLRgNCw0LvRj1wiLFxyXG4gICAgXCLQvNCw0YDRgtCwXCIsXHJcbiAgICBcItCw0L/RgNC10LvRj1wiLFxyXG4gICAgXCLQvNCw0Y9cIixcclxuICAgIFwi0LjRjtC90Y9cIixcclxuICAgIFwi0LjRjtC70Y9cIixcclxuICAgIFwi0LDQstCz0YPRgdGC0LBcIixcclxuICAgIFwi0YHQtdC90YLRj9Cx0YDRj1wiLFxyXG4gICAgXCLQvtC60YLRj9Cx0YDRj1wiLFxyXG4gICAgXCLQvdC+0Y/QsdGA0Y9cIixcclxuICAgIFwi0LTQtdC60LDQsdGA0Y9cIlxyXG4gIF07XHJcbiAgdmFyIFJFUExZX1RJTUVPVVQgPSAxNTAwMDtcclxuICB2YXIgUEFUSF9UT19TVFlMRVNIRUVUID1cclxuICAgIFwiaHR0cHM6Ly9yYXdnaXQuY29tL0Jlc29taGVhZC9qcy0tdG91Y2hzb2Z0L2Jlc29taGVhZC10YXNrMDUvdGFzay0wNS9CZXNvbWhlYWQvc3JjL2Nzcy9jaGF0X3N0eWxlcy5jc3NcIjtcclxuICB2YXIgREVGQVVMVF9VU0VSX05BTUUgPSBcItCS0YtcIjtcclxuICB2YXIgVVNFUl9OQU1FX0ZJRUxEID0gXCJ1c2VyTmFtZVwiO1xyXG4gIHZhciBDSEFUX1NUQVRFX0ZJRUxEID0gXCJjaGF0U3RhdGVcIjtcclxuICB2YXIgTUVTU0FHRVNfRklFTEQgPSBcIm1lc3NhZ2VzXCI7XHJcbiAgdmFyIFJFQURfRklFTEQgPSBcInJlYWRcIjtcclxuICB2YXIgVVNFUl9OQU1FX1BST01QVF9JRCA9IFwiY2hhdC11c2VybmFtZS1wcm9tcHQtY29udGFpbmVyXCI7XHJcbiAgdmFyIFBST01QVF9JTlBVVF9JRCA9IFwiY2hhdC11c2VybmFtZS1wcm9tcHQtaW5wdXRcIjtcclxuICB2YXIgUFJPTVBUX0NPTkZJUk1fQlVUVE9OX0lEID0gXCJjaGF0LXVzZXJuYW1lLXByb21wdC1idXR0b25cIjtcclxuICB2YXIgUkVRVUVTVF9USU1FT1VUID0gMTAwMDtcclxuXHJcblxyXG5cclxuICBmdW5jdGlvbiBnZXRFeHRyYVBhdGgocGF0aCkge1xyXG4gICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKFVTRVJfSUQpICsgXCIvXCIgKyBwYXRoO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2F2ZUNoYXRTdGF0ZVRvU3RvcmFnZShzdGF0ZSkge1xyXG4gICAgY29uZmlnLmNoYXRTdGF0ZSA9IHN0YXRlO1xyXG4gICAgc3RvcmFnZU1hbmFnZXIuc2VuZFJlcXVlc3RUb1N0b3JhZ2UoXHJcbiAgICAgIGdldEV4dHJhUGF0aChDSEFUX1NUQVRFX0ZJRUxEKSxcclxuICAgICAgSFRUUF9QVVQsXHJcbiAgICAgIHN0YXRlXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY29sbGFwc2VDaGF0KCkge1xyXG4gICAgRE0ucmVtb3ZlQ1NTQ2xhc3MoQ0hBVF9JVEVNLCBFWFBBTkRFRCk7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhDSEFUX0lURU0sIENPTExBUFNFRCk7XHJcbiAgICBETS5nZXRET01FbGVtZW50KFRPR0dMRV9CVVRUT04pLmlubmVySFRNTCA9IEVYUEFORF9NQVJLO1xyXG4gICAgRE0ucmVtb3ZlRE9NRWxlbWVudChDSEFUX0lURU0sIE1FU1NBR0VTX0xJU1QpO1xyXG4gICAgRE0ucmVtb3ZlRE9NRWxlbWVudChDSEFUX0lURU0sIElOUFVUX0JPWCk7XHJcbiAgICBzYXZlQ2hhdFN0YXRlVG9TdG9yYWdlKENPTExBUFNFRCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBhcHBlbmRNZXNzYWdlUGFydChjb250YWluZXIsIGlubmVySFRNTCkge1xyXG4gICAgdmFyIGVsID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImRpdlwiKTtcclxuXHJcbiAgICBlbC5pbm5lckhUTUwgPSBpbm5lckhUTUw7XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KGNvbnRhaW5lciwgZWwpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYXBwZW5kRGF0ZUxlZ2VuZChjb250YWluZXIsIG1lc3NhZ2UpIHtcclxuICAgIHZhciBkYXlPZk1vbnRoID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImxlZ2VuZFwiKTtcclxuXHJcbiAgICBkYXlPZk1vbnRoLmlubmVySFRNTCA9IG1lc3NhZ2UuZGF5XHJcbiAgICAgIC50b1N0cmluZygpXHJcbiAgICAgIC5jb25jYXQoXCIgXCIpXHJcbiAgICAgIC5jb25jYXQobW9udGhzWyttZXNzYWdlLm1vbnRoXSk7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhkYXlPZk1vbnRoLCBcImNoYXQtZGF5LW9mLW1vbnRoXCIpO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChjb250YWluZXIsIGRheU9mTW9udGgpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYXBwZW5kU2luZ2xlTWVzc2FnZShjb250YWluZXIsIG1lc3NhZ2UpIHtcclxuICAgIHZhciBjb250YWluZXJJZDtcclxuICAgIHZhciBtZXNzYWdlc0NvbnRhaW5lcjtcclxuXHJcbiAgICBjb250YWluZXJJZCA9IENIQVRfSVRFTS5jb25jYXQoXCItXCIpXHJcbiAgICAgIC5jb25jYXQobWVzc2FnZS5kYXkpXHJcbiAgICAgIC5jb25jYXQoXCItXCIpXHJcbiAgICAgIC5jb25jYXQobWVzc2FnZS5tb250aCk7XHJcbiAgICBpZiAoRE0uZ2V0RE9NRWxlbWVudChjb250YWluZXJJZCkgPT09IG51bGwpIHtcclxuICAgICAgbWVzc2FnZXNDb250YWluZXIgPSBETS5jcmVhdGVET01FbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBtZXNzYWdlc0NvbnRhaW5lci5pZCA9IGNvbnRhaW5lcklkO1xyXG4gICAgICBETS5hZGRDU1NDbGFzcyhtZXNzYWdlc0NvbnRhaW5lciwgXCJjaGF0LW1lc3NhZ2VzLWNvbnRhaW5lclwiKTtcclxuICAgICAgaWYgKGNvbmZpZy5zaG93RGF0ZVRpbWUgPT09IFwidHJ1ZVwiKSB7XHJcbiAgICAgICAgRE0uYWRkQ1NTQ2xhc3MobWVzc2FnZXNDb250YWluZXIsIFwiY2hhdC1tZXNzYWdlcy1jb250YWluZXItd2l0aC10aW1lXCIpO1xyXG4gICAgICAgIGFwcGVuZERhdGVMZWdlbmQoY29udGFpbmVyLCBtZXNzYWdlKTtcclxuICAgICAgfSBlbHNlIGlmIChjb25maWcuc2hvd0RhdGVUaW1lID09PSBcImZhbHNlXCIpIHtcclxuICAgICAgICBETS5hZGRDU1NDbGFzcyhtZXNzYWdlc0NvbnRhaW5lciwgXCJjaGF0LW1lc3NhZ2VzLWNvbnRhaW5lci1uby10aW1lXCIpO1xyXG4gICAgICB9XHJcbiAgICAgIERNLmFwcGVuZERPTUVsZW1lbnQoY29udGFpbmVyLCBtZXNzYWdlc0NvbnRhaW5lcik7XHJcbiAgICB9XHJcbiAgICBtZXNzYWdlc0NvbnRhaW5lciA9IERNLmdldERPTUVsZW1lbnQoY29udGFpbmVySWQpO1xyXG4gICAgaWYgKGNvbmZpZy5zaG93RGF0ZVRpbWUgPT09IFwidHJ1ZVwiKSB7XHJcbiAgICAgIGFwcGVuZE1lc3NhZ2VQYXJ0KG1lc3NhZ2VzQ29udGFpbmVyLCBtZXNzYWdlLnRpbWUpO1xyXG4gICAgfVxyXG4gICAgYXBwZW5kTWVzc2FnZVBhcnQobWVzc2FnZXNDb250YWluZXIsIG1lc3NhZ2Uuc2VuZGVyKTtcclxuICAgIGFwcGVuZE1lc3NhZ2VQYXJ0KG1lc3NhZ2VzQ29udGFpbmVyLCBtZXNzYWdlLmJvZHkpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYXBwZW5kTWVzc2FnZXMoY29udGFpbmVyKSB7XHJcbiAgICBzdG9yYWdlTWFuYWdlclxyXG4gICAgICAuc2VuZFJlcXVlc3RUb1N0b3JhZ2UoZ2V0RXh0cmFQYXRoKE1FU1NBR0VTX0ZJRUxEKSwgSFRUUF9HRVQsIFwiXCIpXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uIHNob3dNZXNzYWdlc0luQ2hhdChkYXRhKSB7XHJcbiAgICAgICAgdmFyIGtleUluZGV4O1xyXG4gICAgICAgIHZhciBtZXNzYWdlc0tleXM7XHJcbiAgICAgICAgaWYgKCFkYXRhKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1lc3NhZ2VzS2V5cyA9IE9iamVjdC5rZXlzKGRhdGEpO1xyXG4gICAgICAgIGNvbmZpZy5tZXNzYWdlc0xlbmd0aCA9IG1lc3NhZ2VzS2V5cy5sZW5ndGg7XHJcbiAgICAgICAgZm9yIChrZXlJbmRleCA9IDA7IGtleUluZGV4IDwgbWVzc2FnZXNLZXlzLmxlbmd0aDsga2V5SW5kZXggKz0gMSkge1xyXG4gICAgICAgICAgYXBwZW5kU2luZ2xlTWVzc2FnZShjb250YWluZXIsIGRhdGFbbWVzc2FnZXNLZXlzW2tleUluZGV4XV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBhcHBlbmRNZXNzYWdlc0xpc3QoKSB7XHJcbiAgICB2YXIgbWVzc2FnZXNMaXN0Q29udGFpbmVyID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImRpdlwiKTtcclxuXHJcbiAgICBtZXNzYWdlc0xpc3RDb250YWluZXIuaWQgPSBNRVNTQUdFU19MSVNUO1xyXG4gICAgRE0uYWRkQ1NTQ2xhc3MobWVzc2FnZXNMaXN0Q29udGFpbmVyLCBcImNoYXQtbWVzc2FnZXMtZXh0ZXJuYWxcIik7XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KENIQVRfSVRFTSwgbWVzc2FnZXNMaXN0Q29udGFpbmVyKTtcclxuICAgIGFwcGVuZE1lc3NhZ2VzKG1lc3NhZ2VzTGlzdENvbnRhaW5lcik7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiB1cGRhdGVNZXNzYWdlc0xpc3QoKSB7XHJcbiAgICBzdG9yYWdlTWFuYWdlclxyXG4gICAgICAuc2VuZFJlcXVlc3RUb1N0b3JhZ2UoZ2V0RXh0cmFQYXRoKE1FU1NBR0VTX0ZJRUxEKSwgSFRUUF9HRVQsIFwiXCIpXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uIG9uTWVzc2FnZXNSZWNlaXZlZChkYXRhKSB7XHJcbiAgICAgICAgdmFyIG1lc3NhZ2VzS2V5cyA9IE9iamVjdC5rZXlzKGRhdGEpLnNsaWNlKDEpO1xyXG5cclxuICAgICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNvbmZpZy5tZXNzYWdlc0xlbmd0aCA+PSBtZXNzYWdlc0tleXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1lc3NhZ2VzS2V5c1xyXG4gICAgICAgICAgLnNsaWNlKGNvbmZpZy5tZXNzYWdlc0xlbmd0aClcclxuICAgICAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uIGFwcGVuZE1lc3NhZ2Uoa2V5KSB7XHJcbiAgICAgICAgICAgIGFwcGVuZFNpbmdsZU1lc3NhZ2UoRE0uZ2V0RE9NRWxlbWVudChNRVNTQUdFU19MSVNUKSwgZGF0YVtrZXldKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIGNvbmZpZy5tZXNzYWdlc0xlbmd0aCA9IG1lc3NhZ2VzS2V5cy5sZW5ndGg7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2F2ZU1lc3NhZ2UobWVzc2FnZSkge1xyXG4gICAgc3RvcmFnZU1hbmFnZXIuc2VuZFJlcXVlc3RUb1N0b3JhZ2UoXHJcbiAgICAgIGdldEV4dHJhUGF0aChNRVNTQUdFU19GSUVMRCksXHJcbiAgICAgIEhUVFBfUE9TVCxcclxuICAgICAgbWVzc2FnZVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNlbmRNZXNzYWdlKCkge1xyXG4gICAgdmFyIGlucHV0VGV4dEFyZWEgPSBETS5nZXRET01FbGVtZW50KElOUFVUX1RFWFQpO1xyXG4gICAgdmFyIG1lc3NhZ2U7XHJcblxyXG4gICAgaWYgKGlucHV0VGV4dEFyZWEudmFsdWUgIT09IFwiXCIpIHtcclxuICAgICAgbWVzc2FnZSA9IG1lc3NhZ2VGYWN0b3J5LmdldE1lc3NhZ2UoXHJcbiAgICAgICAgbmV3IERhdGUoKSxcclxuICAgICAgICBjb25maWcudXNlck5hbWUuY29uY2F0KFwiOlwiKSxcclxuICAgICAgICBpbnB1dFRleHRBcmVhLnZhbHVlXHJcbiAgICAgICk7XHJcbiAgICAgIGlucHV0VGV4dEFyZWEudmFsdWUgPSBcIlwiO1xyXG4gICAgICBhcHBlbmRTaW5nbGVNZXNzYWdlKERNLmdldERPTUVsZW1lbnQoTUVTU0FHRVNfTElTVCksIG1lc3NhZ2UpO1xyXG4gICAgICBzYXZlTWVzc2FnZShtZXNzYWdlKTtcclxuICAgICAgc3RvcmFnZU1hbmFnZXIuc2VuZFJlcXVlc3RUb1N0b3JhZ2UoXHJcbiAgICAgICAgZ2V0RXh0cmFQYXRoKFJFQURfRklFTEQpLFxyXG4gICAgICAgIEhUVFBfUFVULFxyXG4gICAgICAgIGZhbHNlXHJcbiAgICAgICk7XHJcbiAgICAgIHNldEludGVydmFsKHVwZGF0ZU1lc3NhZ2VzTGlzdCwgUkVQTFlfVElNRU9VVCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBhcHBlbmRJbnB1dEJveCgpIHtcclxuICAgIHZhciBpbnB1dE1lc3NhZ2VDb250YWluZXIgPSBETS5jcmVhdGVET01FbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgdmFyIGlucHV0VGV4dEFyZWEgPSBETS5jcmVhdGVET01FbGVtZW50KFwidGV4dGFyZWFcIik7XHJcbiAgICB2YXIgbWVzc2FnZUJ1dHRvbiA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJidXR0b25cIik7XHJcblxyXG4gICAgaW5wdXRNZXNzYWdlQ29udGFpbmVyLmlkID0gSU5QVVRfQk9YO1xyXG4gICAgRE0uYWRkQ1NTQ2xhc3MoaW5wdXRNZXNzYWdlQ29udGFpbmVyLCBcImNoYXQtaW5wdXQtY29udGFpbmVyXCIpO1xyXG4gICAgaW5wdXRUZXh0QXJlYS5pZCA9IElOUFVUX1RFWFQ7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhpbnB1dFRleHRBcmVhLCBcImNoYXQtaW5wdXQtdGV4dGFyZWFcIik7XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KGlucHV0TWVzc2FnZUNvbnRhaW5lciwgaW5wdXRUZXh0QXJlYSk7XHJcbiAgICBtZXNzYWdlQnV0dG9uLmlkID0gQ0hBVF9NRVNTQUdFX0JVVFRPTl9JRDtcclxuICAgIERNLmFkZENTU0NsYXNzKG1lc3NhZ2VCdXR0b24sIFwiY2hhdC1tZXNzYWdlLWJ1dHRvblwiKTtcclxuICAgIG1lc3NhZ2VCdXR0b24uaW5uZXJIVE1MID0gXCLQntGC0L/RgNCw0LLQuNGC0YxcIjtcclxuICAgIERNLmFkZExpc3RlbmVyKG1lc3NhZ2VCdXR0b24sIFwiY2xpY2tcIiwgc2VuZE1lc3NhZ2UpO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChpbnB1dE1lc3NhZ2VDb250YWluZXIsIG1lc3NhZ2VCdXR0b24pO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChDSEFUX0lURU0sIGlucHV0TWVzc2FnZUNvbnRhaW5lcik7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBnZXRQb3NpdGlvbkNsYXNzKCkge1xyXG4gICAgdmFyIHBvc2l0aW9uQ2xhc3M7XHJcblxyXG4gICAgaWYgKGNvbmZpZy5wb3NpdGlvbiA9PT0gXCJsZWZ0XCIpIHtcclxuICAgICAgcG9zaXRpb25DbGFzcyA9IFwiY2hhdC1jb250YWluZXItbGVmdFwiO1xyXG4gICAgfSBlbHNlIGlmIChjb25maWcucG9zaXRpb24gPT09IFwicmlnaHRcIikge1xyXG4gICAgICBwb3NpdGlvbkNsYXNzID0gXCJjaGF0LWNvbnRhaW5lci1yaWdodFwiO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwb3NpdGlvbkNsYXNzO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gY3JlYXRlVXNlck5hbWVQcm9tcHRNYXJrdXAoKSB7XHJcbiAgICB2YXIgcHJvbXB0Q29udGFpbmVyID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImRpdlwiKTtcclxuICAgIHZhciBwcm9tcHRMYWJlbCA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJsYWJlbFwiKTtcclxuICAgIHZhciBwcm9tcHRJbnB1dCA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgIHZhciBwcm9tcHRDb25maXJtQnV0dG9uID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImJ1dHRvblwiKTtcclxuXHJcbiAgICBwcm9tcHRDb250YWluZXIuaWQgPSBVU0VSX05BTUVfUFJPTVBUX0lEO1xyXG4gICAgRE0uYWRkQ1NTQ2xhc3MoXHJcbiAgICAgIHByb21wdENvbnRhaW5lcixcclxuICAgICAgXCJjaGF0LXByb21wdC1jb250YWluZXJcIixcclxuICAgICAgZ2V0UG9zaXRpb25DbGFzcygpXHJcbiAgICApO1xyXG4gICAgcHJvbXB0SW5wdXQuaWQgPSBQUk9NUFRfSU5QVVRfSUQ7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhwcm9tcHRJbnB1dCwgXCJjaGF0LXByb21wdC1pbnB1dFwiKTtcclxuICAgIHByb21wdExhYmVsLmZvciA9IHByb21wdElucHV0LmlkO1xyXG4gICAgcHJvbXB0TGFiZWwuaW5uZXJIVE1MID0gXCLQn9C+0LbQsNC70YPQudGB0YLQsCwg0L/RgNC10LTRgdGC0LDQstGM0YLQtdGB0Yw6XCI7XHJcbiAgICBwcm9tcHRDb25maXJtQnV0dG9uLmlkID0gUFJPTVBUX0NPTkZJUk1fQlVUVE9OX0lEO1xyXG4gICAgRE0uYWRkQ1NTQ2xhc3MocHJvbXB0Q29uZmlybUJ1dHRvbiwgXCJjaGF0LXByb21wdC1idXR0b25cIik7XHJcbiAgICBwcm9tcHRDb25maXJtQnV0dG9uLmlubmVySFRNTCA9IFwi0KHQvtGF0YDQsNC90LjRgtGMXCI7XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KHByb21wdENvbnRhaW5lciwgcHJvbXB0TGFiZWwpO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChwcm9tcHRDb250YWluZXIsIHByb21wdElucHV0KTtcclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQocHJvbXB0Q29udGFpbmVyLCBwcm9tcHRDb25maXJtQnV0dG9uKTtcclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQoQ0hBVF9JVEVNLCBwcm9tcHRDb250YWluZXIpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2V0T3RoZXJDb21wb25lbnRzQXZhaWxhYmlsaXR5KGlzQXZhaWxhYmxlKSB7XHJcbiAgICBETS5nZXRET01FbGVtZW50KElOUFVUX1RFWFQpLmRpc2FibGVkID0gIWlzQXZhaWxhYmxlO1xyXG4gICAgRE0uZ2V0RE9NRWxlbWVudChDSEFUX01FU1NBR0VfQlVUVE9OX0lEKS5kaXNhYmxlZCA9ICFpc0F2YWlsYWJsZTtcclxuICAgIGlmIChETS5nZXRET01FbGVtZW50KFRPR0dMRV9CVVRUT04pICE9PSBudWxsKSB7XHJcbiAgICAgIERNLmdldERPTUVsZW1lbnQoVE9HR0xFX0JVVFRPTikuZGlzYWJsZWQgPSAhaXNBdmFpbGFibGU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBhc2tVc2VyTmFtZSgpIHtcclxuICAgIGNyZWF0ZVVzZXJOYW1lUHJvbXB0TWFya3VwKCk7XHJcbiAgICBzZXRPdGhlckNvbXBvbmVudHNBdmFpbGFiaWxpdHkoZmFsc2UpO1xyXG4gICAgRE0uYWRkTGlzdGVuZXIoUFJPTVBUX0NPTkZJUk1fQlVUVE9OX0lELCBcImNsaWNrXCIsIGZ1bmN0aW9uIHNhdmVVc2VyTmFtZSgpIHtcclxuICAgICAgdmFyIHVzZXJOYW1lID0gRE0uZ2V0RE9NRWxlbWVudChQUk9NUFRfSU5QVVRfSUQpLnZhbHVlO1xyXG4gICAgICBpZiAodXNlck5hbWUubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBjb25maWcudXNlck5hbWUgPSB1c2VyTmFtZTtcclxuICAgICAgRE0ucmVtb3ZlRE9NRWxlbWVudChDSEFUX0lURU0sIFVTRVJfTkFNRV9QUk9NUFRfSUQpO1xyXG4gICAgICBzZXRPdGhlckNvbXBvbmVudHNBdmFpbGFiaWxpdHkodHJ1ZSk7XHJcbiAgICAgIHN0b3JhZ2VNYW5hZ2VyLnNlbmRSZXF1ZXN0VG9TdG9yYWdlKFxyXG4gICAgICAgIGdldEV4dHJhUGF0aChVU0VSX05BTUVfRklFTEQpLFxyXG4gICAgICAgIEhUVFBfUFVULFxyXG4gICAgICAgIGNvbmZpZy51c2VyTmFtZVxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBnZXRVc2VyTmFtZUZyb21TdG9yYWdlKCkge1xyXG4gICAgc3RvcmFnZU1hbmFnZXJcclxuICAgICAgLnNlbmRSZXF1ZXN0VG9TdG9yYWdlKGdldEV4dHJhUGF0aChVU0VSX05BTUVfRklFTEQpLCBIVFRQX0dFVCwgXCJcIilcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gc2F2ZVVzZXJOYW1lKGRhdGEpIHtcclxuICAgICAgICBjb25maWcudXNlck5hbWUgPSBkYXRhO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNldFVzZXJOYW1lKCkge1xyXG4gICAgZ2V0VXNlck5hbWVGcm9tU3RvcmFnZSgpO1xyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiBpZk5vdEFzc2lnbigpIHtcclxuICAgICAgaWYgKFxyXG4gICAgICAgIGNvbmZpZy51c2VyTmFtZSAhPT0gbnVsbCAmJlxyXG4gICAgICAgIGNvbmZpZy51c2VyTmFtZSAhPT0gdW5kZWZpbmVkICYmXHJcbiAgICAgICAgY29uZmlnLnVzZXJOYW1lICE9PSBcIlwiXHJcbiAgICAgICkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBpZiAoY29uZmlnLnJlcXVpcmVOYW1lID09PSBcInRydWVcIikge1xyXG4gICAgICAgIGFza1VzZXJOYW1lKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uZmlnLnVzZXJOYW1lID0gREVGQVVMVF9VU0VSX05BTUU7XHJcbiAgICAgICAgc3RvcmFnZU1hbmFnZXIuc2VuZFJlcXVlc3RUb1N0b3JhZ2UoXHJcbiAgICAgICAgICBnZXRFeHRyYVBhdGgoVVNFUl9OQU1FX0ZJRUxEKSxcclxuICAgICAgICAgIEhUVFBfUFVULFxyXG4gICAgICAgICAgY29uZmlnLnVzZXJOYW1lXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfSwgUkVRVUVTVF9USU1FT1VUKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGV4cGFuZENoYXQoKSB7XHJcbiAgICBETS5yZW1vdmVDU1NDbGFzcyhDSEFUX0lURU0sIENPTExBUFNFRCk7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhDSEFUX0lURU0sIEVYUEFOREVEKTtcclxuICAgIGlmIChjb25maWcuYWxsb3dNaW5pbWl6ZSA9PT0gXCJ0cnVlXCIpIHtcclxuICAgICAgRE0uZ2V0RE9NRWxlbWVudChUT0dHTEVfQlVUVE9OKS5pbm5lckhUTUwgPSBDT0xMQVBTRV9NQVJLO1xyXG4gICAgfVxyXG4gICAgYXBwZW5kTWVzc2FnZXNMaXN0KCk7XHJcbiAgICBhcHBlbmRJbnB1dEJveCgpO1xyXG4gICAgaWYgKFxyXG4gICAgICBjb25maWcudXNlck5hbWUgPT09IFwiXCIgfHxcclxuICAgICAgY29uZmlnLnVzZXJOYW1lID09PSBudWxsIHx8XHJcbiAgICAgIGNvbmZpZy51c2VyTmFtZSA9PT0gdW5kZWZpbmVkXHJcbiAgICApIHtcclxuICAgICAgc2V0VXNlck5hbWUoKTtcclxuICAgIH1cclxuICAgIHNhdmVDaGF0U3RhdGVUb1N0b3JhZ2UoRVhQQU5ERUQpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0Q2hhdFN0YXRlRnJvbVN0b3JhZ2UoKSB7XHJcbiAgICBzdG9yYWdlTWFuYWdlclxyXG4gICAgICAuc2VuZFJlcXVlc3RUb1N0b3JhZ2UoZ2V0RXh0cmFQYXRoKENIQVRfU1RBVEVfRklFTEQpLCBIVFRQX0dFVCwgXCJcIilcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gc2F2ZUNoYXRTdGF0ZShkYXRhKSB7XHJcbiAgICAgICAgY29uZmlnLmNoYXRTdGF0ZSA9IGRhdGE7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gaW5pdENoYXRTdGF0ZSgpIHtcclxuICAgIGdldENoYXRTdGF0ZUZyb21TdG9yYWdlKCk7XHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uIHJlc29sdmVDaGF0U3RhdGUoKSB7XHJcbiAgICAgIGlmIChcclxuICAgICAgICBjb25maWcuY2hhdFN0YXRlID09PSBudWxsIHx8XHJcbiAgICAgICAgY29uZmlnLmNoYXRTdGF0ZSA9PT0gdW5kZWZpbmVkIHx8XHJcbiAgICAgICAgY29uZmlnLmNoYXRTdGF0ZSA9PT0gXCJcIlxyXG4gICAgICApIHtcclxuICAgICAgICBzYXZlQ2hhdFN0YXRlVG9TdG9yYWdlKENPTExBUFNFRCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY29uZmlnLmNoYXRTdGF0ZSA9PT0gRVhQQU5ERUQpIHtcclxuICAgICAgICBleHBhbmRDaGF0KCk7XHJcbiAgICAgIH1cclxuICAgICAgRE0uYWRkQ1NTQ2xhc3MoQ0hBVF9JVEVNLCBjb25maWcuY2hhdFN0YXRlKTtcclxuICAgIH0sIFJFUVVFU1RfVElNRU9VVCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjaGFuZ2VDaGF0U3RhdGUoKSB7XHJcbiAgICBzd2l0Y2ggKGNvbmZpZy5jaGF0U3RhdGUpIHtcclxuICAgICAgY2FzZSBDT0xMQVBTRUQ6XHJcbiAgICAgICAgZXhwYW5kQ2hhdCgpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIEVYUEFOREVEOlxyXG4gICAgICAgIGNvbGxhcHNlQ2hhdCgpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcclxuICAgICAgICAgIFwiVW5leHBlY3RlZCBrZXkvdmFsdWUgcGFpcjogXCIgKyBDSEFUX0lURU0gKyBcIi9cIiArIGNvbmZpZy5jaGF0U3RhdGVcclxuICAgICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdGhpcy5hcHBlbmRTdHlsZXNoZWV0ID0gZnVuY3Rpb24gYXBwZW5kU3R5bGVzaGVldCgpIHtcclxuICAgIHZhciBzdHlsZUVsZW1lbnQgPSBETS5jcmVhdGVET01FbGVtZW50KFwibGlua1wiKTtcclxuXHJcbiAgICBzdHlsZUVsZW1lbnQucmVsID0gXCJzdHlsZXNoZWV0XCI7XHJcbiAgICBzdHlsZUVsZW1lbnQudHlwZSA9IFwidGV4dC9jc3NcIjtcclxuICAgIHN0eWxlRWxlbWVudC5ocmVmID0gUEFUSF9UT19TVFlMRVNIRUVUO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChkb2N1bWVudC5oZWFkLCBzdHlsZUVsZW1lbnQpO1xyXG4gIH07XHJcblxyXG4gIGZ1bmN0aW9uIGFwcGVuZFRvZ2dsZUJ1dHRvbihjb250YWluZXIpIHtcclxuICAgIHZhciB0b2dnbGVCdXR0b24gPSBETS5jcmVhdGVET01FbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgRE0uYWRkQ1NTQ2xhc3ModG9nZ2xlQnV0dG9uLCBUT0dHTEVfQlVUVE9OKTtcclxuICAgIHRvZ2dsZUJ1dHRvbi5pZCA9IFRPR0dMRV9CVVRUT047XHJcbiAgICB0b2dnbGVCdXR0b24uaW5uZXJIVE1MID1cclxuICAgICAgY29uZmlnLmNoYXRTdGF0ZSA9PT0gRVhQQU5ERUQgPyBDT0xMQVBTRV9NQVJLIDogRVhQQU5EX01BUks7XHJcbiAgICBETS5hZGRMaXN0ZW5lcih0b2dnbGVCdXR0b24sIFwiY2xpY2tcIiwgY2hhbmdlQ2hhdFN0YXRlKTtcclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQoY29udGFpbmVyLCB0b2dnbGVCdXR0b24pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2V0RHJhZ0hhbmRsZXIoY29udGFpbmVyKSB7XHJcbiAgICBmdW5jdGlvbiBnZXRDb29yZGluYXRlcyhlbGVtKSB7XHJcbiAgICAgIHZhciBib3ggPSBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHRvcDogYm94LnRvcCArIHdpbmRvdy5wYWdlWU9mZnNldCxcclxuICAgICAgICBsZWZ0OiBib3gubGVmdCArIHdpbmRvdy5wYWdlWE9mZnNldFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIERNLmFkZExpc3RlbmVyKGNvbnRhaW5lciwgXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24gb25Nb3VzZURvd24oZXZlbnQpIHtcclxuICAgICAgdmFyIGNoYXQgPSBETS5nZXRET01FbGVtZW50KENIQVRfSVRFTSk7XHJcbiAgICAgIHZhciBjb29yZGluYXRlcyA9IGdldENvb3JkaW5hdGVzKGNoYXQpO1xyXG4gICAgICB2YXIgc2hpZnRYID0gZXZlbnQucGFnZVggLSBjb29yZGluYXRlcy5sZWZ0O1xyXG4gICAgICB2YXIgc2hpZnRZID0gZXZlbnQucGFnZVkgLSBjb29yZGluYXRlcy50b3A7XHJcbiAgICAgIHZhciBtb3VzZU1vdmVIYW5kbGVyO1xyXG4gICAgICB2YXIgbW91c2VVcEhhbmRsZXI7XHJcblxyXG4gICAgICBpZiAoZXZlbnQudGFyZ2V0LnRhZ05hbWUgPT09IFwiQlVUVE9OXCIpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIG1vdmVBdChlKSB7XHJcbiAgICAgICAgY2hhdC5zdHlsZS5sZWZ0ID0gZS5wYWdlWCAtIHNoaWZ0WCArIFwicHhcIjtcclxuICAgICAgICBjaGF0LnN0eWxlLnRvcCA9IGUucGFnZVkgLSBzaGlmdFkgKyBcInB4XCI7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIG1vdXNlTW92ZUhhbmRsZXIgPSBmdW5jdGlvbiBvbk1vdXNlTW92ZShlKSB7XHJcbiAgICAgICAgbW92ZUF0KGUpO1xyXG4gICAgICB9O1xyXG4gICAgICBtb3VzZVVwSGFuZGxlciA9IGZ1bmN0aW9uIG9uTW91c2VVcCgpIHtcclxuICAgICAgICBETS5yZW1vdmVMaXN0ZW5lcihkb2N1bWVudCwgXCJtb3VzZW1vdmVcIiwgbW91c2VNb3ZlSGFuZGxlcik7XHJcbiAgICAgICAgRE0ucmVtb3ZlTGlzdGVuZXIoY29udGFpbmVyLCBcIm1vdXNldXBcIiwgbW91c2VVcEhhbmRsZXIpO1xyXG4gICAgICB9O1xyXG4gICAgICBtb3ZlQXQoZXZlbnQpO1xyXG4gICAgICBETS5hZGRMaXN0ZW5lcihkb2N1bWVudCwgXCJtb3VzZW1vdmVcIiwgbW91c2VNb3ZlSGFuZGxlcik7XHJcbiAgICAgIERNLmFkZExpc3RlbmVyKGNvbnRhaW5lciwgXCJtb3VzZXVwXCIsIG1vdXNlVXBIYW5kbGVyKTtcclxuICAgIH0pO1xyXG5cclxuICAgIERNLmFkZExpc3RlbmVyKGNvbnRhaW5lciwgXCJkcmFnc3RhcnRcIiwgZnVuY3Rpb24gb25EcmFnU3RhcnQoKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgdGhpcy5jcmVhdGVDaGF0TWFya3VwID0gZnVuY3Rpb24gY3JlYXRlQ2hhdE1hcmt1cCgpIHtcclxuICAgIHZhciBjb250YWluZXIgPSBETS5jcmVhdGVET01FbGVtZW50KFwiZmllbGRzZXRcIik7XHJcbiAgICB2YXIgbGVnZW5kID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImxlZ2VuZFwiKTtcclxuICAgIHZhciB0b2dnbGVCdXR0b25Db250YWluZXIgPSBETS5jcmVhdGVET01FbGVtZW50KFwiZGl2XCIpO1xyXG5cclxuICAgIGNvbnRhaW5lci5pZCA9IENIQVRfSVRFTTtcclxuICAgIERNLmFkZENTU0NsYXNzKFxyXG4gICAgICBjb250YWluZXIsXHJcbiAgICAgIFwiY2hhdC1jb250YWluZXJcIixcclxuICAgICAgZ2V0UG9zaXRpb25DbGFzcygpLFxyXG4gICAgICBjb25maWcuY3NzQ2xhc3NcclxuICAgICk7XHJcbiAgICBsZWdlbmQuaW5uZXJIVE1MID0gY29uZmlnLmNoYXRUaXRsZTtcclxuICAgIERNLmFkZENTU0NsYXNzKGxlZ2VuZCwgXCJjaGF0LWxlZ2VuZFwiKTtcclxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChsZWdlbmQpO1xyXG4gICAgRE0uYWRkQ1NTQ2xhc3ModG9nZ2xlQnV0dG9uQ29udGFpbmVyLCBcImNoYXQtdG9nZ2xlLWJ1dHRvbi1jb250YWluZXJcIik7XHJcbiAgICBpZiAoY29uZmlnLmFsbG93RHJhZyA9PT0gXCJ0cnVlXCIpIHtcclxuICAgICAgRE0uYWRkQ1NTQ2xhc3MoXHJcbiAgICAgICAgdG9nZ2xlQnV0dG9uQ29udGFpbmVyLFxyXG4gICAgICAgIFwiY2hhdC10b2dnbGUtYnV0dG9uLWNvbnRhaW5lci1kcmFnXCJcclxuICAgICAgKTtcclxuICAgICAgc2V0RHJhZ0hhbmRsZXIodG9nZ2xlQnV0dG9uQ29udGFpbmVyKTtcclxuICAgIH1cclxuICAgIGlmIChjb25maWcuYWxsb3dNaW5pbWl6ZSA9PT0gXCJ0cnVlXCIpIHtcclxuICAgICAgYXBwZW5kVG9nZ2xlQnV0dG9uKHRvZ2dsZUJ1dHRvbkNvbnRhaW5lcik7XHJcbiAgICB9IGVsc2UgaWYgKGNvbmZpZy5hbGxvd01pbmltaXplID09PSBcImZhbHNlXCIpIHtcclxuICAgICAgc2F2ZUNoYXRTdGF0ZVRvU3RvcmFnZShFWFBBTkRFRCk7XHJcbiAgICB9XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KGNvbnRhaW5lciwgdG9nZ2xlQnV0dG9uQ29udGFpbmVyKTtcclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQoZG9jdW1lbnQuYm9keSwgY29udGFpbmVyKTtcclxuICAgIGluaXRDaGF0U3RhdGUoKTtcclxuICB9O1xyXG5cclxuICBmdW5jdGlvbiBnZXRQYXJhbXNGcm9tUmVxdWVzdCgpIHtcclxuICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYztcclxuICAgIHJldHVybiBzY3JpcHRcclxuICAgICAgLnN1YnN0cihzY3JpcHQuaW5kZXhPZihcIj9cIikgKyAxKVxyXG4gICAgICAuc3BsaXQoXCImXCIpXHJcbiAgICAgIC5yZWR1Y2UoZnVuY3Rpb24gcmVkdWNlcihwYXJhbSwgZWwpIHtcclxuICAgICAgICB2YXIgcGFydHMgPSBlbC5zcGxpdChcIj1cIik7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzFdKTtcclxuICAgICAgICBwYXJhbVtkZWNvZGVVUklDb21wb25lbnQocGFydHNbMF0pXSA9IHZhbHVlLnN1YnN0cigxLCB2YWx1ZS5sZW5ndGggLSAyKTtcclxuICAgICAgICByZXR1cm4gcGFyYW07XHJcbiAgICAgIH0sIHt9KTtcclxuICB9XHJcblxyXG4gIHRoaXMuc2V0Q29uZmlnID0gZnVuY3Rpb24gc2V0Q29uZmlnKCkge1xyXG4gICAgdmFyIHJlcXVlc3RDb25maWcgPSBnZXRQYXJhbXNGcm9tUmVxdWVzdCgpO1xyXG4gICAgdmFyIHByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgT2JqZWN0LmtleXMocmVxdWVzdENvbmZpZykuZm9yRWFjaChmdW5jdGlvbiBhcHBseVByb3BlcnRpZXMoa2V5KSB7XHJcbiAgICAgIHByb3BlcnR5VmFsdWUgPSByZXF1ZXN0Q29uZmlnW2tleV07XHJcbiAgICAgIGlmIChwcm9wZXJ0eVZhbHVlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgY29uZmlnW2tleV0gPSBwcm9wZXJ0eVZhbHVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICB0aGlzLnNldFVuaXF1ZVVzZXJJRCA9IGZ1bmN0aW9uIHNldFVuaXF1ZVVzZXJJRCgpIHtcclxuICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShVU0VSX0lEKSA9PT0gbnVsbCkge1xyXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShVU0VSX0lELCBcInVzZXJcIi5jb25jYXQoRGF0ZS5ub3coKS50b1N0cmluZygpKSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIHRoaXM7XHJcbn0pKGNvbmZpZyk7XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgZnVuY3Rpb24gaW5pdFBhZ2UoKSB7XHJcbiAgY2hhdEZhY3RvcnkuYXBwZW5kU3R5bGVzaGVldCgpO1xyXG4gIGNoYXRGYWN0b3J5LnNldFVuaXF1ZVVzZXJJRCgpO1xyXG4gIGNoYXRGYWN0b3J5LmNyZWF0ZUNoYXRNYXJrdXAoKTtcclxufSk7XHJcblxyXG5jaGF0RmFjdG9yeS5zZXRDb25maWcoKTsiXX0=
