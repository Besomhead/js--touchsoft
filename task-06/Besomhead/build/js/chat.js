var MARKUP_TIMEOUT=5e3,config={chatTitle:"Чат",chatState:"",userName:"",chatURL:"https://besomhead-chat.firebaseio.com/",cssClass:"chat-container",position:"right",allowMinimize:"true",allowDrag:"false",requireName:"false",showDateTime:"true",requests:"fetch",updates:"refetch",messagesLength:"0"},DM=function(){function e(){}return e.prototype.getDOMElement=function(e){return"string"==typeof e?document.getElementById(e):e},e.prototype.getDOMChildrenByTag=function(e,t){return Array.from(this.getDOMElement(e).getElementsByTagName(t))},e.prototype.getDOMChildrenByClass=function(e,t){return Array.from(this.getDOMElement(e).getElementsByClassName(t))},e.prototype.createDOMElement=document.createElement.bind(document),e.prototype.appendDOMElement=function(e,t){this.getDOMElement(e).appendChild(t)},e.prototype.removeDOMElement=function(e,t){this.getDOMElement(e).removeChild(this.getDOMElement(t))},e.prototype.addListener=function(e,t,n){this.getDOMElement(e).addEventListener(t,n)},e.prototype.removeListener=function(e,t,n){this.getDOMElement(e).removeEventListener(t,n)},e.prototype.addCSSClass=function(t){var n=this;Array.from(arguments).slice(1).forEach(function(e){n.getDOMElement(t).classList.add(e)})},e.prototype.removeCSSClass=function(e,t){this.getDOMElement(e).classList.remove(t)},new e}(),messageFactory=function(){function e(){}function a(e,t,n){var a,s,o;this.day=e.getDate(),this.month=e.getMonth(),this.time=(s=(a=e).getHours(),o=a.getMinutes(),(s<10?"0":"").concat(s.toString()).concat(":").concat(o<10?"0":"").concat(o.toString())),this.sender=t,this.body=n}return e.prototype.getMessage=function(e,t,n){return new a(e,t,n)},new e}(),HTTP_GET="GET",HTTP_POST="POST",HTTP_PUT="PUT",REQUEST_FETCH="fetch",REQUEST_XHR="xhr",storageManager=function(i){function e(){}function c(e,t,n){return fetch(storageManager.getStoragePath(e),(a=t,s=n,o={method:a,headers:{Accept:"application/json","Content-Type":"application/json"}},a!==HTTP_GET&&(o.body=JSON.stringify(s)),o)).then(function(e){return e.json()}).then(function(e){return e});var a,s,o}return e.prototype.getStoragePath=function(e){return i.chatURL+e+".json"},e.prototype.sendRequestToStorage=function(e,t,n){var a,s,o,r;return i.requests===REQUEST_FETCH?a=c(e,t,n):i.requests===REQUEST_XHR&&(s=e,o=t,r=n,a=new Promise(function(e,t){var n=new XMLHttpRequest;n.open(o,storageManager.getStoragePath(s),!0),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Content-Type","application/json"),n.addEventListener("load",function(){e(JSON.parse(n.response))}),n.addEventListener("error",function(){t(n.statusText)}),n.send(JSON.stringify(r))})),a},new e}(config),updatesManager=function(){function e(){this.responseData=void 0}return e.prototype.getDataFromStorage=function(e){var t=new XMLHttpRequest;t.addEventListener("readystatechange",function(){var e=t.responseText;if(this.status&&this.responseText){if(e.lastIndexOf("event:")!==e.lastIndexOf("event: put"))return;window.postMessage(JSON.parse(e.slice(e.lastIndexOf("data:")+"data:".length,e.lastIndexOf("}")+1)),window.location)}}),t.open("GET",storageManager.getStoragePath(e),!0),t.setRequestHeader("Accept","text/event-stream"),t.send()},new e}(),chatFactory=function(i){var s,t="chat-user-id",o="chat-collapsed",r="chat-expanded",u="chat",c="chat-messages",d="chat-input-box",l="chat-input-txt",M="chat-message-button",m="chat-toggle-button",p="[ ]",g="-",D=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],n=15e3,e="Вы",h="userName",a="chatState",f="messages",E="read",S="chat-username-prompt-container",T="chat-username-prompt-input",O="chat-username-prompt-button",C=3e3;function v(){}function y(e){return localStorage.getItem(t)+"/"+e}function w(e){i.chatState=e,storageManager.sendRequestToStorage(y(a),HTTP_PUT,e)}function L(e,t){var n=DM.createDOMElement("div");n.innerHTML=t,DM.appendDOMElement(e,n)}function b(e,t){var n,a,s,o,r;n=u.concat("-").concat(t.day).concat("-").concat(t.month),null===DM.getDOMElement(n)&&((a=DM.createDOMElement("div")).id=n,DM.addCSSClass(a,"chat-messages-container"),"true"===i.showDateTime?(DM.addCSSClass(a,"chat-messages-container-with-time"),s=e,o=t,(r=DM.createDOMElement("legend")).innerHTML=o.day.toString().concat(" ").concat(D[+o.month]),DM.addCSSClass(r,"chat-day-of-month"),DM.appendDOMElement(s,r)):"false"===i.showDateTime&&DM.addCSSClass(a,"chat-messages-container-no-time"),DM.appendDOMElement(e,a)),a=DM.getDOMElement(n),"true"===i.showDateTime&&L(a,t.time),L(a,t.sender),L(a,t.body)}function H(t,n){var e=Object.keys(n);i.messagesLength=e.length,e.forEach(function(e){b(t,n[e])})}function P(){i.chatState!==o?storageManager.sendRequestToStorage(y(f),HTTP_GET,"").then(function(t){var e=Object.keys(t).slice(1);setTimeout(P,n),t&&(i.messagesLength>=e.length||(e.slice(i.messagesLength).forEach(function(e){b(DM.getDOMElement(c),t[e])}),i.messagesLength=e.length))}):setTimeout(P,n)}function R(e){var t=e.data.data;if("/"!==e.data.path)-1===(s[e.data.path.split("/").pop()]=t).sender.indexOf(i.userName)&&i.chatState!==o&&b(DM.getDOMElement(c),t);else{if(s=t,i.chatState===o)return;chatFactory.appendMessages(DM.getDOMElement(c),s)}}function U(){var e,t,n=DM.getDOMElement(l);""!==n.value&&(e=messageFactory.getMessage(new Date,i.userName.concat(":"),n.value),n.value="",b(DM.getDOMElement(c),e),t=e,storageManager.sendRequestToStorage(y(f),HTTP_POST,t),storageManager.sendRequestToStorage(y(E),HTTP_PUT,!1))}function N(){var e;return"left"===i.position?e="chat-container-left":"right"===i.position&&(e="chat-container-right"),e}function q(e){DM.getDOMElement(l).disabled=!e,DM.getDOMElement(M).disabled=!e,null!==DM.getDOMElement(m)&&(DM.getDOMElement(m).disabled=!e)}function x(){var e,t,n,a;e=DM.createDOMElement("div"),t=DM.createDOMElement("label"),n=DM.createDOMElement("input"),a=DM.createDOMElement("button"),e.id=S,DM.addCSSClass(e,"chat-prompt-container",N()),n.id=T,DM.addCSSClass(n,"chat-prompt-input"),t.for=n.id,t.innerHTML="Пожалуйста, представьтесь:",a.id=O,DM.addCSSClass(a,"chat-prompt-button"),a.innerHTML="Сохранить",DM.appendDOMElement(e,t),DM.appendDOMElement(e,n),DM.appendDOMElement(e,a),DM.appendDOMElement(u,e),q(!1),DM.addListener(O,"click",function(){var e=DM.getDOMElement(T).value;e.length<1||(i.userName=e,DM.removeDOMElement(u,S),q(!0),storageManager.sendRequestToStorage(y(h),HTTP_PUT,i.userName))})}function _(){storageManager.sendRequestToStorage(y(h),HTTP_GET,"").then(function(e){i.userName=e}),setTimeout(function(){null!==i.userName&&void 0!==i.userName&&""!==i.userName||("true"===i.requireName?x():(i.userName=e,storageManager.sendRequestToStorage(y(h),HTTP_PUT,i.userName)))},C)}function k(){var e,t,n,a;DM.removeCSSClass(u,o),DM.addCSSClass(u,r),"true"===i.allowMinimize&&(DM.getDOMElement(m).innerHTML=g),(e=DM.createDOMElement("div")).id=c,DM.addCSSClass(e,"chat-messages-external"),DM.appendDOMElement(u,e),s&&H(DM.getDOMElement(c),s),t=DM.createDOMElement("div"),n=DM.createDOMElement("textarea"),a=DM.createDOMElement("button"),t.id=d,DM.addCSSClass(t,"chat-input-container"),n.id=l,DM.addCSSClass(n,"chat-input-textarea"),DM.appendDOMElement(t,n),a.id=M,DM.addCSSClass(a,"chat-message-button"),a.innerHTML="Отправить",DM.addListener(a,"click",U),DM.appendDOMElement(t,a),DM.appendDOMElement(u,t),""!==i.userName&&null!==i.userName&&void 0!==i.userName||_(),w(r)}function I(){storageManager.sendRequestToStorage(y(a),HTTP_GET,"").then(function(e){i.chatState=e}),setTimeout(function(){null===i.chatState||void 0===i.chatState||""===i.chatState?w(o):i.chatState===r&&k(),DM.addCSSClass(u,i.chatState)},C)}function F(){switch(i.chatState){case o:k();break;case r:i.messagesLength=0,DM.removeCSSClass(u,r),DM.addCSSClass(u,o),DM.getDOMElement(m).innerHTML=p,DM.removeDOMElement(u,c),DM.removeDOMElement(u,d),w(o);break;default:throw new Error("Unexpected key/value pair: "+u+"/"+i.chatState)}}function j(d){DM.addListener(d,"mousedown",function(e){var t,n,a,s=DM.getDOMElement(u),o={top:(t=s.getBoundingClientRect()).top+window.pageYOffset,left:t.left+window.pageXOffset},r=e.pageX-o.left,i=e.pageY-o.top;function c(e){s.style.left=e.pageX-r+"px",s.style.top=e.pageY-i+"px"}"BUTTON"!==e.target.tagName&&(n=function(e){c(e)},a=function(){DM.removeListener(document,"mousemove",n),DM.removeListener(d,"mouseup",a)},c(e),DM.addListener(document,"mousemove",n),DM.addListener(d,"mouseup",a))}),DM.addListener(d,"dragstart",function(){return!1})}return v.prototype.appendMessages=function(t,e){e?H(t,e):storageManager.sendRequestToStorage(y(f),HTTP_GET,"").then(function(e){e&&H(t,e)})},v.prototype.subscribeOnUpdates=function(){"refetch"===i.updates?P():"longPolling"===i.updates&&(window.addEventListener("message",R),updatesManager.getDataFromStorage(y(f)))},v.prototype.appendStylesheet=function(){var e=DM.createDOMElement("link");e.rel="stylesheet",e.type="text/css",e.href="https://rawgit.com/Besomhead/js--touchsoft/besomhead-task05/task-05/Besomhead/build/css/chat_styles.css",DM.appendDOMElement(document.head,e)},v.prototype.createChatMarkup=function(){var e,t,n=DM.createDOMElement("fieldset"),a=DM.createDOMElement("legend"),s=DM.createDOMElement("div");n.id=u,DM.addCSSClass(n,"chat-container",N(),i.cssClass),a.innerHTML=i.chatTitle,DM.addCSSClass(a,"chat-legend"),n.appendChild(a),DM.addCSSClass(s,"chat-toggle-button-container"),"true"===i.allowDrag&&(DM.addCSSClass(s,"chat-toggle-button-container-drag"),j(s)),"true"===i.allowMinimize?(e=s,t=DM.createDOMElement("button"),DM.addCSSClass(t,m),t.id=m,t.innerHTML=i.chatState===r?g:p,DM.addListener(t,"click",F),DM.appendDOMElement(e,t)):"false"===i.allowMinimize&&w(r),DM.appendDOMElement(n,s),DM.appendDOMElement(document.body,n),I()},v.prototype.setConfig=function(){var e,t,n=(e=document.currentScript.src).substr(e.indexOf("?")+1).split("&").reduce(function(e,t){var n=t.split("="),a=decodeURIComponent(n[1]);return e[decodeURIComponent(n[0])]=a.substr(1,a.length-2),e},{});Object.keys(n).forEach(function(e){""!==(t=n[e])&&(i[e]=t)})},v.prototype.setUniqueUserID=function(){null===localStorage.getItem(t)&&localStorage.setItem(t,"user".concat(Date.now().toString()))},new v}(config);window.addEventListener("load",function(){chatFactory.appendStylesheet(),chatFactory.setUniqueUserID(),chatFactory.createChatMarkup(),setTimeout(chatFactory.subscribeOnUpdates,MARKUP_TIMEOUT)}),chatFactory.setConfig();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoYXQuanMiXSwibmFtZXMiOlsiTUFSS1VQX1RJTUVPVVQiLCJjb25maWciLCJjaGF0VGl0bGUiLCJjaGF0U3RhdGUiLCJ1c2VyTmFtZSIsImNoYXRVUkwiLCJjc3NDbGFzcyIsInBvc2l0aW9uIiwiYWxsb3dNaW5pbWl6ZSIsImFsbG93RHJhZyIsInJlcXVpcmVOYW1lIiwic2hvd0RhdGVUaW1lIiwicmVxdWVzdHMiLCJ1cGRhdGVzIiwibWVzc2FnZXNMZW5ndGgiLCJETSIsIkRPTU1hbmFnZXIiLCJwcm90b3R5cGUiLCJnZXRET01FbGVtZW50IiwiaWR0ZiIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRET01DaGlsZHJlbkJ5VGFnIiwicm9vdCIsInRhZyIsIkFycmF5IiwiZnJvbSIsInRoaXMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImdldERPTUNoaWxkcmVuQnlDbGFzcyIsImNsYXNzTmFtZSIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJjcmVhdGVET01FbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsImJpbmQiLCJhcHBlbmRET01FbGVtZW50IiwiZWxlbWVudCIsImFwcGVuZENoaWxkIiwicmVtb3ZlRE9NRWxlbWVudCIsInJlbW92ZUNoaWxkIiwiYWRkTGlzdGVuZXIiLCJldmVudCIsImNhbGxiYWNrIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUxpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFkZENTU0NsYXNzIiwic2VsZiIsImFyZ3VtZW50cyIsInNsaWNlIiwiZm9yRWFjaCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZUNTU0NsYXNzIiwicmVtb3ZlIiwibWVzc2FnZUZhY3RvcnkiLCJNZXNzYWdlRmFjdG9yeSIsIk1lc3NhZ2UiLCJkYXRlIiwic2VuZGVyIiwiYm9keSIsImhvdXJzIiwibWludXRlcyIsImRheSIsImdldERhdGUiLCJtb250aCIsImdldE1vbnRoIiwidGltZSIsImdldEhvdXJzIiwiZ2V0TWludXRlcyIsImNvbmNhdCIsInRvU3RyaW5nIiwiZ2V0TWVzc2FnZSIsIkhUVFBfR0VUIiwiSFRUUF9QT1NUIiwiSFRUUF9QVVQiLCJSRVFVRVNUX0ZFVENIIiwiUkVRVUVTVF9YSFIiLCJzdG9yYWdlTWFuYWdlciIsIlN0b3JhZ2VNYW5hZ2VyIiwic2VuZFJlcXVlc3RUb1N0b3JhZ2VCeUZldGNoIiwiZXh0cmFQYXRoIiwicmVxdWVzdE1ldGhvZCIsImRhdGEiLCJmZXRjaCIsImdldFN0b3JhZ2VQYXRoIiwiY29uZmlnT2JqIiwibWV0aG9kIiwiaGVhZGVycyIsIkFjY2VwdCIsIkNvbnRlbnQtVHlwZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwicmVzcG9uc2VEYXRhIiwic2VuZFJlcXVlc3RUb1N0b3JhZ2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInhociIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsInNldFJlcXVlc3RIZWFkZXIiLCJwYXJzZSIsInN0YXR1c1RleHQiLCJzZW5kIiwidXBkYXRlc01hbmFnZXIiLCJVcGRhdGVzTWFuYWdlciIsInVuZGVmaW5lZCIsImdldERhdGFGcm9tU3RvcmFnZSIsInhodHRwIiwicmVzcG9uc2VUZXh0Iiwic3RhdHVzIiwibGFzdEluZGV4T2YiLCJ3aW5kb3ciLCJwb3N0TWVzc2FnZSIsImxlbmd0aCIsImxvY2F0aW9uIiwiY2hhdEZhY3RvcnkiLCJ1c2VyTWVzc2FnZXMiLCJVU0VSX0lEIiwiQ09MTEFQU0VEIiwiRVhQQU5ERUQiLCJDSEFUX0lURU0iLCJNRVNTQUdFU19MSVNUIiwiSU5QVVRfQk9YIiwiSU5QVVRfVEVYVCIsIkNIQVRfTUVTU0FHRV9CVVRUT05fSUQiLCJUT0dHTEVfQlVUVE9OIiwiRVhQQU5EX01BUksiLCJDT0xMQVBTRV9NQVJLIiwibW9udGhzIiwiUkVQTFlfVElNRU9VVCIsIkRFRkFVTFRfVVNFUl9OQU1FIiwiVVNFUl9OQU1FX0ZJRUxEIiwiQ0hBVF9TVEFURV9GSUVMRCIsIk1FU1NBR0VTX0ZJRUxEIiwiUkVBRF9GSUVMRCIsIlVTRVJfTkFNRV9QUk9NUFRfSUQiLCJQUk9NUFRfSU5QVVRfSUQiLCJQUk9NUFRfQ09ORklSTV9CVVRUT05fSUQiLCJSRVFVRVNUX1RJTUVPVVQiLCJDaGF0RmFjdG9yeSIsImdldEV4dHJhUGF0aCIsInBhdGgiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic2F2ZUNoYXRTdGF0ZVRvU3RvcmFnZSIsInN0YXRlIiwiYXBwZW5kTWVzc2FnZVBhcnQiLCJjb250YWluZXIiLCJpbm5lckhUTUwiLCJlbCIsImFwcGVuZFNpbmdsZU1lc3NhZ2UiLCJtZXNzYWdlIiwiY29udGFpbmVySWQiLCJtZXNzYWdlc0NvbnRhaW5lciIsImRheU9mTW9udGgiLCJpZCIsInNob3dNZXNzYWdlcyIsIm1lc3NhZ2VzIiwibWVzc2FnZXNLZXlzIiwiT2JqZWN0Iiwia2V5cyIsImtleSIsInVwZGF0ZU1lc3NhZ2VzTGlzdCIsInNldFRpbWVvdXQiLCJ1cGRhdGVNZXNzYWdlcyIsInNwbGl0IiwicG9wIiwiaW5kZXhPZiIsImFwcGVuZE1lc3NhZ2VzIiwic2VuZE1lc3NhZ2UiLCJpbnB1dFRleHRBcmVhIiwidmFsdWUiLCJEYXRlIiwiZ2V0UG9zaXRpb25DbGFzcyIsInBvc2l0aW9uQ2xhc3MiLCJzZXRPdGhlckNvbXBvbmVudHNBdmFpbGFiaWxpdHkiLCJpc0F2YWlsYWJsZSIsImRpc2FibGVkIiwiYXNrVXNlck5hbWUiLCJwcm9tcHRDb250YWluZXIiLCJwcm9tcHRMYWJlbCIsInByb21wdElucHV0IiwicHJvbXB0Q29uZmlybUJ1dHRvbiIsImZvciIsInNldFVzZXJOYW1lIiwiZXhwYW5kQ2hhdCIsIm1lc3NhZ2VzTGlzdENvbnRhaW5lciIsImlucHV0TWVzc2FnZUNvbnRhaW5lciIsIm1lc3NhZ2VCdXR0b24iLCJpbml0Q2hhdFN0YXRlIiwiY2hhbmdlQ2hhdFN0YXRlIiwiRXJyb3IiLCJzZXREcmFnSGFuZGxlciIsImJveCIsIm1vdXNlTW92ZUhhbmRsZXIiLCJtb3VzZVVwSGFuZGxlciIsImNoYXQiLCJjb29yZGluYXRlcyIsInRvcCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInBhZ2VZT2Zmc2V0IiwibGVmdCIsInBhZ2VYT2Zmc2V0Iiwic2hpZnRYIiwicGFnZVgiLCJzaGlmdFkiLCJwYWdlWSIsIm1vdmVBdCIsImUiLCJzdHlsZSIsInRhcmdldCIsInRhZ05hbWUiLCJzdWJzY3JpYmVPblVwZGF0ZXMiLCJhcHBlbmRTdHlsZXNoZWV0Iiwic3R5bGVFbGVtZW50IiwicmVsIiwidHlwZSIsImhyZWYiLCJoZWFkIiwiY3JlYXRlQ2hhdE1hcmt1cCIsInRvZ2dsZUJ1dHRvbiIsImxlZ2VuZCIsInRvZ2dsZUJ1dHRvbkNvbnRhaW5lciIsInNldENvbmZpZyIsInNjcmlwdCIsInByb3BlcnR5VmFsdWUiLCJyZXF1ZXN0Q29uZmlnIiwiY3VycmVudFNjcmlwdCIsInNyYyIsInN1YnN0ciIsInJlZHVjZSIsInBhcmFtIiwicGFydHMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJzZXRVbmlxdWVVc2VySUQiLCJzZXRJdGVtIiwibm93Il0sIm1hcHBpbmdzIjoiQUFHQSxJQUFJQSxlQUFpQixJQUVqQkMsT0FBUyxDQUNYQyxVQUFXLE1BQ1hDLFVBQVcsR0FDWEMsU0FBVSxHQUNWQyxRQUFTLHlDQUNUQyxTQUFVLGlCQUNWQyxTQUFVLFFBQ1ZDLGNBQWUsT0FDZkMsVUFBVyxRQUNYQyxZQUFhLFFBQ2JDLGFBQWMsT0FDZEMsU0FBVSxRQUNWQyxRQUFTLFVBQ1RDLGVBQWdCLEtBS2RDLEdBQUssV0FDUCxTQUFTQyxLQXVEVCxPQXJEQUEsRUFBV0MsVUFBVUMsY0FBZ0IsU0FBb0JDLEdBQ3ZELE1BQXVCLGlCQUFUQSxFQUFvQkMsU0FBU0MsZUFBZUYsR0FBUUEsR0FFcEVILEVBQVdDLFVBQVVLLG9CQUFzQixTQUN6Q0MsRUFDQUMsR0FFQSxPQUFPQyxNQUFNQyxLQUFLQyxLQUFLVCxjQUFjSyxHQUFNSyxxQkFBcUJKLEtBRWxFUixFQUFXQyxVQUFVWSxzQkFBd0IsU0FDM0NOLEVB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WUFBWWtHLG1CQUNabEcsWUFBWXVILGtCQUNadkgsWUFBWXdHLG1CQUNaeEQsV0FBV2hELFlBQVlpRyxtQkFBb0J6TixrQkFHN0N3SCxZQUFZNEciLCJmaWxlIjoiY2hhdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xyXG4vKiBnbG9iYWwgY2hhdEZhY3RvcnkgKi9cclxuXHJcbnZhciBNQVJLVVBfVElNRU9VVCA9IDUwMDA7XHJcblxyXG52YXIgY29uZmlnID0ge1xyXG4gIGNoYXRUaXRsZTogXCLQp9Cw0YJcIixcclxuICBjaGF0U3RhdGU6IFwiXCIsXHJcbiAgdXNlck5hbWU6IFwiXCIsXHJcbiAgY2hhdFVSTDogXCJodHRwczovL2Jlc29taGVhZC1jaGF0LmZpcmViYXNlaW8uY29tL1wiLFxyXG4gIGNzc0NsYXNzOiBcImNoYXQtY29udGFpbmVyXCIsXHJcbiAgcG9zaXRpb246IFwicmlnaHRcIixcclxuICBhbGxvd01pbmltaXplOiBcInRydWVcIixcclxuICBhbGxvd0RyYWc6IFwiZmFsc2VcIixcclxuICByZXF1aXJlTmFtZTogXCJmYWxzZVwiLFxyXG4gIHNob3dEYXRlVGltZTogXCJ0cnVlXCIsXHJcbiAgcmVxdWVzdHM6IFwiZmV0Y2hcIixcclxuICB1cGRhdGVzOiBcInJlZmV0Y2hcIixcclxuICBtZXNzYWdlc0xlbmd0aDogXCIwXCJcclxufTtcclxuXHJcbi8qIGV4cG9ydGVkIERNICovXHJcblxyXG52YXIgRE0gPSAoZnVuY3Rpb24gRE9NTWFuYWdlck1vZHVsZSgpIHtcclxuICBmdW5jdGlvbiBET01NYW5hZ2VyKCkge31cclxuXHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUuZ2V0RE9NRWxlbWVudCA9IGZ1bmN0aW9uIGdldEVsZW1lbnQoaWR0Zikge1xyXG4gICAgcmV0dXJuIHR5cGVvZiBpZHRmID09PSBcInN0cmluZ1wiID8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWR0ZikgOiBpZHRmO1xyXG4gIH07XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUuZ2V0RE9NQ2hpbGRyZW5CeVRhZyA9IGZ1bmN0aW9uIGdldENoaWxkcmVuQnlUYWdOYW1lKFxyXG4gICAgcm9vdCxcclxuICAgIHRhZ1xyXG4gICkge1xyXG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5nZXRET01FbGVtZW50KHJvb3QpLmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZykpO1xyXG4gIH07XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUuZ2V0RE9NQ2hpbGRyZW5CeUNsYXNzID0gZnVuY3Rpb24gZ2V0Q2hpbGRyZW5CeUNsYXNzTmFtZShcclxuICAgIHJvb3QsXHJcbiAgICBjbGFzc05hbWVcclxuICApIHtcclxuICAgIHJldHVybiBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLmdldERPTUVsZW1lbnQocm9vdCkuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGFzc05hbWUpXHJcbiAgICApO1xyXG4gIH07XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUuY3JlYXRlRE9NRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQuYmluZChkb2N1bWVudCk7XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUuYXBwZW5kRE9NRWxlbWVudCA9IGZ1bmN0aW9uIGFwcGVuZChyb290LCBlbGVtZW50KSB7XHJcbiAgICB0aGlzLmdldERPTUVsZW1lbnQocm9vdCkuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XHJcbiAgfTtcclxuICBET01NYW5hZ2VyLnByb3RvdHlwZS5yZW1vdmVET01FbGVtZW50ID0gZnVuY3Rpb24gcmVtb3ZlKHJvb3QsIGVsZW1lbnQpIHtcclxuICAgIHRoaXMuZ2V0RE9NRWxlbWVudChyb290KS5yZW1vdmVDaGlsZCh0aGlzLmdldERPTUVsZW1lbnQoZWxlbWVudCkpO1xyXG4gIH07XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUuYWRkTGlzdGVuZXIgPSBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKFxyXG4gICAgcm9vdCxcclxuICAgIGV2ZW50LFxyXG4gICAgY2FsbGJhY2tcclxuICApIHtcclxuICAgIHRoaXMuZ2V0RE9NRWxlbWVudChyb290KS5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBjYWxsYmFjayk7XHJcbiAgfTtcclxuICBET01NYW5hZ2VyLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXIoXHJcbiAgICByb290LFxyXG4gICAgZXZlbnQsXHJcbiAgICBjYWxsYmFja1xyXG4gICkge1xyXG4gICAgdGhpcy5nZXRET01FbGVtZW50KHJvb3QpLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGNhbGxiYWNrKTtcclxuICB9O1xyXG4gIERPTU1hbmFnZXIucHJvdG90eXBlLmFkZENTU0NsYXNzID0gZnVuY3Rpb24gYWRkQ1NTQ2xhc3Mocm9vdCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgQXJyYXkuZnJvbShhcmd1bWVudHMpXHJcbiAgICAgIC5zbGljZSgxKVxyXG4gICAgICAuZm9yRWFjaChmdW5jdGlvbiBhZGRDbGFzc2VzKGNsYXNzTmFtZSkge1xyXG4gICAgICAgIHNlbGYuZ2V0RE9NRWxlbWVudChyb290KS5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XHJcbiAgICAgIH0pO1xyXG4gIH07XHJcbiAgRE9NTWFuYWdlci5wcm90b3R5cGUucmVtb3ZlQ1NTQ2xhc3MgPSBmdW5jdGlvbiByZW1vdmVDU1NDbGFzcyhcclxuICAgIHJvb3QsXHJcbiAgICBjbGFzc05hbWVcclxuICApIHtcclxuICAgIHRoaXMuZ2V0RE9NRWxlbWVudChyb290KS5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIG5ldyBET01NYW5hZ2VyKCk7XHJcbn0pKCk7XHJcbi8qIGV4cG9ydGVkIG1lc3NhZ2VGYWN0b3J5ICovXHJcblxyXG52YXIgbWVzc2FnZUZhY3RvcnkgPSAoZnVuY3Rpb24gbWVzc2FnZUZhY3RvcnlNb2R1bGUoKSB7XHJcbiAgZnVuY3Rpb24gTWVzc2FnZUZhY3RvcnkoKSB7fVxyXG5cclxuICBmdW5jdGlvbiBnZXRDdXJyZW50VGltZShkYXRlKSB7XHJcbiAgICB2YXIgaG91cnMgPSBkYXRlLmdldEhvdXJzKCk7XHJcbiAgICB2YXIgbWludXRlcyA9IGRhdGUuZ2V0TWludXRlcygpO1xyXG5cclxuICAgIHJldHVybiAoaG91cnMgPCAxMCA/IFwiMFwiIDogXCJcIilcclxuICAgICAgLmNvbmNhdChob3Vycy50b1N0cmluZygpKVxyXG4gICAgICAuY29uY2F0KFwiOlwiKVxyXG4gICAgICAuY29uY2F0KG1pbnV0ZXMgPCAxMCA/IFwiMFwiIDogXCJcIilcclxuICAgICAgLmNvbmNhdChtaW51dGVzLnRvU3RyaW5nKCkpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gTWVzc2FnZShkYXRlLCBzZW5kZXIsIGJvZHkpIHtcclxuICAgIHRoaXMuZGF5ID0gZGF0ZS5nZXREYXRlKCk7XHJcbiAgICB0aGlzLm1vbnRoID0gZGF0ZS5nZXRNb250aCgpO1xyXG4gICAgdGhpcy50aW1lID0gZ2V0Q3VycmVudFRpbWUoZGF0ZSk7XHJcbiAgICB0aGlzLnNlbmRlciA9IHNlbmRlcjtcclxuICAgIHRoaXMuYm9keSA9IGJvZHk7XHJcbiAgfVxyXG5cclxuICBNZXNzYWdlRmFjdG9yeS5wcm90b3R5cGUuZ2V0TWVzc2FnZSA9IGZ1bmN0aW9uIGdldE1lc3NhZ2UoXHJcbiAgICBkYXRlLFxyXG4gICAgc2VuZGVyLFxyXG4gICAgYm9keVxyXG4gICkge1xyXG4gICAgcmV0dXJuIG5ldyBNZXNzYWdlKGRhdGUsIHNlbmRlciwgYm9keSk7XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIG5ldyBNZXNzYWdlRmFjdG9yeSgpO1xyXG59KSgpO1xyXG4vKiBleHBvcnRlZCBzdG9yYWdlTWFuYWdlciAqL1xyXG4vKiBleHBvcnRlZCBIVFRQX0dFVCBIVFRQX1BPU1QgSFRUUF9QVVQgKi9cclxuLyogZ2xvYmFsIGNvbmZpZyAqL1xyXG5cclxudmFyIEhUVFBfR0VUID0gXCJHRVRcIjtcclxudmFyIEhUVFBfUE9TVCA9IFwiUE9TVFwiO1xyXG52YXIgSFRUUF9QVVQgPSBcIlBVVFwiO1xyXG52YXIgUkVRVUVTVF9GRVRDSCA9IFwiZmV0Y2hcIjtcclxudmFyIFJFUVVFU1RfWEhSID0gXCJ4aHJcIjtcclxuXHJcbnZhciBzdG9yYWdlTWFuYWdlciA9IChmdW5jdGlvbiBzdG9yYWdlTWFuYWdlck1vZHVsZShjb25maWcpIHtcclxuICBmdW5jdGlvbiBTdG9yYWdlTWFuYWdlcigpIHt9XHJcblxyXG4gIFN0b3JhZ2VNYW5hZ2VyLnByb3RvdHlwZS5nZXRTdG9yYWdlUGF0aCA9IGZ1bmN0aW9uIGdldFN0b3JhZ2VQYXRoKGV4dHJhUGF0aCkge1xyXG4gICAgcmV0dXJuIGNvbmZpZy5jaGF0VVJMICsgZXh0cmFQYXRoICsgXCIuanNvblwiO1xyXG4gIH07XHJcblxyXG4gIGZ1bmN0aW9uIGdldFJlcXVlc3RDb25maWdPYmoocmVxdWVzdE1ldGhvZCwgZGF0YSkge1xyXG4gICAgdmFyIGNvbmZpZ09iaiA9IHtcclxuICAgICAgbWV0aG9kOiByZXF1ZXN0TWV0aG9kLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChyZXF1ZXN0TWV0aG9kICE9PSBIVFRQX0dFVCkge1xyXG4gICAgICBjb25maWdPYmouYm9keSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBjb25maWdPYmo7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzZW5kUmVxdWVzdFRvU3RvcmFnZUJ5RmV0Y2goZXh0cmFQYXRoLCByZXF1ZXN0TWV0aG9kLCBkYXRhKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goXHJcbiAgICAgIHN0b3JhZ2VNYW5hZ2VyLmdldFN0b3JhZ2VQYXRoKGV4dHJhUGF0aCksXHJcbiAgICAgIGdldFJlcXVlc3RDb25maWdPYmoocmVxdWVzdE1ldGhvZCwgZGF0YSlcclxuICAgIClcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gZ2V0UmVzcG9uc2UocmVzcG9uc2UpIHtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbihmdW5jdGlvbiBnZXRSZXNwb25zZURhdGEocmVzcG9uc2VEYXRhKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlRGF0YTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzZW5kUmVxdWVzdFRvU3RvcmFnZUJ5WEhSKGV4dHJhUGF0aCwgbWV0aG9kLCBkYXRhKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gc2VuZFhIUlJlcXVlc3QocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuXHJcbiAgICAgIHhoci5vcGVuKG1ldGhvZCwgc3RvcmFnZU1hbmFnZXIuZ2V0U3RvcmFnZVBhdGgoZXh0cmFQYXRoKSwgdHJ1ZSk7XHJcbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQWNjZXB0XCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcclxuICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xyXG4gICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgZnVuY3Rpb24gb25Mb2FkKCkge1xyXG4gICAgICAgIHJlc29sdmUoSlNPTi5wYXJzZSh4aHIucmVzcG9uc2UpKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgZnVuY3Rpb24gb25FcnJvcigpIHtcclxuICAgICAgICByZWplY3QoeGhyLnN0YXR1c1RleHQpO1xyXG4gICAgICB9KTtcclxuICAgICAgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBTdG9yYWdlTWFuYWdlci5wcm90b3R5cGUuc2VuZFJlcXVlc3RUb1N0b3JhZ2UgPSBmdW5jdGlvbiBzZW5kUmVxdWVzdFRvU3RvcmFnZShcclxuICAgIGV4dHJhUGF0aCxcclxuICAgIG1ldGhvZCxcclxuICAgIGRhdGFcclxuICApIHtcclxuICAgIHZhciByZXNwb25zZTtcclxuXHJcbiAgICBpZiAoY29uZmlnLnJlcXVlc3RzID09PSBSRVFVRVNUX0ZFVENIKSB7XHJcbiAgICAgIHJlc3BvbnNlID0gc2VuZFJlcXVlc3RUb1N0b3JhZ2VCeUZldGNoKGV4dHJhUGF0aCwgbWV0aG9kLCBkYXRhKTtcclxuICAgIH0gZWxzZSBpZiAoY29uZmlnLnJlcXVlc3RzID09PSBSRVFVRVNUX1hIUikge1xyXG4gICAgICByZXNwb25zZSA9IHNlbmRSZXF1ZXN0VG9TdG9yYWdlQnlYSFIoZXh0cmFQYXRoLCBtZXRob2QsIGRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXNwb25zZTtcclxuICB9O1xyXG5cclxuICByZXR1cm4gbmV3IFN0b3JhZ2VNYW5hZ2VyKCk7XHJcbn0pKGNvbmZpZyk7XHJcbi8qIGV4cG9ydGVkIHVwZGF0ZXNNYW5hZ2VyICovXHJcbi8qIGdsb2JhbCBzdG9yYWdlTWFuYWdlciAqL1xyXG5cclxudmFyIHVwZGF0ZXNNYW5hZ2VyID0gKGZ1bmN0aW9uIHVwZGF0ZXNNYW5hZ2VyTW9kdWxlKCkge1xyXG4gIHZhciBKU09OX01BUksgPSBcImRhdGE6XCI7XHJcblxyXG4gIGZ1bmN0aW9uIFVwZGF0ZXNNYW5hZ2VyKCkge1xyXG4gICAgdGhpcy5yZXNwb25zZURhdGEgPSB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICBVcGRhdGVzTWFuYWdlci5wcm90b3R5cGUuZ2V0RGF0YUZyb21TdG9yYWdlID0gZnVuY3Rpb24gZ2V0RGF0YUZyb21TdG9yYWdlKFxyXG4gICAgZXh0cmFQYXRoXHJcbiAgKSB7XHJcbiAgICB2YXIgeGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuXHJcbiAgICB4aHR0cC5hZGRFdmVudExpc3RlbmVyKFwicmVhZHlzdGF0ZWNoYW5nZVwiLCBmdW5jdGlvbiBvbkRhdGFSZWNlaXZlZCgpIHtcclxuICAgICAgdmFyIHJlc3BvbnNlID0geGh0dHAucmVzcG9uc2VUZXh0O1xyXG5cclxuICAgICAgaWYgKHRoaXMuc3RhdHVzICYmIHRoaXMucmVzcG9uc2VUZXh0KSB7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgcmVzcG9uc2UubGFzdEluZGV4T2YoXCJldmVudDpcIikgIT09IHJlc3BvbnNlLmxhc3RJbmRleE9mKFwiZXZlbnQ6IHB1dFwiKVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB3aW5kb3cucG9zdE1lc3NhZ2UoXHJcbiAgICAgICAgICBKU09OLnBhcnNlKFxyXG4gICAgICAgICAgICByZXNwb25zZS5zbGljZShcclxuICAgICAgICAgICAgICByZXNwb25zZS5sYXN0SW5kZXhPZihKU09OX01BUkspICsgSlNPTl9NQVJLLmxlbmd0aCxcclxuICAgICAgICAgICAgICByZXNwb25zZS5sYXN0SW5kZXhPZihcIn1cIikgKyAxXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgICksXHJcbiAgICAgICAgICB3aW5kb3cubG9jYXRpb25cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB4aHR0cC5vcGVuKFwiR0VUXCIsIHN0b3JhZ2VNYW5hZ2VyLmdldFN0b3JhZ2VQYXRoKGV4dHJhUGF0aCksIHRydWUpO1xyXG4gICAgeGh0dHAuc2V0UmVxdWVzdEhlYWRlcihcIkFjY2VwdFwiLCBcInRleHQvZXZlbnQtc3RyZWFtXCIpO1xyXG4gICAgeGh0dHAuc2VuZCgpO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiBuZXcgVXBkYXRlc01hbmFnZXIoKTtcclxufSkoKTtcclxuLyogZXhwb3J0ZWQgY2hhdEZhY3RvcnkgKi9cclxuLyogZ2xvYmFsIGNvbmZpZyAqL1xyXG4vKiBnbG9iYWwgRE0gKi9cclxuLyogZ2xvYmFsIG1lc3NhZ2VGYWN0b3J5ICovXHJcbi8qIGdsb2JhbCBzdG9yYWdlTWFuYWdlciBIVFRQX0dFVCBIVFRQX1BPU1QgSFRUUF9QVVQgKi9cclxuLyogZ2xvYmFsIHVwZGF0ZXNNYW5hZ2VyICovXHJcblxyXG52YXIgY2hhdEZhY3RvcnkgPSAoZnVuY3Rpb24gY2hhdEZhY3RvcnlNb2R1bGUoY29uZmlnKSB7XHJcbiAgdmFyIFVTRVJfSUQgPSBcImNoYXQtdXNlci1pZFwiO1xyXG4gIHZhciBDT0xMQVBTRUQgPSBcImNoYXQtY29sbGFwc2VkXCI7XHJcbiAgdmFyIEVYUEFOREVEID0gXCJjaGF0LWV4cGFuZGVkXCI7XHJcbiAgdmFyIENIQVRfSVRFTSA9IFwiY2hhdFwiO1xyXG4gIHZhciBNRVNTQUdFU19MSVNUID0gXCJjaGF0LW1lc3NhZ2VzXCI7XHJcbiAgdmFyIElOUFVUX0JPWCA9IFwiY2hhdC1pbnB1dC1ib3hcIjtcclxuICB2YXIgSU5QVVRfVEVYVCA9IFwiY2hhdC1pbnB1dC10eHRcIjtcclxuICB2YXIgQ0hBVF9NRVNTQUdFX0JVVFRPTl9JRCA9IFwiY2hhdC1tZXNzYWdlLWJ1dHRvblwiO1xyXG4gIHZhciBUT0dHTEVfQlVUVE9OID0gXCJjaGF0LXRvZ2dsZS1idXR0b25cIjtcclxuICB2YXIgRVhQQU5EX01BUksgPSBcIlsgXVwiO1xyXG4gIHZhciBDT0xMQVBTRV9NQVJLID0gXCItXCI7XHJcbiAgdmFyIG1vbnRocyA9IFtcclxuICAgIFwi0Y/QvdCy0LDRgNGPXCIsXHJcbiAgICBcItGE0LXQstGA0LDQu9GPXCIsXHJcbiAgICBcItC80LDRgNGC0LBcIixcclxuICAgIFwi0LDQv9GA0LXQu9GPXCIsXHJcbiAgICBcItC80LDRj1wiLFxyXG4gICAgXCLQuNGO0L3Rj1wiLFxyXG4gICAgXCLQuNGO0LvRj1wiLFxyXG4gICAgXCLQsNCy0LPRg9GB0YLQsFwiLFxyXG4gICAgXCLRgdC10L3RgtGP0LHRgNGPXCIsXHJcbiAgICBcItC+0LrRgtGP0LHRgNGPXCIsXHJcbiAgICBcItC90L7Rj9Cx0YDRj1wiLFxyXG4gICAgXCLQtNC10LrQsNCx0YDRj1wiXHJcbiAgXTtcclxuICB2YXIgUkVQTFlfVElNRU9VVCA9IDE1MDAwO1xyXG4gIHZhciBQQVRIX1RPX1NUWUxFU0hFRVQgPVxyXG4gICAgXCJodHRwczovL3Jhd2dpdC5jb20vQmVzb21oZWFkL2pzLS10b3VjaHNvZnQvYmVzb21oZWFkLXRhc2swNS90YXNrLTA1L0Jlc29taGVhZC9idWlsZC9jc3MvY2hhdF9zdHlsZXMuY3NzXCI7XHJcbiAgdmFyIERFRkFVTFRfVVNFUl9OQU1FID0gXCLQktGLXCI7XHJcbiAgdmFyIFVTRVJfTkFNRV9GSUVMRCA9IFwidXNlck5hbWVcIjtcclxuICB2YXIgQ0hBVF9TVEFURV9GSUVMRCA9IFwiY2hhdFN0YXRlXCI7XHJcbiAgdmFyIE1FU1NBR0VTX0ZJRUxEID0gXCJtZXNzYWdlc1wiO1xyXG4gIHZhciBSRUFEX0ZJRUxEID0gXCJyZWFkXCI7XHJcbiAgdmFyIFVTRVJfTkFNRV9QUk9NUFRfSUQgPSBcImNoYXQtdXNlcm5hbWUtcHJvbXB0LWNvbnRhaW5lclwiO1xyXG4gIHZhciBQUk9NUFRfSU5QVVRfSUQgPSBcImNoYXQtdXNlcm5hbWUtcHJvbXB0LWlucHV0XCI7XHJcbiAgdmFyIFBST01QVF9DT05GSVJNX0JVVFRPTl9JRCA9IFwiY2hhdC11c2VybmFtZS1wcm9tcHQtYnV0dG9uXCI7XHJcbiAgdmFyIFJFUVVFU1RfVElNRU9VVCA9IDMwMDA7XHJcblxyXG4gIHZhciB1c2VyTWVzc2FnZXM7XHJcblxyXG4gIGZ1bmN0aW9uIENoYXRGYWN0b3J5KCkge31cclxuXHJcbiAgZnVuY3Rpb24gZ2V0RXh0cmFQYXRoKHBhdGgpIHtcclxuICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShVU0VSX0lEKSArIFwiL1wiICsgcGF0aDtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNhdmVDaGF0U3RhdGVUb1N0b3JhZ2Uoc3RhdGUpIHtcclxuICAgIGNvbmZpZy5jaGF0U3RhdGUgPSBzdGF0ZTtcclxuICAgIHN0b3JhZ2VNYW5hZ2VyLnNlbmRSZXF1ZXN0VG9TdG9yYWdlKFxyXG4gICAgICBnZXRFeHRyYVBhdGgoQ0hBVF9TVEFURV9GSUVMRCksXHJcbiAgICAgIEhUVFBfUFVULFxyXG4gICAgICBzdGF0ZVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGNvbGxhcHNlQ2hhdCgpIHtcclxuICAgIGNvbmZpZy5tZXNzYWdlc0xlbmd0aCA9IDA7XHJcbiAgICBETS5yZW1vdmVDU1NDbGFzcyhDSEFUX0lURU0sIEVYUEFOREVEKTtcclxuICAgIERNLmFkZENTU0NsYXNzKENIQVRfSVRFTSwgQ09MTEFQU0VEKTtcclxuICAgIERNLmdldERPTUVsZW1lbnQoVE9HR0xFX0JVVFRPTikuaW5uZXJIVE1MID0gRVhQQU5EX01BUks7XHJcbiAgICBETS5yZW1vdmVET01FbGVtZW50KENIQVRfSVRFTSwgTUVTU0FHRVNfTElTVCk7XHJcbiAgICBETS5yZW1vdmVET01FbGVtZW50KENIQVRfSVRFTSwgSU5QVVRfQk9YKTtcclxuICAgIHNhdmVDaGF0U3RhdGVUb1N0b3JhZ2UoQ09MTEFQU0VEKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGFwcGVuZE1lc3NhZ2VQYXJ0KGNvbnRhaW5lciwgaW5uZXJIVE1MKSB7XHJcbiAgICB2YXIgZWwgPSBETS5jcmVhdGVET01FbGVtZW50KFwiZGl2XCIpO1xyXG5cclxuICAgIGVsLmlubmVySFRNTCA9IGlubmVySFRNTDtcclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQoY29udGFpbmVyLCBlbCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBhcHBlbmREYXRlTGVnZW5kKGNvbnRhaW5lciwgbWVzc2FnZSkge1xyXG4gICAgdmFyIGRheU9mTW9udGggPSBETS5jcmVhdGVET01FbGVtZW50KFwibGVnZW5kXCIpO1xyXG5cclxuICAgIGRheU9mTW9udGguaW5uZXJIVE1MID0gbWVzc2FnZS5kYXlcclxuICAgICAgLnRvU3RyaW5nKClcclxuICAgICAgLmNvbmNhdChcIiBcIilcclxuICAgICAgLmNvbmNhdChtb250aHNbK21lc3NhZ2UubW9udGhdKTtcclxuICAgIERNLmFkZENTU0NsYXNzKGRheU9mTW9udGgsIFwiY2hhdC1kYXktb2YtbW9udGhcIik7XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KGNvbnRhaW5lciwgZGF5T2ZNb250aCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBhcHBlbmRTaW5nbGVNZXNzYWdlKGNvbnRhaW5lciwgbWVzc2FnZSkge1xyXG4gICAgdmFyIGNvbnRhaW5lcklkO1xyXG4gICAgdmFyIG1lc3NhZ2VzQ29udGFpbmVyO1xyXG5cclxuICAgIGNvbnRhaW5lcklkID0gQ0hBVF9JVEVNLmNvbmNhdChcIi1cIilcclxuICAgICAgLmNvbmNhdChtZXNzYWdlLmRheSlcclxuICAgICAgLmNvbmNhdChcIi1cIilcclxuICAgICAgLmNvbmNhdChtZXNzYWdlLm1vbnRoKTtcclxuICAgIGlmIChETS5nZXRET01FbGVtZW50KGNvbnRhaW5lcklkKSA9PT0gbnVsbCkge1xyXG4gICAgICBtZXNzYWdlc0NvbnRhaW5lciA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIG1lc3NhZ2VzQ29udGFpbmVyLmlkID0gY29udGFpbmVySWQ7XHJcbiAgICAgIERNLmFkZENTU0NsYXNzKG1lc3NhZ2VzQ29udGFpbmVyLCBcImNoYXQtbWVzc2FnZXMtY29udGFpbmVyXCIpO1xyXG4gICAgICBpZiAoY29uZmlnLnNob3dEYXRlVGltZSA9PT0gXCJ0cnVlXCIpIHtcclxuICAgICAgICBETS5hZGRDU1NDbGFzcyhtZXNzYWdlc0NvbnRhaW5lciwgXCJjaGF0LW1lc3NhZ2VzLWNvbnRhaW5lci13aXRoLXRpbWVcIik7XHJcbiAgICAgICAgYXBwZW5kRGF0ZUxlZ2VuZChjb250YWluZXIsIG1lc3NhZ2UpO1xyXG4gICAgICB9IGVsc2UgaWYgKGNvbmZpZy5zaG93RGF0ZVRpbWUgPT09IFwiZmFsc2VcIikge1xyXG4gICAgICAgIERNLmFkZENTU0NsYXNzKG1lc3NhZ2VzQ29udGFpbmVyLCBcImNoYXQtbWVzc2FnZXMtY29udGFpbmVyLW5vLXRpbWVcIik7XHJcbiAgICAgIH1cclxuICAgICAgRE0uYXBwZW5kRE9NRWxlbWVudChjb250YWluZXIsIG1lc3NhZ2VzQ29udGFpbmVyKTtcclxuICAgIH1cclxuICAgIG1lc3NhZ2VzQ29udGFpbmVyID0gRE0uZ2V0RE9NRWxlbWVudChjb250YWluZXJJZCk7XHJcbiAgICBpZiAoY29uZmlnLnNob3dEYXRlVGltZSA9PT0gXCJ0cnVlXCIpIHtcclxuICAgICAgYXBwZW5kTWVzc2FnZVBhcnQobWVzc2FnZXNDb250YWluZXIsIG1lc3NhZ2UudGltZSk7XHJcbiAgICB9XHJcbiAgICBhcHBlbmRNZXNzYWdlUGFydChtZXNzYWdlc0NvbnRhaW5lciwgbWVzc2FnZS5zZW5kZXIpO1xyXG4gICAgYXBwZW5kTWVzc2FnZVBhcnQobWVzc2FnZXNDb250YWluZXIsIG1lc3NhZ2UuYm9keSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzaG93TWVzc2FnZXMoY29udGFpbmVyLCBtZXNzYWdlcykge1xyXG4gICAgdmFyIG1lc3NhZ2VzS2V5cyA9IE9iamVjdC5rZXlzKG1lc3NhZ2VzKTtcclxuICAgIGNvbmZpZy5tZXNzYWdlc0xlbmd0aCA9IG1lc3NhZ2VzS2V5cy5sZW5ndGg7XHJcbiAgICBtZXNzYWdlc0tleXMuZm9yRWFjaChmdW5jdGlvbiBzaG93TWVzc2FnZShrZXkpIHtcclxuICAgICAgYXBwZW5kU2luZ2xlTWVzc2FnZShjb250YWluZXIsIG1lc3NhZ2VzW2tleV0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBDaGF0RmFjdG9yeS5wcm90b3R5cGUuYXBwZW5kTWVzc2FnZXMgPSBmdW5jdGlvbiBhcHBlbmRNZXNzYWdlcyhcclxuICAgIGNvbnRhaW5lcixcclxuICAgIG1lc3NhZ2VzXHJcbiAgKSB7XHJcbiAgICBpZiAobWVzc2FnZXMpIHtcclxuICAgICAgc2hvd01lc3NhZ2VzKGNvbnRhaW5lciwgbWVzc2FnZXMpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgc3RvcmFnZU1hbmFnZXJcclxuICAgICAgLnNlbmRSZXF1ZXN0VG9TdG9yYWdlKGdldEV4dHJhUGF0aChNRVNTQUdFU19GSUVMRCksIEhUVFBfR0VULCBcIlwiKVxyXG4gICAgICAudGhlbihmdW5jdGlvbiBzaG93TWVzc2FnZXNJbkNoYXQoZGF0YSkge1xyXG4gICAgICAgIGlmICghZGF0YSkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzaG93TWVzc2FnZXMoY29udGFpbmVyLCBkYXRhKTtcclxuICAgICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgZnVuY3Rpb24gYXBwZW5kTWVzc2FnZXNMaXN0KCkge1xyXG4gICAgdmFyIG1lc3NhZ2VzTGlzdENvbnRhaW5lciA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJkaXZcIik7XHJcblxyXG4gICAgbWVzc2FnZXNMaXN0Q29udGFpbmVyLmlkID0gTUVTU0FHRVNfTElTVDtcclxuICAgIERNLmFkZENTU0NsYXNzKG1lc3NhZ2VzTGlzdENvbnRhaW5lciwgXCJjaGF0LW1lc3NhZ2VzLWV4dGVybmFsXCIpO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChDSEFUX0lURU0sIG1lc3NhZ2VzTGlzdENvbnRhaW5lcik7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiB1cGRhdGVNZXNzYWdlc0xpc3QoKSB7XHJcbiAgICBpZiAoY29uZmlnLmNoYXRTdGF0ZSA9PT0gQ09MTEFQU0VEKSB7XHJcbiAgICAgIHNldFRpbWVvdXQodXBkYXRlTWVzc2FnZXNMaXN0LCBSRVBMWV9USU1FT1VUKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgc3RvcmFnZU1hbmFnZXJcclxuICAgICAgLnNlbmRSZXF1ZXN0VG9TdG9yYWdlKGdldEV4dHJhUGF0aChNRVNTQUdFU19GSUVMRCksIEhUVFBfR0VULCBcIlwiKVxyXG4gICAgICAudGhlbihmdW5jdGlvbiBvbk1lc3NhZ2VzUmVjZWl2ZWQoZGF0YSkge1xyXG4gICAgICAgIHZhciBtZXNzYWdlc0tleXMgPSBPYmplY3Qua2V5cyhkYXRhKS5zbGljZSgxKTtcclxuXHJcbiAgICAgICAgc2V0VGltZW91dCh1cGRhdGVNZXNzYWdlc0xpc3QsIFJFUExZX1RJTUVPVVQpO1xyXG4gICAgICAgIGlmICghZGF0YSkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY29uZmlnLm1lc3NhZ2VzTGVuZ3RoID49IG1lc3NhZ2VzS2V5cy5sZW5ndGgpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbWVzc2FnZXNLZXlzXHJcbiAgICAgICAgICAuc2xpY2UoY29uZmlnLm1lc3NhZ2VzTGVuZ3RoKVxyXG4gICAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gYXBwZW5kTWVzc2FnZShrZXkpIHtcclxuICAgICAgICAgICAgYXBwZW5kU2luZ2xlTWVzc2FnZShETS5nZXRET01FbGVtZW50KE1FU1NBR0VTX0xJU1QpLCBkYXRhW2tleV0pO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgY29uZmlnLm1lc3NhZ2VzTGVuZ3RoID0gbWVzc2FnZXNLZXlzLmxlbmd0aDtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzYXZlTWVzc2FnZShtZXNzYWdlKSB7XHJcbiAgICBzdG9yYWdlTWFuYWdlci5zZW5kUmVxdWVzdFRvU3RvcmFnZShcclxuICAgICAgZ2V0RXh0cmFQYXRoKE1FU1NBR0VTX0ZJRUxEKSxcclxuICAgICAgSFRUUF9QT1NULFxyXG4gICAgICBtZXNzYWdlXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gdXBkYXRlTWVzc2FnZXMoZXZlbnQpIHtcclxuICAgIHZhciBkYXRhID0gZXZlbnQuZGF0YS5kYXRhO1xyXG5cclxuICAgIGlmIChldmVudC5kYXRhLnBhdGggPT09IFwiL1wiKSB7XHJcbiAgICAgIHVzZXJNZXNzYWdlcyA9IGRhdGE7XHJcbiAgICAgIGlmIChjb25maWcuY2hhdFN0YXRlID09PSBDT0xMQVBTRUQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY2hhdEZhY3RvcnkuYXBwZW5kTWVzc2FnZXMoRE0uZ2V0RE9NRWxlbWVudChNRVNTQUdFU19MSVNUKSwgdXNlck1lc3NhZ2VzKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHVzZXJNZXNzYWdlc1tldmVudC5kYXRhLnBhdGguc3BsaXQoXCIvXCIpLnBvcCgpXSA9IGRhdGE7XHJcbiAgICBpZiAoZGF0YS5zZW5kZXIuaW5kZXhPZihjb25maWcudXNlck5hbWUpICE9PSAtMSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoY29uZmlnLmNoYXRTdGF0ZSA9PT0gQ09MTEFQU0VEKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGFwcGVuZFNpbmdsZU1lc3NhZ2UoRE0uZ2V0RE9NRWxlbWVudChNRVNTQUdFU19MSVNUKSwgZGF0YSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzZW5kTWVzc2FnZSgpIHtcclxuICAgIHZhciBpbnB1dFRleHRBcmVhID0gRE0uZ2V0RE9NRWxlbWVudChJTlBVVF9URVhUKTtcclxuICAgIHZhciBtZXNzYWdlO1xyXG5cclxuICAgIGlmIChpbnB1dFRleHRBcmVhLnZhbHVlICE9PSBcIlwiKSB7XHJcbiAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlRmFjdG9yeS5nZXRNZXNzYWdlKFxyXG4gICAgICAgIG5ldyBEYXRlKCksXHJcbiAgICAgICAgY29uZmlnLnVzZXJOYW1lLmNvbmNhdChcIjpcIiksXHJcbiAgICAgICAgaW5wdXRUZXh0QXJlYS52YWx1ZVxyXG4gICAgICApO1xyXG4gICAgICBpbnB1dFRleHRBcmVhLnZhbHVlID0gXCJcIjtcclxuICAgICAgYXBwZW5kU2luZ2xlTWVzc2FnZShETS5nZXRET01FbGVtZW50KE1FU1NBR0VTX0xJU1QpLCBtZXNzYWdlKTtcclxuICAgICAgc2F2ZU1lc3NhZ2UobWVzc2FnZSk7XHJcbiAgICAgIHN0b3JhZ2VNYW5hZ2VyLnNlbmRSZXF1ZXN0VG9TdG9yYWdlKFxyXG4gICAgICAgIGdldEV4dHJhUGF0aChSRUFEX0ZJRUxEKSxcclxuICAgICAgICBIVFRQX1BVVCxcclxuICAgICAgICBmYWxzZVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQ2hhdEZhY3RvcnkucHJvdG90eXBlLnN1YnNjcmliZU9uVXBkYXRlcyA9IGZ1bmN0aW9uIHN1YnNjcmliZU9uVXBkYXRlcygpIHtcclxuICAgIGlmIChjb25maWcudXBkYXRlcyA9PT0gXCJyZWZldGNoXCIpIHtcclxuICAgICAgdXBkYXRlTWVzc2FnZXNMaXN0KCk7XHJcbiAgICB9IGVsc2UgaWYgKGNvbmZpZy51cGRhdGVzID09PSBcImxvbmdQb2xsaW5nXCIpIHtcclxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIHVwZGF0ZU1lc3NhZ2VzKTtcclxuICAgICAgdXBkYXRlc01hbmFnZXIuZ2V0RGF0YUZyb21TdG9yYWdlKGdldEV4dHJhUGF0aChNRVNTQUdFU19GSUVMRCkpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGZ1bmN0aW9uIGFwcGVuZElucHV0Qm94KCkge1xyXG4gICAgdmFyIGlucHV0TWVzc2FnZUNvbnRhaW5lciA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICB2YXIgaW5wdXRUZXh0QXJlYSA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJ0ZXh0YXJlYVwiKTtcclxuICAgIHZhciBtZXNzYWdlQnV0dG9uID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImJ1dHRvblwiKTtcclxuXHJcbiAgICBpbnB1dE1lc3NhZ2VDb250YWluZXIuaWQgPSBJTlBVVF9CT1g7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhpbnB1dE1lc3NhZ2VDb250YWluZXIsIFwiY2hhdC1pbnB1dC1jb250YWluZXJcIik7XHJcbiAgICBpbnB1dFRleHRBcmVhLmlkID0gSU5QVVRfVEVYVDtcclxuICAgIERNLmFkZENTU0NsYXNzKGlucHV0VGV4dEFyZWEsIFwiY2hhdC1pbnB1dC10ZXh0YXJlYVwiKTtcclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQoaW5wdXRNZXNzYWdlQ29udGFpbmVyLCBpbnB1dFRleHRBcmVhKTtcclxuICAgIG1lc3NhZ2VCdXR0b24uaWQgPSBDSEFUX01FU1NBR0VfQlVUVE9OX0lEO1xyXG4gICAgRE0uYWRkQ1NTQ2xhc3MobWVzc2FnZUJ1dHRvbiwgXCJjaGF0LW1lc3NhZ2UtYnV0dG9uXCIpO1xyXG4gICAgbWVzc2FnZUJ1dHRvbi5pbm5lckhUTUwgPSBcItCe0YLQv9GA0LDQstC40YLRjFwiO1xyXG4gICAgRE0uYWRkTGlzdGVuZXIobWVzc2FnZUJ1dHRvbiwgXCJjbGlja1wiLCBzZW5kTWVzc2FnZSk7XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KGlucHV0TWVzc2FnZUNvbnRhaW5lciwgbWVzc2FnZUJ1dHRvbik7XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KENIQVRfSVRFTSwgaW5wdXRNZXNzYWdlQ29udGFpbmVyKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdldFBvc2l0aW9uQ2xhc3MoKSB7XHJcbiAgICB2YXIgcG9zaXRpb25DbGFzcztcclxuXHJcbiAgICBpZiAoY29uZmlnLnBvc2l0aW9uID09PSBcImxlZnRcIikge1xyXG4gICAgICBwb3NpdGlvbkNsYXNzID0gXCJjaGF0LWNvbnRhaW5lci1sZWZ0XCI7XHJcbiAgICB9IGVsc2UgaWYgKGNvbmZpZy5wb3NpdGlvbiA9PT0gXCJyaWdodFwiKSB7XHJcbiAgICAgIHBvc2l0aW9uQ2xhc3MgPSBcImNoYXQtY29udGFpbmVyLXJpZ2h0XCI7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHBvc2l0aW9uQ2xhc3M7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjcmVhdGVVc2VyTmFtZVByb21wdE1hcmt1cCgpIHtcclxuICAgIHZhciBwcm9tcHRDb250YWluZXIgPSBETS5jcmVhdGVET01FbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgdmFyIHByb21wdExhYmVsID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImxhYmVsXCIpO1xyXG4gICAgdmFyIHByb21wdElucHV0ID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgdmFyIHByb21wdENvbmZpcm1CdXR0b24gPSBETS5jcmVhdGVET01FbGVtZW50KFwiYnV0dG9uXCIpO1xyXG5cclxuICAgIHByb21wdENvbnRhaW5lci5pZCA9IFVTRVJfTkFNRV9QUk9NUFRfSUQ7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhcclxuICAgICAgcHJvbXB0Q29udGFpbmVyLFxyXG4gICAgICBcImNoYXQtcHJvbXB0LWNvbnRhaW5lclwiLFxyXG4gICAgICBnZXRQb3NpdGlvbkNsYXNzKClcclxuICAgICk7XHJcbiAgICBwcm9tcHRJbnB1dC5pZCA9IFBST01QVF9JTlBVVF9JRDtcclxuICAgIERNLmFkZENTU0NsYXNzKHByb21wdElucHV0LCBcImNoYXQtcHJvbXB0LWlucHV0XCIpO1xyXG4gICAgcHJvbXB0TGFiZWwuZm9yID0gcHJvbXB0SW5wdXQuaWQ7XHJcbiAgICBwcm9tcHRMYWJlbC5pbm5lckhUTUwgPSBcItCf0L7QttCw0LvRg9C50YHRgtCwLCDQv9GA0LXQtNGB0YLQsNCy0YzRgtC10YHRjDpcIjtcclxuICAgIHByb21wdENvbmZpcm1CdXR0b24uaWQgPSBQUk9NUFRfQ09ORklSTV9CVVRUT05fSUQ7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhwcm9tcHRDb25maXJtQnV0dG9uLCBcImNoYXQtcHJvbXB0LWJ1dHRvblwiKTtcclxuICAgIHByb21wdENvbmZpcm1CdXR0b24uaW5uZXJIVE1MID0gXCLQodC+0YXRgNCw0L3QuNGC0YxcIjtcclxuICAgIERNLmFwcGVuZERPTUVsZW1lbnQocHJvbXB0Q29udGFpbmVyLCBwcm9tcHRMYWJlbCk7XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KHByb21wdENvbnRhaW5lciwgcHJvbXB0SW5wdXQpO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChwcm9tcHRDb250YWluZXIsIHByb21wdENvbmZpcm1CdXR0b24pO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChDSEFUX0lURU0sIHByb21wdENvbnRhaW5lcik7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzZXRPdGhlckNvbXBvbmVudHNBdmFpbGFiaWxpdHkoaXNBdmFpbGFibGUpIHtcclxuICAgIERNLmdldERPTUVsZW1lbnQoSU5QVVRfVEVYVCkuZGlzYWJsZWQgPSAhaXNBdmFpbGFibGU7XHJcbiAgICBETS5nZXRET01FbGVtZW50KENIQVRfTUVTU0FHRV9CVVRUT05fSUQpLmRpc2FibGVkID0gIWlzQXZhaWxhYmxlO1xyXG4gICAgaWYgKERNLmdldERPTUVsZW1lbnQoVE9HR0xFX0JVVFRPTikgIT09IG51bGwpIHtcclxuICAgICAgRE0uZ2V0RE9NRWxlbWVudChUT0dHTEVfQlVUVE9OKS5kaXNhYmxlZCA9ICFpc0F2YWlsYWJsZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGFza1VzZXJOYW1lKCkge1xyXG4gICAgY3JlYXRlVXNlck5hbWVQcm9tcHRNYXJrdXAoKTtcclxuICAgIHNldE90aGVyQ29tcG9uZW50c0F2YWlsYWJpbGl0eShmYWxzZSk7XHJcbiAgICBETS5hZGRMaXN0ZW5lcihQUk9NUFRfQ09ORklSTV9CVVRUT05fSUQsIFwiY2xpY2tcIiwgZnVuY3Rpb24gc2F2ZVVzZXJOYW1lKCkge1xyXG4gICAgICB2YXIgdXNlck5hbWUgPSBETS5nZXRET01FbGVtZW50KFBST01QVF9JTlBVVF9JRCkudmFsdWU7XHJcbiAgICAgIGlmICh1c2VyTmFtZS5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbmZpZy51c2VyTmFtZSA9IHVzZXJOYW1lO1xyXG4gICAgICBETS5yZW1vdmVET01FbGVtZW50KENIQVRfSVRFTSwgVVNFUl9OQU1FX1BST01QVF9JRCk7XHJcbiAgICAgIHNldE90aGVyQ29tcG9uZW50c0F2YWlsYWJpbGl0eSh0cnVlKTtcclxuICAgICAgc3RvcmFnZU1hbmFnZXIuc2VuZFJlcXVlc3RUb1N0b3JhZ2UoXHJcbiAgICAgICAgZ2V0RXh0cmFQYXRoKFVTRVJfTkFNRV9GSUVMRCksXHJcbiAgICAgICAgSFRUUF9QVVQsXHJcbiAgICAgICAgY29uZmlnLnVzZXJOYW1lXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGdldFVzZXJOYW1lRnJvbVN0b3JhZ2UoKSB7XHJcbiAgICBzdG9yYWdlTWFuYWdlclxyXG4gICAgICAuc2VuZFJlcXVlc3RUb1N0b3JhZ2UoZ2V0RXh0cmFQYXRoKFVTRVJfTkFNRV9GSUVMRCksIEhUVFBfR0VULCBcIlwiKVxyXG4gICAgICAudGhlbihmdW5jdGlvbiBzYXZlVXNlck5hbWUoZGF0YSkge1xyXG4gICAgICAgIGNvbmZpZy51c2VyTmFtZSA9IGRhdGE7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2V0VXNlck5hbWUoKSB7XHJcbiAgICBnZXRVc2VyTmFtZUZyb21TdG9yYWdlKCk7XHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uIGlmTm90QXNzaWduKCkge1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgY29uZmlnLnVzZXJOYW1lICE9PSBudWxsICYmXHJcbiAgICAgICAgY29uZmlnLnVzZXJOYW1lICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICBjb25maWcudXNlck5hbWUgIT09IFwiXCJcclxuICAgICAgKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjb25maWcucmVxdWlyZU5hbWUgPT09IFwidHJ1ZVwiKSB7XHJcbiAgICAgICAgYXNrVXNlck5hbWUoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25maWcudXNlck5hbWUgPSBERUZBVUxUX1VTRVJfTkFNRTtcclxuICAgICAgICBzdG9yYWdlTWFuYWdlci5zZW5kUmVxdWVzdFRvU3RvcmFnZShcclxuICAgICAgICAgIGdldEV4dHJhUGF0aChVU0VSX05BTUVfRklFTEQpLFxyXG4gICAgICAgICAgSFRUUF9QVVQsXHJcbiAgICAgICAgICBjb25maWcudXNlck5hbWVcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9LCBSRVFVRVNUX1RJTUVPVVQpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZXhwYW5kQ2hhdCgpIHtcclxuICAgIERNLnJlbW92ZUNTU0NsYXNzKENIQVRfSVRFTSwgQ09MTEFQU0VEKTtcclxuICAgIERNLmFkZENTU0NsYXNzKENIQVRfSVRFTSwgRVhQQU5ERUQpO1xyXG4gICAgaWYgKGNvbmZpZy5hbGxvd01pbmltaXplID09PSBcInRydWVcIikge1xyXG4gICAgICBETS5nZXRET01FbGVtZW50KFRPR0dMRV9CVVRUT04pLmlubmVySFRNTCA9IENPTExBUFNFX01BUks7XHJcbiAgICB9XHJcbiAgICBhcHBlbmRNZXNzYWdlc0xpc3QoKTtcclxuICAgIGlmICh1c2VyTWVzc2FnZXMpIHtcclxuICAgICAgc2hvd01lc3NhZ2VzKERNLmdldERPTUVsZW1lbnQoTUVTU0FHRVNfTElTVCksIHVzZXJNZXNzYWdlcyk7XHJcbiAgICB9XHJcbiAgICBhcHBlbmRJbnB1dEJveCgpO1xyXG4gICAgaWYgKFxyXG4gICAgICBjb25maWcudXNlck5hbWUgPT09IFwiXCIgfHxcclxuICAgICAgY29uZmlnLnVzZXJOYW1lID09PSBudWxsIHx8XHJcbiAgICAgIGNvbmZpZy51c2VyTmFtZSA9PT0gdW5kZWZpbmVkXHJcbiAgICApIHtcclxuICAgICAgc2V0VXNlck5hbWUoKTtcclxuICAgIH1cclxuICAgIHNhdmVDaGF0U3RhdGVUb1N0b3JhZ2UoRVhQQU5ERUQpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0Q2hhdFN0YXRlRnJvbVN0b3JhZ2UoKSB7XHJcbiAgICBzdG9yYWdlTWFuYWdlclxyXG4gICAgICAuc2VuZFJlcXVlc3RUb1N0b3JhZ2UoZ2V0RXh0cmFQYXRoKENIQVRfU1RBVEVfRklFTEQpLCBIVFRQX0dFVCwgXCJcIilcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gc2F2ZUNoYXRTdGF0ZShkYXRhKSB7XHJcbiAgICAgICAgY29uZmlnLmNoYXRTdGF0ZSA9IGRhdGE7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gaW5pdENoYXRTdGF0ZSgpIHtcclxuICAgIGdldENoYXRTdGF0ZUZyb21TdG9yYWdlKCk7XHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uIHJlc29sdmVDaGF0U3RhdGUoKSB7XHJcbiAgICAgIGlmIChcclxuICAgICAgICBjb25maWcuY2hhdFN0YXRlID09PSBudWxsIHx8XHJcbiAgICAgICAgY29uZmlnLmNoYXRTdGF0ZSA9PT0gdW5kZWZpbmVkIHx8XHJcbiAgICAgICAgY29uZmlnLmNoYXRTdGF0ZSA9PT0gXCJcIlxyXG4gICAgICApIHtcclxuICAgICAgICBzYXZlQ2hhdFN0YXRlVG9TdG9yYWdlKENPTExBUFNFRCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY29uZmlnLmNoYXRTdGF0ZSA9PT0gRVhQQU5ERUQpIHtcclxuICAgICAgICBleHBhbmRDaGF0KCk7XHJcbiAgICAgIH1cclxuICAgICAgRE0uYWRkQ1NTQ2xhc3MoQ0hBVF9JVEVNLCBjb25maWcuY2hhdFN0YXRlKTtcclxuICAgIH0sIFJFUVVFU1RfVElNRU9VVCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjaGFuZ2VDaGF0U3RhdGUoKSB7XHJcbiAgICBzd2l0Y2ggKGNvbmZpZy5jaGF0U3RhdGUpIHtcclxuICAgICAgY2FzZSBDT0xMQVBTRUQ6XHJcbiAgICAgICAgZXhwYW5kQ2hhdCgpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIEVYUEFOREVEOlxyXG4gICAgICAgIGNvbGxhcHNlQ2hhdCgpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcclxuICAgICAgICAgIFwiVW5leHBlY3RlZCBrZXkvdmFsdWUgcGFpcjogXCIgKyBDSEFUX0lURU0gKyBcIi9cIiArIGNvbmZpZy5jaGF0U3RhdGVcclxuICAgICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQ2hhdEZhY3RvcnkucHJvdG90eXBlLmFwcGVuZFN0eWxlc2hlZXQgPSBmdW5jdGlvbiBhcHBlbmRTdHlsZXNoZWV0KCkge1xyXG4gICAgdmFyIHN0eWxlRWxlbWVudCA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJsaW5rXCIpO1xyXG5cclxuICAgIHN0eWxlRWxlbWVudC5yZWwgPSBcInN0eWxlc2hlZXRcIjtcclxuICAgIHN0eWxlRWxlbWVudC50eXBlID0gXCJ0ZXh0L2Nzc1wiO1xyXG4gICAgc3R5bGVFbGVtZW50LmhyZWYgPSBQQVRIX1RPX1NUWUxFU0hFRVQ7XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KGRvY3VtZW50LmhlYWQsIHN0eWxlRWxlbWVudCk7XHJcbiAgfTtcclxuXHJcbiAgZnVuY3Rpb24gYXBwZW5kVG9nZ2xlQnV0dG9uKGNvbnRhaW5lcikge1xyXG4gICAgdmFyIHRvZ2dsZUJ1dHRvbiA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICBETS5hZGRDU1NDbGFzcyh0b2dnbGVCdXR0b24sIFRPR0dMRV9CVVRUT04pO1xyXG4gICAgdG9nZ2xlQnV0dG9uLmlkID0gVE9HR0xFX0JVVFRPTjtcclxuICAgIHRvZ2dsZUJ1dHRvbi5pbm5lckhUTUwgPVxyXG4gICAgICBjb25maWcuY2hhdFN0YXRlID09PSBFWFBBTkRFRCA/IENPTExBUFNFX01BUksgOiBFWFBBTkRfTUFSSztcclxuICAgIERNLmFkZExpc3RlbmVyKHRvZ2dsZUJ1dHRvbiwgXCJjbGlja1wiLCBjaGFuZ2VDaGF0U3RhdGUpO1xyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChjb250YWluZXIsIHRvZ2dsZUJ1dHRvbik7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzZXREcmFnSGFuZGxlcihjb250YWluZXIpIHtcclxuICAgIGZ1bmN0aW9uIGdldENvb3JkaW5hdGVzKGVsZW0pIHtcclxuICAgICAgdmFyIGJveCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgdG9wOiBib3gudG9wICsgd2luZG93LnBhZ2VZT2Zmc2V0LFxyXG4gICAgICAgIGxlZnQ6IGJveC5sZWZ0ICsgd2luZG93LnBhZ2VYT2Zmc2V0XHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgRE0uYWRkTGlzdGVuZXIoY29udGFpbmVyLCBcIm1vdXNlZG93blwiLCBmdW5jdGlvbiBvbk1vdXNlRG93bihldmVudCkge1xyXG4gICAgICB2YXIgY2hhdCA9IERNLmdldERPTUVsZW1lbnQoQ0hBVF9JVEVNKTtcclxuICAgICAgdmFyIGNvb3JkaW5hdGVzID0gZ2V0Q29vcmRpbmF0ZXMoY2hhdCk7XHJcbiAgICAgIHZhciBzaGlmdFggPSBldmVudC5wYWdlWCAtIGNvb3JkaW5hdGVzLmxlZnQ7XHJcbiAgICAgIHZhciBzaGlmdFkgPSBldmVudC5wYWdlWSAtIGNvb3JkaW5hdGVzLnRvcDtcclxuICAgICAgdmFyIG1vdXNlTW92ZUhhbmRsZXI7XHJcbiAgICAgIHZhciBtb3VzZVVwSGFuZGxlcjtcclxuXHJcbiAgICAgIGlmIChldmVudC50YXJnZXQudGFnTmFtZSA9PT0gXCJCVVRUT05cIikge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gbW92ZUF0KGUpIHtcclxuICAgICAgICBjaGF0LnN0eWxlLmxlZnQgPSBlLnBhZ2VYIC0gc2hpZnRYICsgXCJweFwiO1xyXG4gICAgICAgIGNoYXQuc3R5bGUudG9wID0gZS5wYWdlWSAtIHNoaWZ0WSArIFwicHhcIjtcclxuICAgICAgfVxyXG5cclxuICAgICAgbW91c2VNb3ZlSGFuZGxlciA9IGZ1bmN0aW9uIG9uTW91c2VNb3ZlKGUpIHtcclxuICAgICAgICBtb3ZlQXQoZSk7XHJcbiAgICAgIH07XHJcbiAgICAgIG1vdXNlVXBIYW5kbGVyID0gZnVuY3Rpb24gb25Nb3VzZVVwKCkge1xyXG4gICAgICAgIERNLnJlbW92ZUxpc3RlbmVyKGRvY3VtZW50LCBcIm1vdXNlbW92ZVwiLCBtb3VzZU1vdmVIYW5kbGVyKTtcclxuICAgICAgICBETS5yZW1vdmVMaXN0ZW5lcihjb250YWluZXIsIFwibW91c2V1cFwiLCBtb3VzZVVwSGFuZGxlcik7XHJcbiAgICAgIH07XHJcbiAgICAgIG1vdmVBdChldmVudCk7XHJcbiAgICAgIERNLmFkZExpc3RlbmVyKGRvY3VtZW50LCBcIm1vdXNlbW92ZVwiLCBtb3VzZU1vdmVIYW5kbGVyKTtcclxuICAgICAgRE0uYWRkTGlzdGVuZXIoY29udGFpbmVyLCBcIm1vdXNldXBcIiwgbW91c2VVcEhhbmRsZXIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgRE0uYWRkTGlzdGVuZXIoY29udGFpbmVyLCBcImRyYWdzdGFydFwiLCBmdW5jdGlvbiBvbkRyYWdTdGFydCgpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBDaGF0RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlQ2hhdE1hcmt1cCA9IGZ1bmN0aW9uIGNyZWF0ZUNoYXRNYXJrdXAoKSB7XHJcbiAgICB2YXIgY29udGFpbmVyID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImZpZWxkc2V0XCIpO1xyXG4gICAgdmFyIGxlZ2VuZCA9IERNLmNyZWF0ZURPTUVsZW1lbnQoXCJsZWdlbmRcIik7XHJcbiAgICB2YXIgdG9nZ2xlQnV0dG9uQ29udGFpbmVyID0gRE0uY3JlYXRlRE9NRWxlbWVudChcImRpdlwiKTtcclxuXHJcbiAgICBjb250YWluZXIuaWQgPSBDSEFUX0lURU07XHJcbiAgICBETS5hZGRDU1NDbGFzcyhcclxuICAgICAgY29udGFpbmVyLFxyXG4gICAgICBcImNoYXQtY29udGFpbmVyXCIsXHJcbiAgICAgIGdldFBvc2l0aW9uQ2xhc3MoKSxcclxuICAgICAgY29uZmlnLmNzc0NsYXNzXHJcbiAgICApO1xyXG4gICAgbGVnZW5kLmlubmVySFRNTCA9IGNvbmZpZy5jaGF0VGl0bGU7XHJcbiAgICBETS5hZGRDU1NDbGFzcyhsZWdlbmQsIFwiY2hhdC1sZWdlbmRcIik7XHJcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobGVnZW5kKTtcclxuICAgIERNLmFkZENTU0NsYXNzKHRvZ2dsZUJ1dHRvbkNvbnRhaW5lciwgXCJjaGF0LXRvZ2dsZS1idXR0b24tY29udGFpbmVyXCIpO1xyXG4gICAgaWYgKGNvbmZpZy5hbGxvd0RyYWcgPT09IFwidHJ1ZVwiKSB7XHJcbiAgICAgIERNLmFkZENTU0NsYXNzKFxyXG4gICAgICAgIHRvZ2dsZUJ1dHRvbkNvbnRhaW5lcixcclxuICAgICAgICBcImNoYXQtdG9nZ2xlLWJ1dHRvbi1jb250YWluZXItZHJhZ1wiXHJcbiAgICAgICk7XHJcbiAgICAgIHNldERyYWdIYW5kbGVyKHRvZ2dsZUJ1dHRvbkNvbnRhaW5lcik7XHJcbiAgICB9XHJcbiAgICBpZiAoY29uZmlnLmFsbG93TWluaW1pemUgPT09IFwidHJ1ZVwiKSB7XHJcbiAgICAgIGFwcGVuZFRvZ2dsZUJ1dHRvbih0b2dnbGVCdXR0b25Db250YWluZXIpO1xyXG4gICAgfSBlbHNlIGlmIChjb25maWcuYWxsb3dNaW5pbWl6ZSA9PT0gXCJmYWxzZVwiKSB7XHJcbiAgICAgIHNhdmVDaGF0U3RhdGVUb1N0b3JhZ2UoRVhQQU5ERUQpO1xyXG4gICAgfVxyXG4gICAgRE0uYXBwZW5kRE9NRWxlbWVudChjb250YWluZXIsIHRvZ2dsZUJ1dHRvbkNvbnRhaW5lcik7XHJcbiAgICBETS5hcHBlbmRET01FbGVtZW50KGRvY3VtZW50LmJvZHksIGNvbnRhaW5lcik7XHJcbiAgICBpbml0Q2hhdFN0YXRlKCk7XHJcbiAgfTtcclxuXHJcbiAgZnVuY3Rpb24gZ2V0UGFyYW1zRnJvbVJlcXVlc3QoKSB7XHJcbiAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmM7XHJcbiAgICByZXR1cm4gc2NyaXB0XHJcbiAgICAgIC5zdWJzdHIoc2NyaXB0LmluZGV4T2YoXCI/XCIpICsgMSlcclxuICAgICAgLnNwbGl0KFwiJlwiKVxyXG4gICAgICAucmVkdWNlKGZ1bmN0aW9uIHJlZHVjZXIocGFyYW0sIGVsKSB7XHJcbiAgICAgICAgdmFyIHBhcnRzID0gZWwuc3BsaXQoXCI9XCIpO1xyXG4gICAgICAgIHZhciB2YWx1ZSA9IGRlY29kZVVSSUNvbXBvbmVudChwYXJ0c1sxXSk7XHJcbiAgICAgICAgcGFyYW1bZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzBdKV0gPSB2YWx1ZS5zdWJzdHIoMSwgdmFsdWUubGVuZ3RoIC0gMik7XHJcbiAgICAgICAgcmV0dXJuIHBhcmFtO1xyXG4gICAgICB9LCB7fSk7XHJcbiAgfVxyXG5cclxuICBDaGF0RmFjdG9yeS5wcm90b3R5cGUuc2V0Q29uZmlnID0gZnVuY3Rpb24gc2V0Q29uZmlnKCkge1xyXG4gICAgdmFyIHJlcXVlc3RDb25maWcgPSBnZXRQYXJhbXNGcm9tUmVxdWVzdCgpO1xyXG4gICAgdmFyIHByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgT2JqZWN0LmtleXMocmVxdWVzdENvbmZpZykuZm9yRWFjaChmdW5jdGlvbiBhcHBseVByb3BlcnRpZXMoa2V5KSB7XHJcbiAgICAgIHByb3BlcnR5VmFsdWUgPSByZXF1ZXN0Q29uZmlnW2tleV07XHJcbiAgICAgIGlmIChwcm9wZXJ0eVZhbHVlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgY29uZmlnW2tleV0gPSBwcm9wZXJ0eVZhbHVlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBDaGF0RmFjdG9yeS5wcm90b3R5cGUuc2V0VW5pcXVlVXNlcklEID0gZnVuY3Rpb24gc2V0VW5pcXVlVXNlcklEKCkge1xyXG4gICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFVTRVJfSUQpID09PSBudWxsKSB7XHJcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFVTRVJfSUQsIFwidXNlclwiLmNvbmNhdChEYXRlLm5vdygpLnRvU3RyaW5nKCkpKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICByZXR1cm4gbmV3IENoYXRGYWN0b3J5KCk7XHJcbn0pKGNvbmZpZyk7XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgZnVuY3Rpb24gaW5pdFBhZ2UoKSB7XHJcbiAgY2hhdEZhY3RvcnkuYXBwZW5kU3R5bGVzaGVldCgpO1xyXG4gIGNoYXRGYWN0b3J5LnNldFVuaXF1ZVVzZXJJRCgpO1xyXG4gIGNoYXRGYWN0b3J5LmNyZWF0ZUNoYXRNYXJrdXAoKTtcclxuICBzZXRUaW1lb3V0KGNoYXRGYWN0b3J5LnN1YnNjcmliZU9uVXBkYXRlcywgTUFSS1VQX1RJTUVPVVQpO1xyXG59KTtcclxuXHJcbmNoYXRGYWN0b3J5LnNldENvbmZpZygpOyJdfQ==
